import{G as ne,r as t,k as w,j as e,s as T,m as ie,n as $,D as m,o as de}from"./index-D9WFKTT6.js";import{u as ce,B as xe,r as B,a as W}from"./MainContent-DKQmACsd.js";const I=r=>!r||typeof r!="string"?!1:r.startsWith("sk-")&&r.length>=40,S=r=>!r||typeof r!="string"?!1:r.startsWith("AI")&&r.length>=35;function me(r){return ne({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"},child:[]},{tag:"path",attr:{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"},child:[]},{tag:"path",attr:{d:"M12 9l0 3"},child:[]},{tag:"path",attr:{d:"M12 15l.01 0"},child:[]}]})(r)}function fe({currentChat:r,isLoading:u,error:K,clearError:z,onModelChange:M,onProviderChange:H,selectedModel:h,selectedProvider:l,onUserNameChange:C}){const[f,E]=t.useState(!1),[_,g]=t.useState(()=>{const{models:a}=w(l);return a}),[Y,p]=t.useState(!1),[o,G]=t.useState(""),[n,F]=t.useState(""),[q,y]=t.useState(!1),[J,b]=t.useState(!1),[i,d]=t.useState(!1),[c,P]=t.useState(r.userName??"User"),[v,O]=t.useState(!1),[L,R]=t.useState(!1),{getAvailableModels:k,switchProvider:Q,getProviderDisplayName:V,getDefaultModel:X}=ce(l),Z=a=>({})[a]||a,U=a=>a.includes("gpt-4")?"premium":a.includes("gpt")?"pro":a.includes("gemini-1.5-flash")?"free":(a.includes("gemini"),"pro"),ee=a=>{M(a),T(a,l)},ae=a=>{H(a),Q(a),ie(a);const{models:s}=w(a);g(s);const x=X();M(x),T(x,a)},N=async()=>{try{E(!0);const a=await k();a.length>0&&(g(a),$(a,l),p(!1))}catch(a){console.error("Failed to refresh models:",a)}finally{E(!1)}},re=async()=>{try{const[a,s]=await Promise.all([m.hasApiKey("openai"),m.hasApiKey("google")]);y(a),b(s)}catch(a){console.error("Error checking API keys:",a)}},te=async()=>{if(o.trim()){if(!I(o.trim())){alert("Invalid OpenAI API key format. Keys should start with 'sk-' and be at least 40 characters long.");return}d(!0);try{await m.saveApiKey("openai",o.trim()),await B(),G(""),y(!0),await N()}catch(a){console.error("Error saving OpenAI key:",a),alert("Error saving OpenAI API key. Please try again.")}finally{d(!1)}}},se=async()=>{if(n.trim()){if(!S(n.trim())){alert("Invalid Google AI API key format. Keys should start with 'AI' and be at least 35 characters long.");return}d(!0);try{await m.saveApiKey("google",n.trim()),await W(),F(""),b(!0),await N()}catch(a){console.error("Error saving Google AI key:",a),alert("Error saving Google AI API key. Please try again.")}finally{d(!1)}}},D=async a=>{d(!0);try{const s=await m.getAllApiKeys(a);for(const x of s)await m.deleteApiKey(x.id);a==="openai"?(await B(),y(!1)):(await W(),b(!1))}catch(s){console.error(`Error removing ${a} key:`,s)}finally{d(!1)}},le=a=>{P(a.target.value),R(!1)},oe=async()=>{if(!(!c.trim()||c===r.userName)){O(!0);try{C&&C(c.trim()),R(!0)}finally{O(!1)}}};let j="Save";return v?j="Saving...":L&&(j="Saved"),t.useEffect(()=>{(async()=>{try{const{models:s,timestamp:x}=w(l);if(!de(x,24)&&s.length>0){g(s),p(!0);return}const A=await k();A.length>0&&(g(A),$(A,l),p(!1))}catch(s){console.log("Could not fetch models, using cached/defaults:",s)}})()},[l,k]),t.useEffect(()=>{re()},[]),t.useEffect(()=>{P(r.userName??"User")},[r.userName]),e.jsxs("div",{className:"w-full flex flex-col gap-3 bg-black/80 p-2 rounded-md",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("h2",{className:"text-gray-800 dark:text-gray-200",children:["Chat: ",e.jsx("b",{children:r.title})]}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:["Character:"," ",e.jsx("b",{style:{color:r.characterColor},children:r.characterName})]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Temperature: ",e.jsx("b",{children:r.temperature})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"user-name-input",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Your Name"}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("input",{id:"user-name-input",type:"text",value:c,onChange:le,className:"flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 border-gray-300",disabled:u||v,placeholder:"Enter your name",maxLength:64}),e.jsx("button",{onClick:oe,disabled:u||v||!c.trim()||c===r.userName,className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:j})]})]})]}),e.jsxs("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 pt-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"API Key Configuration"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"openai-key-input",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"OpenAI API Key"}),q?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:"âœ“ Configured"}),e.jsx("button",{onClick:()=>D("openai"),disabled:i,className:"text-xs text-red-600 dark:text-red-400 hover:underline disabled:opacity-50",children:"Remove"})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"openai-key-input",type:"password",value:o,onChange:a=>G(a.target.value),placeholder:"sk-...",className:`flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 ${o&&!I(o)?"border-red-300 dark:border-red-500":"border-gray-300"}`,disabled:i}),e.jsx("button",{onClick:te,disabled:i||!o.trim()||!I(o),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:i?"...":"Save"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Get your key from"," ",e.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"OpenAI Platform"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"google-key-input",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Google AI API Key"}),J?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:"âœ“ Configured"}),e.jsx("button",{onClick:()=>D("google"),disabled:i,className:"text-xs text-red-600 dark:text-red-400 hover:underline disabled:opacity-50",children:"Remove"})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"google-key-input",type:"password",value:n,onChange:a=>F(a.target.value),placeholder:"AI...",className:`flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 ${n&&!S(n)?"border-red-300 dark:border-red-500":"border-gray-300"}`,disabled:i}),e.jsx("button",{onClick:se,disabled:i||!n.trim()||!S(n),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:i?"...":"Save"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Get your key from"," ",e.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"Google AI Studio"})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex items-center justify-start gap-2 mb-2",children:e.jsx("label",{htmlFor:"provider-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"AI Provider"})}),e.jsxs("select",{id:"provider-select",value:l,onChange:a=>ae(a.target.value),className:"w-full max-w-xs p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",disabled:u,children:[e.jsx("option",{value:"openai",children:"OpenAI (GPT Models)"}),e.jsx("option",{value:"google-ai",children:"Google AI (Gemini Models)"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Current: ",V()]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-start gap-2 mb-2",children:[e.jsx("label",{htmlFor:"model-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Model"}),U(h)==="premium"&&e.jsx("span",{title:"Premium models may be more expensive",className:"cursor-help text-amber-600 dark:text-amber-400",children:"âš¡ Premium"}),U(h)==="free"&&e.jsx("span",{title:"Free tier model",className:"cursor-help text-green-600 dark:text-green-400",children:"ðŸ†“ Free"})]}),e.jsx("select",{id:"model-select",value:h,onChange:a=>ee(a.target.value),className:"w-full max-w-xs p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",disabled:u,children:_.map(a=>e.jsx("option",{value:a,children:Z(a)},a))}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 flex gap-2 mt-3",children:e.jsxs("div",{className:"flex flex-row items-start gap-5",children:[e.jsxs("button",{onClick:()=>{f||N()},disabled:u||f,className:"flex items-center justify-center gap-1 cursor-pointer text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50",title:"Refresh available models",children:[e.jsx(me,{size:16}),e.jsx("span",{children:f?"Refreshing...":"Refresh list"})]}),Y&&e.jsxs("span",{title:"Models list loaded from cache, might be outdated",className:"cursor-help flex items-center justify-center gap-1 text-blue-600 dark:text-blue-400",children:[e.jsx(xe,{size:16})," Cached models"]})]})})]}),K&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsx("p",{className:"font-bold",children:"Error:"}),e.jsx("p",{children:K}),e.jsx("button",{onClick:z,className:"cursor-pointer mt-2 text-sm hover:underline no-underline",children:"Clear Error"})]})]})}export{fe as default};
