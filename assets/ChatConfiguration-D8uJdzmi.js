import{G as Re,r as t,o as _,j as e,O as v,e as k,f as N,C as _e,s as w,p as De,q as ne,D as u,v as Le}from"./index-C_wYTZAa.js";import{u as Be,v as D,a as L,b as B,B as $e,r as oe,c as de}from"./MainContent-Cqn0ZtEA.js";function Ye(r){return Re({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"},child:[]},{tag:"path",attr:{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"},child:[]},{tag:"path",attr:{d:"M12 9l0 3"},child:[]},{tag:"path",attr:{d:"M12 15l.01 0"},child:[]}]})(r)}function qe({currentChat:r,isLoading:i,error:$,clearError:ce,onModelChange:p,onProviderChange:xe,selectedModel:g,selectedProvider:n,onUserNameChange:Y,onTitleChange:H,onTemperatureChange:X,onTestApiConnection:me}){const[A,z]=t.useState(!1),[ue,j]=t.useState(()=>{const{models:a}=_(n);return a}),[ge,I]=t.useState(!1),[o,q]=t.useState(""),[d,W]=t.useState(""),[c,fe]=t.useState("http://localhost:11434"),[pe,K]=t.useState(!1),[he,E]=t.useState(!1),[ye,O]=t.useState(!1),[l,x]=t.useState(!1),[h,J]=t.useState(r.userName??"User"),[M,Q]=t.useState(!1),[be,V]=t.useState(!1),[f,Z]=t.useState(r.title),[C,ee]=t.useState(!1),[ve,ae]=t.useState(!1),[y,te]=t.useState(r.temperature),[P,re]=t.useState(!1),[ke,se]=t.useState(!1),{getAvailableModels:T,switchProvider:Ne,getProviderDisplayName:je,getDefaultModel:Se}=Be(n),we=a=>({})[a]||a,le=a=>a.includes("gpt-4")?"premium":a.includes("gpt")?"pro":a.includes("gemini-1.5-flash")?"free":a.includes("gemini")?"pro":a.includes("llama")||a.includes("mistral")||a.includes("codellama")||a.includes("phi")||a.includes("gemma")?"free":"pro",Ae=a=>{p(a),w(a,n)},Ie=a=>{xe(a),Ne(a),De(a);const{models:s}=_(a);j(s);const m=Se();p(m),w(m,a)},S=async()=>{try{z(!0);const a=await T();if(a.length>0&&(j(a),ne(a,n),I(!1),!a.includes(g))){const s=a[0];p(s),w(s,n)}}catch(a){console.error("Failed to refresh models:",a)}finally{z(!1)}},Ke=async()=>{try{const[a,s,m]=await Promise.all([u.hasApiKey(v),u.hasApiKey(k),u.hasApiKey(N)]);K(a),E(s),O(m)}catch(a){console.error("Error checking API keys:",a)}},Ee=async()=>{if(o.trim()){if(!D(o.trim())){alert("Invalid OpenAI API key format. Keys should start with 'sk-' and be at least 40 characters long.");return}x(!0);try{await u.saveApiKey(v,o.trim()),await oe(),q(""),K(!0),await S()}catch(a){console.error("Error saving OpenAI key:",a),alert("Error saving OpenAI API key. Please try again.")}finally{x(!1)}}},Oe=async()=>{if(d.trim()){if(!L(d.trim())){alert("Invalid Google AI API key format. Keys should start with 'AI' and be at least 35 characters long.");return}x(!0);try{await u.saveApiKey(k,d.trim()),await de(),W(""),E(!0),await S()}catch(a){console.error("Error saving Google AI key:",a),alert("Error saving Google AI API key. Please try again.")}finally{x(!1)}}},Me=async()=>{if(c.trim()){if(!B(c.trim())){alert("Invalid Ollama URL format. Please enter a valid URL (e.g., http://localhost:11434).");return}x(!0);try{await u.saveApiKey(N,c.trim()),O(!0),await S()}catch(a){console.error("Error saving Ollama URL:",a),alert("Error saving Ollama URL. Please try again.")}finally{x(!1)}}},G=async a=>{x(!0);try{const s=await u.getAllApiKeys(a);for(const m of s)await u.deleteApiKey(m.id);a===v?(await oe(),K(!1)):a===k?(await de(),E(!1)):a===N&&O(!1)}catch(s){console.error(`Error removing ${a} key:`,s)}finally{x(!1)}},Ce=a=>{J(a.target.value),V(!1)},Pe=async()=>{const a=h.trim();if(!(!a||h===r.userName)){Q(!0);try{Y&&Y(a),V(!0)}finally{Q(!1)}}};let U="Save";M?U="Saving...":be&&(U="Saved");const Te=a=>{Z(a.target.value),ae(!1)},Ge=async()=>{if(!(!f.trim()||f===r.title)){ee(!0);try{H&&H(f.trim()),ae(!0)}finally{ee(!1)}}};let F="Save";C?F="Saving...":ve&&(F="Saved");const Ue=a=>{te(parseFloat(a.target.value)),se(!1)},Fe=async()=>{if(y!==r.temperature){re(!0);try{X&&X(y),se(!0)}finally{re(!1)}}};let R="Save";return P?R="Saving...":ke&&(R="Saved"),t.useEffect(()=>{(async()=>{try{const{models:s,timestamp:m}=_(n);if(!Le(m,24)&&s.length>0){j(s),I(!0);return}const b=await T();if(b.length>0&&(j(b),ne(b,n),I(!1),!b.includes(g))){const ie=b[0];p(ie),w(ie,n)}}catch(s){console.log("Could not fetch models, using cached/defaults:",s)}})()},[n,T,g,p]),t.useEffect(()=>{Ke()},[]),t.useEffect(()=>{J(r.userName??"User")},[r.userName]),t.useEffect(()=>{te(r.temperature),Z(r.title)},[r.temperature,r.title]),e.jsxs("div",{className:"w-full flex flex-col gap-3 bg-black/80 p-2 rounded-md",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("h2",{className:"text-gray-800 dark:text-gray-200",children:["Chat: ",e.jsx("b",{children:r.title})]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Temperature: ",e.jsx("b",{children:r.temperature})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"user-name-input",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Your Name"}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("input",{id:"user-name-input",type:"text",value:h,onChange:Ce,className:"flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 border-gray-300",disabled:i||M,placeholder:"Enter your name",maxLength:64}),e.jsx("button",{onClick:Pe,disabled:i||M||!h.trim()||h===r.userName,className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:U})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"chat-title-input",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Chat Title"}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("input",{id:"chat-title-input",type:"text",value:f,onChange:Te,className:"flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 border-gray-300",disabled:i||C,placeholder:"Enter a title for your chat",maxLength:128}),e.jsx("button",{onClick:Ge,disabled:i||C||!f.trim()||f===r.title,className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:F})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("label",{htmlFor:"temperature-slider",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 -mb-1 pt-1",children:["Temperature: ",y]}),e.jsxs("div",{className:"flex flex-row gap-0 items-center",children:[e.jsx("input",{id:"temperature-slider",type:"range",min:"0",max:"1",step:"0.01",value:y,onChange:Ue,className:"flex-1 max-w-xs h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 slider",disabled:i||P}),e.jsx("button",{onClick:Fe,disabled:i||P||y===r.temperature,className:"px-3 h-[34px] ml-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:R})]}),e.jsxs("div",{className:"flex max-w-xs justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("span",{children:"0 (Focused)"}),e.jsx("span",{children:".5 (Balanced)"}),e.jsx("span",{children:"1 (Creative)"})]})]})]}),e.jsxs("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 pt-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"API Key Configuration"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"OpenAI API Key"}),pe?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:"✓ Configured"}),e.jsx("button",{onClick:()=>G(v),disabled:l,className:"text-xs text-red-600 dark:text-red-400 hover:underline disabled:opacity-50",children:"Remove"})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"openai-key-input",type:"password",value:o,onChange:a=>q(a.target.value),placeholder:"sk-...",className:`flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 ${o&&!D(o)?"border-red-300 dark:border-red-500":"border-gray-300"}`,disabled:l}),e.jsx("button",{onClick:Ee,disabled:l||!o.trim()||!D(o),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:l?"...":"Save"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Get your key from"," ",e.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"OpenAI Platform"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Google AI API Key"}),he?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:"✓ Configured"}),e.jsx("button",{onClick:()=>G(k),disabled:l,className:"text-xs text-red-600 dark:text-red-400 hover:underline disabled:opacity-50",children:"Remove"})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"google-key-input",type:"password",value:d,onChange:a=>W(a.target.value),placeholder:"AI...",className:`flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 ${d&&!L(d)?"border-red-300 dark:border-red-500":"border-gray-300"}`,disabled:l}),e.jsx("button",{onClick:Oe,disabled:l||!d.trim()||!L(d),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:l?"...":"Save"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Get your key from"," ",e.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"Google AI Studio"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Ollama Server URL"}),ye?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:"✓ Configured"}),e.jsx("button",{onClick:()=>G(N),disabled:l,className:"text-xs text-red-600 dark:text-red-400 hover:underline disabled:opacity-50",children:"Remove"})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"ollama-url-input",type:"url",value:c,onChange:a=>fe(a.target.value),placeholder:"http://localhost:11434",className:`flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 ${c&&!B(c)?"border-red-300 dark:border-red-500":"border-gray-300"}`,disabled:l}),e.jsx("button",{onClick:Me,disabled:l||!c.trim()||!B(c),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:l?"...":"Save"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Local Ollama server URL. Install Ollama from"," ",e.jsx("a",{href:"https://ollama.ai",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"ollama.ai"})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex items-center justify-start gap-2 mb-2",children:e.jsx("label",{htmlFor:"provider-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"AI Provider"})}),e.jsxs("select",{id:"provider-select",value:n,onChange:a=>Ie(a.target.value),className:"w-full max-w-xs p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",disabled:i,children:[e.jsx("option",{value:v,children:"OpenAI (GPT Models)"}),e.jsx("option",{value:k,children:"Google AI (Gemini Models)"}),e.jsx("option",{value:N,children:"Ollama (Local Models)"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Current: ",je()]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-start gap-2 mb-2",children:[e.jsx("label",{htmlFor:"model-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Model"}),le(g)==="premium"&&e.jsx("span",{title:"Premium models may be more expensive",className:"cursor-help text-amber-600 dark:text-amber-400",children:"⚡ Premium"}),le(g)==="free"&&e.jsx("span",{title:"Free tier model",className:"cursor-help text-green-600 dark:text-green-400",children:"🆓 Free"})]}),e.jsx("select",{id:"model-select",value:g,onChange:a=>Ae(a.target.value),className:"w-full max-w-xs p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",disabled:i,children:ue.map(a=>e.jsx("option",{value:a,children:we(a)},a))}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 flex gap-2 mt-3",children:e.jsxs("div",{className:"flex flex-row items-start gap-5",children:[e.jsxs("button",{onClick:()=>{A||S()},disabled:i||A,className:"flex items-center justify-center gap-1 cursor-pointer text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50",title:"Refresh available models",children:[e.jsx(Ye,{size:16}),e.jsx("span",{children:A?"Refreshing...":"Refresh list"})]}),ge&&e.jsxs("span",{title:"Models list loaded from cache, might be outdated",className:"cursor-help flex items-center justify-center gap-1 text-blue-600 dark:text-blue-400",children:[e.jsx($e,{size:16})," Cached models"]})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(_e,{onClick:me,className:"bg-yellow-500 hover:bg-yellow-600 text-white",disabled:i,children:"Test API Connection"})}),$&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsx("p",{className:"font-bold",children:"Error:"}),e.jsx("p",{children:$}),e.jsx("button",{onClick:ce,className:"cursor-pointer mt-2 text-sm hover:underline no-underline",children:"Clear Error"})]})]})}export{qe as default};
