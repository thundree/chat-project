import{G as qe,r as s,e as Je,i as u,s as be,v as Pe,w as I,x as ve,j as e,h as O,O as T,f as _,C as Qe,y as Ve,D as p}from"./index-DSZp-Oju.js";import{u as Ze,v as z,a as W,b as q,c as J,B as ea,r as ke,d as Ne,e as je}from"./MainContent-D8Juc_Ko.js";function aa(r){return qe({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"},child:[]},{tag:"path",attr:{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"},child:[]},{tag:"path",attr:{d:"M12 9l0 3"},child:[]},{tag:"path",attr:{d:"M12 15l.01 0"},child:[]}]})(r)}function ra({currentChat:r,isLoading:d,error:P,clearError:Ke,onModelChange:k,onProviderChange:we,selectedModel:o,selectedProvider:l,onUserNameChange:Q,onTitleChange:V,onTemperatureChange:Z,onTestApiConnection:Se}){const[M,ee]=s.useState(!1),[w,c]=s.useState([]),[Ae,f]=s.useState(!1),[h,ae]=s.useState(""),[g,te]=s.useState(""),[x,Ee]=s.useState("http://localhost:11434"),[y,se]=s.useState(""),[re,U]=s.useState(!1),[le,F]=s.useState(!1),[ie,R]=s.useState(!1),[ne,D]=s.useState(!1),[n,m]=s.useState(!1),[S,oe]=s.useState(r.userName??"User"),[G,de]=s.useState(!1),[Ie,ce]=s.useState(!1),[N,xe]=s.useState(r.title),[$,me]=s.useState(!1),[Oe,ue]=s.useState(!1),[A,pe]=s.useState(r.temperature),[L,he]=s.useState(!1),[Te,ge]=s.useState(!1),{getAvailableModels:B,switchProvider:_e,getProviderDisplayName:Ce,hasApiKey:j}=Ze(l),{t:a}=Je(),Me=t=>({})[t]||t,ye=t=>t.includes("gpt-4")?"premium":t.includes("gpt")?"pro":t.includes("gemini-2.5-flash")?"free":t.includes("gemini")?"pro":t.includes("llama")||t.includes("mistral")||t.includes("codellama")||t.includes("phi")||t.includes("gemma")?"free":"pro",Ue=t=>{k(t),I(t,l)},fe=s.useCallback(async()=>{try{if(l!==u&&!await j()){c([]),f(!1);return}const{models:t,timestamp:i}=be(l,void 0,!0);if(!Pe(i,24)&&t.length>0){if(c(t),f(!0),!o||!t.includes(o)){const K=t[0];k(K),I(K,l)}return}const v=await B();if(v.length>0&&(c(v),ve(v,l),f(!1),!o||!v.includes(o))){const K=v[0];k(K),I(K,l)}}catch{if(l===u||await j()){const{models:i}=be(l,void 0,!0);if(i.length>0){if(c(i),f(!0),!o||!i.includes(o)){const b=i[0];k(b),I(b,l)}}else c([])}else c([])}},[l,j,B,o,k]),Fe=async t=>{we(t),_e(t),Ve(t),c([]),f(!1)},E=async()=>{try{if(l!==u&&!await j()){c([]);return}ee(!0);const t=await B();if(t.length>0&&(c(t),ve(t,l),f(!1),!t.includes(o))){const i=t[0];k(i),I(i,l)}}catch(t){console.error("Failed to refresh models:",t)}finally{ee(!1)}},Re=async()=>{try{const[t,i,b,v]=await Promise.all([p.hasApiKey(T),p.hasApiKey(_),p.hasApiKey(O),p.hasApiKey(u)]);U(t),F(i),R(b),D(v)}catch(t){console.error("Error checking API keys:",t)}},De=async()=>{if(h.trim()){if(!z(h.trim())){alert(a("apiKeys.openai.validation"));return}m(!0);try{await p.saveApiKey(T,h.trim()),await ke(),ae(""),U(!0),await E()}catch(t){console.error("Error saving OpenAI key:",t),alert(a("apiKeys.saveError"))}finally{m(!1)}}},Ge=async()=>{if(g.trim()){if(!W(g.trim())){alert(a("apiKeys.google.validation"));return}m(!0);try{await p.saveApiKey(_,g.trim()),await Ne(),te(""),F(!0),await E()}catch(t){console.error("Error saving Google AI key:",t),alert(a("apiKeys.saveError"))}finally{m(!1)}}},$e=async()=>{if(x.trim()){if(!J(x.trim())){alert(a("apiKeys.ollama.validation"));return}m(!0);try{await p.saveApiKey(O,x.trim()),R(!0),await E()}catch(t){console.error("Error saving Ollama URL:",t),alert(a("apiKeys.saveError"))}finally{m(!1)}}},Le=async()=>{if(y.trim()){if(!q(y.trim())){alert(a("apiKeys.openrouter.validation"));return}m(!0);try{await p.saveApiKey(u,y.trim()),await je(),se(""),D(!0),await E()}catch(t){console.error("Error saving OpenRouter key:",t),alert(a("apiKeys.saveError"))}finally{m(!1)}}},C=async t=>{m(!0);try{const i=await p.getAllApiKeys(t);for(const b of i)await p.deleteApiKey(b.id);t===T?(await ke(),U(!1)):t===_?(await Ne(),F(!1)):t===O?R(!1):t===u&&(await je(),D(!1))}catch(i){console.error(`Error removing ${t} key:`,i)}finally{m(!1)}},Be=t=>{oe(t.target.value),ce(!1)},He=async()=>{const t=S.trim();if(!(!t||S===r.userName)){de(!0);try{Q&&Q(t),ce(!0)}finally{de(!1)}}};let H=a("common.save");G?H=a("common.saving"):Ie&&(H=a("common.saved"));const Xe=t=>{xe(t.target.value),ue(!1)},Ye=async()=>{if(!(!N.trim()||N===r.title)){me(!0);try{V&&V(N.trim()),ue(!0)}finally{me(!1)}}};let X=a("common.save");$?X=a("common.saving"):Oe&&(X=a("common.saved"));const ze=t=>{pe(parseFloat(t.target.value)),ge(!1)},We=async()=>{if(A!==r.temperature){he(!0);try{Z&&Z(A),ge(!0)}finally{he(!1)}}};let Y=a("common.save");return L?Y=a("common.saving"):Te&&(Y=a("common.saved")),s.useEffect(()=>{fe()},[fe]),s.useEffect(()=>{Re()},[]),s.useEffect(()=>{(async()=>{l!==u&&(await j()||(c([]),f(!1)))})()},[re,le,ie,ne,l,j]),s.useEffect(()=>{oe(r.userName??"User")},[r.userName]),s.useEffect(()=>{pe(r.temperature),xe(r.title)},[r.temperature,r.title]),e.jsxs("div",{className:"w-full flex flex-col gap-3 bg-white/90 dark:bg-black/80 p-2 rounded-md",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("h2",{className:"text-gray-800 dark:text-gray-200",children:[a("chat.title"),": ",e.jsx("b",{children:r.title})]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[a("chat.temperature"),": ",e.jsx("b",{children:r.temperature})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"user-name-input",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:a("chat.userName")}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("input",{id:"user-name-input",type:"text",value:S,onChange:Be,className:"flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 border-gray-300",disabled:d||G,placeholder:a("chat.userNamePlaceholder"),maxLength:64}),e.jsx("button",{onClick:He,disabled:d||G||!S.trim()||S===r.userName,className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:H})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"chat-title-input",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:a("chat.title")}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("input",{id:"chat-title-input",type:"text",value:N,onChange:Xe,className:"flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 border-gray-300",disabled:d||$,placeholder:a("chat.titlePlaceholder"),maxLength:128}),e.jsx("button",{onClick:Ye,disabled:d||$||!N.trim()||N===r.title,className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:X})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("label",{htmlFor:"temperature-slider",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 -mb-1 pt-1",children:[a("chat.temperature"),": ",A]}),e.jsxs("div",{className:"flex flex-row gap-0 items-center",children:[e.jsx("input",{id:"temperature-slider",type:"range",min:"0",max:"1",step:"0.01",value:A,onChange:ze,className:"flex-1 max-w-xs h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 slider",disabled:d||L}),e.jsx("button",{onClick:We,disabled:d||L||A===r.temperature,className:"px-3 h-[34px] ml-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:Y})]}),e.jsxs("div",{className:"flex max-w-xs justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsxs("span",{children:["0 (",a("chat.temperatureLabels.focused"),")"]}),e.jsxs("span",{children:[".5 (",a("chat.temperatureLabels.balanced"),")"]}),e.jsxs("span",{children:["1 (",a("chat.temperatureLabels.creative"),")"]})]})]})]}),e.jsxs("div",{className:"w-full border-t border-gray-300 dark:border-gray-600 pt-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:a("apiKeys.title")}),e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:a("apiKeys.openai.title")}),re?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:a("apiKeys.configured")}),e.jsx("button",{onClick:()=>C(T),disabled:n,className:"text-xs text-red-600 dark:text-red-400 hover:underline disabled:opacity-50",children:a("common.remove")})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"openai-key-input",type:"password",value:h,onChange:t=>ae(t.target.value),placeholder:a("apiKeys.openai.placeholder"),className:`flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 ${h&&!z(h)?"border-red-300 dark:border-red-500":"border-gray-300"}`,disabled:n}),e.jsx("button",{onClick:De,disabled:n||!h.trim()||!z(h),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:n?"...":a("common.save")})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a("apiKeys.openai.description")," ",e.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:a("apiKeys.openai.link")})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:a("apiKeys.google.title")}),le?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:a("apiKeys.configured")}),e.jsx("button",{onClick:()=>C(_),disabled:n,className:"text-xs text-red-600 dark:text-red-400 hover:underline disabled:opacity-50",children:a("common.remove")})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"google-key-input",type:"password",value:g,onChange:t=>te(t.target.value),placeholder:a("apiKeys.google.placeholder"),className:`flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 ${g&&!W(g)?"border-red-300 dark:border-red-500":"border-gray-300"}`,disabled:n}),e.jsx("button",{onClick:Ge,disabled:n||!g.trim()||!W(g),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:n?"...":a("common.save")})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a("apiKeys.google.description")," ",e.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:a("apiKeys.google.link")})]})]}),e.jsxs("div",{className:"mt-4 mb-2",children:[e.jsx("span",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:a("apiKeys.openrouter.title")}),ne?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:a("apiKeys.configured")}),e.jsx("button",{onClick:()=>C(u),disabled:n,className:"text-xs text-red-600 dark:text-red-400 hover:underline disabled:opacity-50",children:a("common.remove")})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"openrouter-key-input",type:"password",value:y,onChange:t=>se(t.target.value),placeholder:a("apiKeys.openrouter.placeholder"),className:`flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 ${y&&!q(y)?"border-red-300 dark:border-red-500":"border-gray-300"}`,disabled:n}),e.jsx("button",{onClick:Le,disabled:n||!y.trim()||!q(y),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:n?"...":a("common.save")})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a("apiKeys.openrouter.description")," ",e.jsx("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:a("apiKeys.openrouter.link")}),". ",a("apiKeys.openrouter.additionalInfo")]})]}),e.jsxs("div",{className:"mt-4 mb-2",children:[e.jsxs("p",{className:"flex gap-2 text-xs font-medium text-gray-600 dark:text-gray-400 my-1",children:[a("apiKeys.ollama.title")," ",e.jsx("a",{href:x.trim(),target:"_blank",rel:"noopener noreferrer",className:"block mb-2 text-xs underline text-gray-500 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400",children:e.jsx("i",{children:x.trim()})})]}),ie?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:a("apiKeys.configured")}),e.jsx("button",{onClick:()=>C(O),disabled:n,className:"text-xs text-red-600 dark:text-red-400 hover:underline disabled:opacity-50",children:a("common.edit")})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"ollama-url-input",type:"url",value:x,onChange:t=>Ee(t.target.value),placeholder:a("apiKeys.ollama.placeholder"),className:`flex-1 max-w-xs text-xs p-2 border rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 ${x&&!J(x)?"border-red-300 dark:border-red-500":"border-gray-300"}`,disabled:n}),e.jsx("button",{onClick:$e,disabled:n||!x.trim()||!J(x),className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 w-16 cursor-pointer",children:n?"...":a("common.save")})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a("apiKeys.ollama.description")," ",e.jsx("a",{href:"https://ollama.ai",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:a("apiKeys.ollama.link")})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex items-center justify-start gap-2 mb-2",children:e.jsx("label",{htmlFor:"provider-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:a("providers.title")})}),e.jsxs("select",{id:"provider-select",value:l,onChange:t=>Fe(t.target.value),className:"w-full max-w-xs p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",disabled:d,children:[e.jsx("option",{value:O,children:a("providers.ollama")}),e.jsx("option",{value:u,children:a("providers.openrouter")}),e.jsx("option",{value:T,children:a("providers.openai")}),e.jsx("option",{value:_,children:a("providers.google")})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a("providers.current"),": ",Ce()]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-start gap-2 mb-2",children:[e.jsx("label",{htmlFor:"model-select",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:a("models.title")}),ye(o)==="premium"&&e.jsx("span",{title:a("models.tierTooltips.premium"),className:"cursor-help text-amber-600 dark:text-amber-400",children:a("models.tiers.premium")}),ye(o)==="free"&&e.jsx("span",{title:a("models.tierTooltips.free"),className:"cursor-help text-green-600 dark:text-green-400",children:a("models.tiers.free")})]}),e.jsx("select",{id:"model-select",value:o,onChange:t=>Ue(t.target.value),className:"w-full max-w-xs p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",disabled:d||w.length===0,children:w.length===0?e.jsx("option",{value:"",children:a("models.noModels")}):w.map(t=>e.jsx("option",{value:t,children:Me(t)},t))}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 flex gap-2 mt-3",children:e.jsxs("div",{className:"flex flex-row items-start gap-5",children:[w.length>0?e.jsxs("button",{onClick:()=>{M||E()},disabled:d||M,className:"flex items-center justify-center gap-1 cursor-pointer text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50",title:a("models.refreshTooltip"),children:[e.jsx(aa,{size:16}),e.jsx("span",{children:a(M?"models.refreshing":"models.refreshList")})]}):e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:a(l===u?"models.loadingModels":"models.configureApiKey")}),Ae&&w.length>0&&e.jsxs("span",{title:a("models.cachedTooltip"),className:"cursor-help flex items-center justify-center gap-1 text-blue-600 dark:text-blue-400",children:[e.jsx(ea,{size:16})," ",a("models.cachedModels")]})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Qe,{onClick:Se,disabled:d,children:a("chat.testConnection")})}),P&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsxs("p",{className:"font-bold",children:[a("common.error"),":"]}),e.jsx("p",{children:P}),e.jsx("button",{onClick:Ke,className:"cursor-pointer mt-2 text-sm hover:underline no-underline",children:a("common.close")})]})]})}export{ra as default};
