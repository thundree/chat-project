const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MessageList-BlvXstFZ.js","assets/index-Cy_ievzZ.js","assets/index-B9QCBQsn.css","assets/ChatConfiguration-C_4We7rj.js","assets/CharacterManager-CjgVCUgq.js","assets/Textarea-HqIDVir8.js","assets/CharacterSelect-CgkLg0SC.js","assets/AlertModal-Cgpf0RjE.js"])))=>i.map(i=>d[i]);
var Ml=Object.defineProperty;var Rl=(t,e,n)=>e in t?Ml(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var _o=(t,e,n)=>Rl(t,typeof e!="symbol"?e+"":e,n);import{r as H,u as wr,a as Sr,j as J,c as Pl,b as kl,g as vo,t as Yt,G as $t,d as Ar,e as Er,R as Gi,_ as Ot,D as qe,O as ae,f as Ln,h as fe,i as le,k as ue,l as Nl,m as bl,n as Dl}from"./index-Cy_ievzZ.js";const sn=H.forwardRef((t,e)=>{var r;const n=wr(),{title:i,...o}=Sr(t,(r=n.props)==null?void 0:r.tabItem);return J.jsx("div",{ref:e,...o})});sn.displayName="TabItem";const Ll=Pl({base:"flex flex-col gap-2",tablist:{base:"flex text-center",variant:{default:"flex-wrap border-b border-gray-200 dark:border-gray-700",underline:"-mb-px flex-wrap border-b border-gray-200 dark:border-gray-700",pills:"flex-wrap space-x-2 text-sm font-medium text-gray-500 dark:text-gray-400",fullWidth:"grid w-full grid-flow-col divide-x divide-gray-200 rounded-none text-sm font-medium shadow dark:divide-gray-700 dark:text-gray-400"},tabitem:{base:"flex items-center justify-center rounded-t-lg p-4 text-sm font-medium first:ml-0 focus:outline-none disabled:cursor-not-allowed disabled:text-gray-400 disabled:dark:text-gray-500",variant:{default:{base:"rounded-t-lg",active:{on:"bg-gray-100 text-primary-600 dark:bg-gray-800 dark:text-primary-500",off:"text-gray-500 hover:bg-gray-50 hover:text-gray-600 dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-gray-300"}},underline:{base:"rounded-t-lg",active:{on:"rounded-t-lg border-b-2 border-primary-600 text-primary-600 dark:border-primary-500 dark:text-primary-500",off:"border-b-2 border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300"}},pills:{base:"",active:{on:"rounded-lg bg-primary-600 text-white",off:"rounded-lg hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-white"}},fullWidth:{base:"ml-0 flex w-full rounded-none first:ml-0",active:{on:"rounded-none bg-gray-100 p-4 text-gray-900 dark:bg-gray-700 dark:text-white",off:"rounded-none bg-white hover:bg-gray-50 hover:text-gray-700 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-white"}}},icon:"mr-2 h-5 w-5"}},tabitemcontainer:{base:"",variant:{default:"",underline:"",pills:"",fullWidth:""}},tabpanel:"py-3"}),xr=H.forwardRef((t,e)=>{var M,D;const n=wr(),i=kl([Ll,(M=n.theme)==null?void 0:M.tabs,t.theme],[vo(n.clearTheme,"tabs"),t.clearTheme],[vo(n.applyTheme,"tabs"),t.applyTheme]),{children:o,className:r,onActiveTabChange:l,variant:u="default",...d}=Sr(t,(D=n.props)==null?void 0:D.tabs),c=H.useId(),f=H.useMemo(()=>H.Children.map(H.Children.toArray(o),({props:A})=>A),[o]),h=H.useRef([]),[p,m]=H.useState(Math.max(0,f.findIndex(A=>A.active))),[g,y]=H.useState(-1);function v(A){m(A),l&&l(A)}function E({target:A}){v(A),y(A)}function C({event:A,target:V}){A.key==="ArrowLeft"&&y(Math.max(0,g-1)),A.key==="ArrowRight"&&y(Math.min(f.length-1,g+1)),A.key==="Enter"&&(v(V),y(V))}const T=i.tablist.tabitem.variant[u],w=i.tabitemcontainer.variant[u];return H.useEffect(()=>{var A;(A=h.current[g])==null||A.focus()},[g]),H.useImperativeHandle(e,()=>({setActiveTab:v})),J.jsxs("div",{className:Yt(i.base,r),children:[J.jsx("div",{"aria-label":"Tabs",role:"tablist",className:Yt(i.tablist.base,i.tablist.variant[u],r),...d,children:f.map((A,V)=>J.jsxs("button",{type:"button","aria-controls":`${c}-tabpanel-${V}`,"aria-selected":V===p,className:Yt(i.tablist.tabitem.base,T.base,V===p&&T.active.on,V!==p&&!A.disabled&&T.active.off),disabled:A.disabled,id:`${c}-tab-${V}`,onClick:()=>E({target:V}),onKeyDown:R=>C({event:R,target:V}),ref:R=>{h.current[V]=R},role:"tab",tabIndex:V===g?0:-1,style:{zIndex:V===g?2:1},children:[A.icon&&J.jsx(A.icon,{className:i.tablist.tabitem.icon}),A.title]},V))}),J.jsx("div",{className:Yt(i.tabitemcontainer.base,w),children:f.map((A,V)=>J.jsx("div",{"aria-labelledby":`${c}-tab-${V}`,className:i.tabpanel,hidden:V!==p,id:`${c}-tabpanel-${V}`,role:"tabpanel",tabIndex:0,children:A.children},V))})]})});xr.displayName="Tabs";function Fl(t){return $t({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"},child:[]},{tag:"path",attr:{d:"M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6m0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5"},child:[]}]})(t)}function Nv(t){return $t({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 1c-1.573 0-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4s.875 1.755 1.904 2.223C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777C13.125 5.755 14 5.007 14 4s-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1"},child:[]},{tag:"path",attr:{d:"M2 7v-.839c.457.432 1.004.751 1.49.972C4.722 7.693 6.318 8 8 8s3.278-.307 4.51-.867c.486-.22 1.033-.54 1.49-.972V7c0 .424-.155.802-.411 1.133a4.51 4.51 0 0 0-4.815 1.843A12 12 0 0 1 8 10c-1.573 0-3.022-.289-4.096-.777C2.875 8.755 2 8.007 2 7m6.257 3.998L8 11c-1.682 0-3.278-.307-4.51-.867-.486-.22-1.033-.54-1.49-.972V10c0 1.007.875 1.755 1.904 2.223C4.978 12.711 6.427 13 8 13h.027a4.55 4.55 0 0 1 .23-2.002m-.002 3L8 14c-1.682 0-3.278-.307-4.51-.867-.486-.22-1.033-.54-1.49-.972V13c0 1.007.875 1.755 1.904 2.223C4.978 15.711 6.427 16 8 16c.536 0 1.058-.034 1.555-.097a4.5 4.5 0 0 1-1.3-1.905"},child:[]},{tag:"path",attr:{d:"M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-3.5-2a.5.5 0 0 0-.5.5v1.5a.5.5 0 0 0 1 0V11a.5.5 0 0 0-.5-.5m0 4a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"},child:[]}]})(t)}function Ul(t){return $t({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z"},child:[]}]})(t)}function bv(t){return $t({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"},child:[]}]})(t)}function Vl(t){return $t({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"},child:[]}]})(t)}const $l=Gi.lazy(()=>Ot(()=>import("./MessageList-BlvXstFZ.js"),__vite__mapDeps([0,1,2]))),Ol=Gi.lazy(()=>Ot(()=>import("./ChatConfiguration-C_4We7rj.js"),__vite__mapDeps([3,1,2]))),Bl=Gi.lazy(()=>Ot(()=>import("./CharacterManager-CjgVCUgq.js"),__vite__mapDeps([4,1,2,5])));function Gl({currentChat:t,streamingResponse:e,isLoading:n,error:i,clearError:o,onModelChange:r,onProviderChange:l,selectedModel:u,selectedProvider:d,handleGenerateResponse:c,handleValidateConnection:f,onSendMessage:h,tabsRef:p}){const{updateChat:m}=Ar(),{t:g}=Er(),y=C=>{if(t){const T={...t,userName:C};m(t.id,T)}},v=C=>{if(t){const T={...t,title:C};m(t.id,T)}},E=C=>{if(t){const T={...t,temperature:C};m(t.id,T)}};return J.jsx("div",{className:"w-full h-auto flex-1 rounded-lg shadow-lg p-2 mt-10 mb-auto",children:J.jsxs(xr,{ref:p,className:"[&>button]:cursor-pointer [&_[aria-label]]:bg-white/80 dark:[&_[aria-label]]:bg-black/60 rounded-lg gap-0","aria-label":g("tabs.chatTabsLabel"),variant:"underline",children:[J.jsx(sn,{active:!0,title:g("tabs.messages"),icon:Fl,children:J.jsx(H.Suspense,{fallback:J.jsx("div",{className:"flex items-center justify-center h-64 text-gray-600 dark:text-gray-400",children:g("tabs.loadingMessages")}),children:J.jsx($l,{messages:t.messages??[],selectedChat:t,streamingResponse:e,onSendMessage:h,onGenerateResponse:c,isLoading:n})})}),J.jsx(sn,{title:g("tabs.character"),icon:Vl,children:J.jsx(H.Suspense,{fallback:J.jsx("div",{className:"flex items-center justify-center h-64 text-gray-600 dark:text-gray-400",children:g("tabs.loadingCharacter")}),children:J.jsx(Bl,{currentChat:t})})}),J.jsx(sn,{title:g("tabs.configuration"),icon:Ul,children:J.jsx(H.Suspense,{fallback:J.jsx("div",{className:"flex items-center justify-center h-64 text-gray-600 dark:text-gray-400",children:g("tabs.loadingConfiguration")}),children:J.jsx(Ol,{onUserNameChange:y,onTitleChange:v,onTemperatureChange:E,currentChat:t,isLoading:n,error:i,clearError:o,onModelChange:r,onProviderChange:l,selectedModel:u,selectedProvider:d,onTestApiConnection:f})})})]})})}function $(t,e,n,i,o){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}function _(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}let Ir=function(){const{crypto:t}=globalThis;if(t!=null&&t.randomUUID)return Ir=t.randomUUID.bind(t),t.randomUUID();const e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,i=>(+i^n()&15>>+i/4).toString(16))};function di(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}const fi=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){const e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};class U extends Error{}class oe extends U{constructor(e,n,i,o){super(`${oe.makeMessage(e,n,i)}`),this.status=e,this.headers=o,this.requestID=o==null?void 0:o.get("x-request-id"),this.error=n;const r=n;this.code=r==null?void 0:r.code,this.param=r==null?void 0:r.param,this.type=r==null?void 0:r.type}static makeMessage(e,n,i){const o=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):i;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,n,i,o){if(!e||!o)return new Fn({message:i,cause:fi(n)});const r=n==null?void 0:n.error;return e===400?new Mr(e,r,i,o):e===401?new Rr(e,r,i,o):e===403?new Pr(e,r,i,o):e===404?new kr(e,r,i,o):e===409?new Nr(e,r,i,o):e===422?new br(e,r,i,o):e===429?new Dr(e,r,i,o):e>=500?new Lr(e,r,i,o):new oe(e,r,i,o)}}class ve extends oe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Fn extends oe{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class qi extends Fn{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Mr extends oe{}class Rr extends oe{}class Pr extends oe{}class kr extends oe{}class Nr extends oe{}class br extends oe{}class Dr extends oe{}class Lr extends oe{}class Fr extends U{constructor(){super("Could not parse response content as the length limit was reached")}}class Ur extends U{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}const ql=/^[a-z][a-z0-9+.-]*:/i,Jl=t=>ql.test(t);let he=t=>(he=Array.isArray,he(t)),Co=he;function Hl(t){return typeof t!="object"?{}:t??{}}function Wl(t){if(!t)return!0;for(const e in t)return!1;return!0}function Kl(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ei(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}const Yl=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new U(`${t} must be an integer`);if(e<0)throw new U(`${t} must be a positive integer`);return e},zl=t=>{try{return JSON.parse(t)}catch{return}},Bt=t=>new Promise(e=>setTimeout(e,t)),it="5.5.1",Zl=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Xl(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Ql=()=>{var n;const t=Xl();if(t==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":it,"X-Stainless-OS":wo(Deno.build.os),"X-Stainless-Arch":To(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((n=Deno.version)==null?void 0:n.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":it,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(t==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":it,"X-Stainless-OS":wo(globalThis.process.platform??"unknown"),"X-Stainless-Arch":To(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=jl();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":it,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":it,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function jl(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const i=n.exec(navigator.userAgent);if(i){const o=i[1]||0,r=i[2]||0,l=i[3]||0;return{browser:e,version:`${o}.${r}.${l}`}}}return null}const To=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",wo=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let So;const eu=()=>So??(So=Ql());function tu(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Vr(...t){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function $r(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return Vr({start(){},async pull(n){const{done:i,value:o}=await e.next();i?n.close():n.enqueue(o)},async cancel(){var n;await((n=e.return)==null?void 0:n.call(e))}})}function Or(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function nu(t){var i,o;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((o=(i=t[Symbol.asyncIterator]()).return)==null?void 0:o.call(i));return}const e=t.getReader(),n=e.cancel();e.releaseLock(),await n}const iu=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),Br="RFC3986",Gr=t=>String(t),Ao={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:Gr},ou="RFC1738";let hi=(t,e)=>(hi=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),hi(t,e));const Ee=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),ti=1024,su=(t,e,n,i,o)=>{if(t.length===0)return t;let r=t;if(typeof t=="symbol"?r=Symbol.prototype.toString.call(t):typeof t!="string"&&(r=String(t)),n==="iso-8859-1")return escape(r).replace(/%u[0-9a-f]{4}/gi,function(u){return"%26%23"+parseInt(u.slice(2),16)+"%3B"});let l="";for(let u=0;u<r.length;u+=ti){const d=r.length>=ti?r.slice(u,u+ti):r,c=[];for(let f=0;f<d.length;++f){let h=d.charCodeAt(f);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||o===ou&&(h===40||h===41)){c[c.length]=d.charAt(f);continue}if(h<128){c[c.length]=Ee[h];continue}if(h<2048){c[c.length]=Ee[192|h>>6]+Ee[128|h&63];continue}if(h<55296||h>=57344){c[c.length]=Ee[224|h>>12]+Ee[128|h>>6&63]+Ee[128|h&63];continue}f+=1,h=65536+((h&1023)<<10|d.charCodeAt(f)&1023),c[c.length]=Ee[240|h>>18]+Ee[128|h>>12&63]+Ee[128|h>>6&63]+Ee[128|h&63]}l+=c.join("")}return l};function ru(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function Eo(t,e){if(he(t)){const n=[];for(let i=0;i<t.length;i+=1)n.push(e(t[i]));return n}return e(t)}const qr={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},Jr=function(t,e){Array.prototype.push.apply(t,he(e)?e:[e])};let xo;const te={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:su,encodeValuesOnly:!1,format:Br,formatter:Gr,indices:!1,serializeDate(t){return(xo??(xo=Function.prototype.call.bind(Date.prototype.toISOString)))(t)},skipNulls:!1,strictNullHandling:!1};function au(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const ni={};function Hr(t,e,n,i,o,r,l,u,d,c,f,h,p,m,g,y,v,E){let C=t,T=E,w=0,M=!1;for(;(T=T.get(ni))!==void 0&&!M;){const N=T.get(t);if(w+=1,typeof N<"u"){if(N===w)throw new RangeError("Cyclic object value");M=!0}typeof T.get(ni)>"u"&&(w=0)}if(typeof c=="function"?C=c(e,C):C instanceof Date?C=p==null?void 0:p(C):n==="comma"&&he(C)&&(C=Eo(C,function(N){return N instanceof Date?p==null?void 0:p(N):N})),C===null){if(r)return d&&!y?d(e,te.encoder,v,"key",m):e;C=""}if(au(C)||ru(C)){if(d){const N=y?e:d(e,te.encoder,v,"key",m);return[(g==null?void 0:g(N))+"="+(g==null?void 0:g(d(C,te.encoder,v,"value",m)))]}return[(g==null?void 0:g(e))+"="+(g==null?void 0:g(String(C)))]}const D=[];if(typeof C>"u")return D;let A;if(n==="comma"&&he(C))y&&d&&(C=Eo(C,d)),A=[{value:C.length>0?C.join(",")||null:void 0}];else if(he(c))A=c;else{const N=Object.keys(C);A=f?N.sort(f):N}const V=u?String(e).replace(/\./g,"%2E"):String(e),R=i&&he(C)&&C.length===1?V+"[]":V;if(o&&he(C)&&C.length===0)return R+"[]";for(let N=0;N<A.length;++N){const L=A[N],Te=typeof L=="object"&&typeof L.value<"u"?L.value:C[L];if(l&&Te===null)continue;const Fe=h&&u?L.replace(/\./g,"%2E"):L,pe=he(C)?typeof n=="function"?n(R,Fe):R:R+(h?"."+Fe:"["+Fe+"]");E.set(t,w);const Ue=new WeakMap;Ue.set(ni,E),Jr(D,Hr(Te,pe,n,i,o,r,l,u,n==="comma"&&y&&he(C)?null:d,c,f,h,p,m,g,y,v,Ue))}return D}function lu(t=te){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||te.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=Br;if(typeof t.format<"u"){if(!hi(Ao,t.format))throw new TypeError("Unknown format option provided.");n=t.format}const i=Ao[n];let o=te.filter;(typeof t.filter=="function"||he(t.filter))&&(o=t.filter);let r;if(t.arrayFormat&&t.arrayFormat in qr?r=t.arrayFormat:"indices"in t?r=t.indices?"indices":"repeat":r=te.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const l=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:te.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:te.addQueryPrefix,allowDots:l,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:te.allowEmptyArrays,arrayFormat:r,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:te.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?te.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:te.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:te.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:te.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:te.encodeValuesOnly,filter:o,format:n,formatter:i,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:te.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:te.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:te.strictNullHandling}}function uu(t,e={}){let n=t;const i=lu(e);let o,r;typeof i.filter=="function"?(r=i.filter,n=r("",n)):he(i.filter)&&(r=i.filter,o=r);const l=[];if(typeof n!="object"||n===null)return"";const u=qr[i.arrayFormat],d=u==="comma"&&i.commaRoundTrip;o||(o=Object.keys(n)),i.sort&&o.sort(i.sort);const c=new WeakMap;for(let p=0;p<o.length;++p){const m=o[p];i.skipNulls&&n[m]===null||Jr(l,Hr(n[m],m,u,d,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}const f=l.join(i.delimiter);let h=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),f.length>0?h+f:""}function cu(t){let e=0;for(const o of t)e+=o.length;const n=new Uint8Array(e);let i=0;for(const o of t)n.set(o,i),i+=o.length;return n}let Io;function Ji(t){let e;return(Io??(e=new globalThis.TextEncoder,Io=e.encode.bind(e)))(t)}let Mo;function Ro(t){let e;return(Mo??(e=new globalThis.TextDecoder,Mo=e.decode.bind(e)))(t)}var ge,ye;class Un{constructor(){ge.set(this,void 0),ye.set(this,void 0),$(this,ge,new Uint8Array),$(this,ye,null)}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Ji(e):e;$(this,ge,cu([_(this,ge,"f"),n]));const i=[];let o;for(;(o=du(_(this,ge,"f"),_(this,ye,"f")))!=null;){if(o.carriage&&_(this,ye,"f")==null){$(this,ye,o.index);continue}if(_(this,ye,"f")!=null&&(o.index!==_(this,ye,"f")+1||o.carriage)){i.push(Ro(_(this,ge,"f").subarray(0,_(this,ye,"f")-1))),$(this,ge,_(this,ge,"f").subarray(_(this,ye,"f"))),$(this,ye,null);continue}const r=_(this,ye,"f")!==null?o.preceding-1:o.preceding,l=Ro(_(this,ge,"f").subarray(0,r));i.push(l),$(this,ge,_(this,ge,"f").subarray(o.index)),$(this,ye,null)}return i}flush(){return _(this,ge,"f").length?this.decode(`
`):[]}}ge=new WeakMap,ye=new WeakMap;Un.NEWLINE_CHARS=new Set([`
`,"\r"]);Un.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function du(t,e){for(let o=e??0;o<t.length;o++){if(t[o]===10)return{preceding:o,index:o+1,carriage:!1};if(t[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function fu(t){for(let i=0;i<t.length-1;i++){if(t[i]===10&&t[i+1]===10||t[i]===13&&t[i+1]===13)return i+2;if(t[i]===13&&t[i+1]===10&&i+3<t.length&&t[i+2]===13&&t[i+3]===10)return i+4}return-1}class Ie{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let i=!1;async function*o(){if(i)throw new U("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let r=!1;try{for await(const l of hu(e,n))if(!r){if(l.data.startsWith("[DONE]")){r=!0;continue}if(l.event===null||l.event.startsWith("response.")||l.event.startsWith("transcript.")){let u;try{u=JSON.parse(l.data)}catch(d){throw console.error("Could not parse message into JSON:",l.data),console.error("From chunk:",l.raw),d}if(u&&u.error)throw new oe(void 0,u.error,void 0,e.headers);yield u}else{let u;try{u=JSON.parse(l.data)}catch(d){throw console.error("Could not parse message into JSON:",l.data),console.error("From chunk:",l.raw),d}if(l.event=="error")throw new oe(void 0,u.error,u.message,void 0);yield{event:l.event,data:u}}}r=!0}catch(l){if(di(l))return;throw l}finally{r||n.abort()}}return new Ie(o,n)}static fromReadableStream(e,n){let i=!1;async function*o(){const l=new Un,u=Or(e);for await(const d of u)for(const c of l.decode(d))yield c;for(const d of l.flush())yield d}async function*r(){if(i)throw new U("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let l=!1;try{for await(const u of o())l||u&&(yield JSON.parse(u));l=!0}catch(u){if(di(u))return;throw u}finally{l||n.abort()}}return new Ie(r,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],i=this.iterator(),o=r=>({next:()=>{if(r.length===0){const l=i.next();e.push(l),n.push(l)}return r.shift()}});return[new Ie(()=>o(e),this.controller),new Ie(()=>o(n),this.controller)]}toReadableStream(){const e=this;let n;return Vr({async start(){n=e[Symbol.asyncIterator]()},async pull(i){try{const{value:o,done:r}=await n.next();if(r)return i.close();const l=Ji(JSON.stringify(o)+`
`);i.enqueue(l)}catch(o){i.error(o)}},async cancel(){var i;await((i=n.return)==null?void 0:i.call(n))}})}}async function*hu(t,e){if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new U("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new U("Attempted to iterate over a response with no body");const n=new mu,i=new Un,o=Or(t.body);for await(const r of pu(o))for(const l of i.decode(r)){const u=n.decode(l);u&&(yield u)}for(const r of i.flush()){const l=n.decode(r);l&&(yield l)}}async function*pu(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const i=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?Ji(n):n;let o=new Uint8Array(e.length+i.length);o.set(e),o.set(i,e.length),e=o;let r;for(;(r=fu(e))!==-1;)yield e.slice(0,r),e=e.slice(r)}e.length>0&&(yield e)}class mu{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,i,o]=gu(e,":");return o.startsWith(" ")&&(o=o.substring(1)),n==="event"?this.event=o:n==="data"&&this.data.push(o),null}}function gu(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}const vn={off:0,error:200,warn:300,info:400,debug:500},Po=(t,e,n)=>{if(t){if(Kl(vn,t))return t;se(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(vn))}`)}};function St(){}function zt(t,e,n){return!e||vn[t]>vn[n]?St:e[t].bind(e)}const yu={error:St,warn:St,info:St,debug:St};let ko=new WeakMap;function se(t){const e=t.logger,n=t.logLevel??"off";if(!e)return yu;const i=ko.get(e);if(i&&i[0]===n)return i[1];const o={error:zt("error",e,n),warn:zt("warn",e,n),info:zt("info",e,n),debug:zt("debug",e,n)};return ko.set(e,[n,o]),o}const We=t=>(t.options&&(t.options={...t.options},delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,n])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);async function Wr(t,e){const{response:n,requestLogID:i,retryOfRequestLogID:o,startTime:r}=e,l=await(async()=>{var h;if(e.options.stream)return se(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller):Ie.fromSSEResponse(n,e.controller);if(n.status===204)return null;if(e.options.__binaryResponse)return n;const u=n.headers.get("content-type"),d=(h=u==null?void 0:u.split(";")[0])==null?void 0:h.trim();if((d==null?void 0:d.includes("application/json"))||(d==null?void 0:d.endsWith("+json"))){const p=await n.json();return Kr(p,n)}return await n.text()})();return se(t).debug(`[${i}] response parsed`,We({retryOfRequestLogID:o,url:n.url,status:n.status,body:l,durationMs:Date.now()-r})),l}function Kr(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var At;class Vn extends Promise{constructor(e,n,i=Wr){super(o=>{o(null)}),this.responsePromise=n,this.parseResponse=i,At.set(this,void 0),$(this,At,e)}_thenUnwrap(e){return new Vn(_(this,At,"f"),this.responsePromise,async(n,i)=>Kr(e(await this.parseResponse(n,i),i),i.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(_(this,At,"f"),e))),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}At=new WeakMap;var Zt;class Yr{constructor(e,n,i,o){Zt.set(this,void 0),$(this,Zt,e),this.options=o,this.response=n,this.body=i}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new U("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await _(this,Zt,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Zt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class _u extends Vn{constructor(e,n,i){super(e,n,async(o,r)=>new i(o,r.response,await Wr(o,r),r.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}class $n extends Yr{constructor(e,n,i,o){super(e,n,i,o),this.data=i.data||[],this.object=i.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class Q extends Yr{constructor(e,n,i,o){super(e,n,i,o),this.data=i.data||[],this.has_more=i.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var i;const e=this.getPaginatedItems(),n=(i=e[e.length-1])==null?void 0:i.id;return n?{...this.options,query:{...Hl(this.options.query),after:n}}:null}}const zr=()=>{var t;if(typeof File>"u"){const{process:e}=globalThis,n=typeof((t=e==null?void 0:e.versions)==null?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function bt(t,e,n){return zr(),new File(t,e??"unknown_file",n)}function rn(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}const Zr=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",Ze=async(t,e)=>({...t,body:await Cu(t.body,e)}),No=new WeakMap;function vu(t){const e=typeof t=="function"?t:t.fetch,n=No.get(e);if(n)return n;const i=(async()=>{try{const o="Response"in e?e.Response:(await e("data:,")).constructor,r=new FormData;return r.toString()!==await new o(r).text()}catch{return!0}})();return No.set(e,i),i}const Cu=async(t,e)=>{if(!await vu(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const n=new FormData;return await Promise.all(Object.entries(t||{}).map(([i,o])=>pi(n,i,o))),n},Tu=t=>t instanceof Blob&&"name"in t,pi=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(n instanceof Response)t.append(e,bt([await n.blob()],rn(n)));else if(Zr(n))t.append(e,bt([await new Response($r(n)).blob()],rn(n)));else if(Tu(n))t.append(e,n,rn(n));else if(Array.isArray(n))await Promise.all(n.map(i=>pi(t,e+"[]",i)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([i,o])=>pi(t,`${e}[${i}]`,o)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}},Xr=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",wu=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Xr(t),Su=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function Au(t,e,n){if(zr(),t=await t,wu(t))return t instanceof File?t:bt([await t.arrayBuffer()],t.name);if(Su(t)){const o=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),bt(await mi(o),e,n)}const i=await mi(t);if(e||(e=rn(t)),!(n!=null&&n.type)){const o=i.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof o=="string"&&(n={...n,type:o})}return bt(i,e,n)}async function mi(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Xr(t))e.push(t instanceof Blob?t:await t.arrayBuffer());else if(Zr(t))for await(const i of t)e.push(...await mi(i));else{const i=(n=t==null?void 0:t.constructor)==null?void 0:n.name;throw new Error(`Unexpected data type: ${typeof t}${i?`; constructor: ${i}`:""}${Eu(t)}`)}return e}function Eu(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}class B{constructor(e){this._client=e}}function Qr(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const xu=(t=Qr)=>function(n,...i){if(n.length===1)return n[0];let o=!1;const r=n.reduce((f,h,p)=>(/[?#]/.test(h)&&(o=!0),f+h+(p===i.length?"":(o?encodeURIComponent:t)(String(i[p])))),""),l=r.split(/[?#]/,1)[0],u=[],d=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=d.exec(l))!==null;)u.push({start:c.index,length:c[0].length});if(u.length>0){let f=0;const h=u.reduce((p,m)=>{const g=" ".repeat(m.start-f),y="^".repeat(m.length);return f=m.start+m.length,p+g+y},"");throw new U(`Path parameters result in path with invalid segments:
${r}
${h}`)}return r},x=xu(Qr);let jr=class extends B{list(e,n={},i){return this._client.getAPIList(x`/chat/completions/${e}/messages`,Q,{query:n,...i})}};function Iu(t){return typeof t.parse=="function"}const Cn=t=>(t==null?void 0:t.role)==="assistant",ea=t=>(t==null?void 0:t.role)==="tool";var gi,an,ln,Et,xt,un,It,be,Mt,Tn,wn,ot,ta;class Hi{constructor(){gi.add(this),this.controller=new AbortController,an.set(this,void 0),ln.set(this,()=>{}),Et.set(this,()=>{}),xt.set(this,void 0),un.set(this,()=>{}),It.set(this,()=>{}),be.set(this,{}),Mt.set(this,!1),Tn.set(this,!1),wn.set(this,!1),ot.set(this,!1),$(this,an,new Promise((e,n)=>{$(this,ln,e,"f"),$(this,Et,n,"f")})),$(this,xt,new Promise((e,n)=>{$(this,un,e,"f"),$(this,It,n,"f")})),_(this,an,"f").catch(()=>{}),_(this,xt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},_(this,gi,"m",ta).bind(this))},0)}_connected(){this.ended||(_(this,ln,"f").call(this),this._emit("connect"))}get ended(){return _(this,Mt,"f")}get errored(){return _(this,Tn,"f")}get aborted(){return _(this,wn,"f")}abort(){this.controller.abort()}on(e,n){return(_(this,be,"f")[e]||(_(this,be,"f")[e]=[])).push({listener:n}),this}off(e,n){const i=_(this,be,"f")[e];if(!i)return this;const o=i.findIndex(r=>r.listener===n);return o>=0&&i.splice(o,1),this}once(e,n){return(_(this,be,"f")[e]||(_(this,be,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,i)=>{$(this,ot,!0),e!=="error"&&this.once("error",i),this.once(e,n)})}async done(){$(this,ot,!0),await _(this,xt,"f")}_emit(e,...n){if(_(this,Mt,"f"))return;e==="end"&&($(this,Mt,!0),_(this,un,"f").call(this));const i=_(this,be,"f")[e];if(i&&(_(this,be,"f")[e]=i.filter(o=>!o.once),i.forEach(({listener:o})=>o(...n))),e==="abort"){const o=n[0];!_(this,ot,"f")&&!(i!=null&&i.length)&&Promise.reject(o),_(this,Et,"f").call(this,o),_(this,It,"f").call(this,o),this._emit("end");return}if(e==="error"){const o=n[0];!_(this,ot,"f")&&!(i!=null&&i.length)&&Promise.reject(o),_(this,Et,"f").call(this,o),_(this,It,"f").call(this,o),this._emit("end")}}_emitFinal(){}}an=new WeakMap,ln=new WeakMap,Et=new WeakMap,xt=new WeakMap,un=new WeakMap,It=new WeakMap,be=new WeakMap,Mt=new WeakMap,Tn=new WeakMap,wn=new WeakMap,ot=new WeakMap,gi=new WeakSet,ta=function(e){if($(this,Tn,!0),e instanceof Error&&e.name==="AbortError"&&(e=new ve),e instanceof ve)return $(this,wn,!0),this._emit("abort",e);if(e instanceof U)return this._emit("error",e);if(e instanceof Error){const n=new U(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new U(String(e)))};function Wi(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function Gt(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function Mu(t,e){return!e||!na(e)?{...t,choices:t.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:Ki(t,e)}function Ki(t,e){const n=t.choices.map(i=>{var o;if(i.finish_reason==="length")throw new Fr;if(i.finish_reason==="content_filter")throw new Ur;return{...i,message:{...i.message,...i.message.tool_calls?{tool_calls:((o=i.message.tool_calls)==null?void 0:o.map(r=>Pu(e,r)))??void 0}:void 0,parsed:i.message.content&&!i.message.refusal?Ru(e,i.message.content):null}}});return{...t,choices:n}}function Ru(t,e){var n,i;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((i=t.response_format)==null?void 0:i.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function Pu(t,e){var i;const n=(i=t.tools)==null?void 0:i.find(o=>{var r;return((r=o.function)==null?void 0:r.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Gt(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function ku(t,e){var i;if(!t)return!1;const n=(i=t.tools)==null?void 0:i.find(o=>{var r;return((r=o.function)==null?void 0:r.name)===e.function.name});return Gt(n)||(n==null?void 0:n.function.strict)||!1}function na(t){var e;return Wi(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(n=>Gt(n)||n.type==="function"&&n.function.strict===!0))??!1}function Nu(t){for(const e of t??[]){if(e.type!=="function")throw new U(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new U(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var re,yi,Sn,_i,vi,Ci,ia,oa;const bu=10;class sa extends Hi{constructor(){super(...arguments),re.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var i;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(i=e.choices[0])==null?void 0:i.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),ea(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Cn(e)&&e.tool_calls)for(const i of e.tool_calls)i.type==="function"&&this._emit("functionToolCall",i.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new U("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),_(this,re,"m",yi).call(this)}async finalMessage(){return await this.done(),_(this,re,"m",Sn).call(this)}async finalFunctionToolCall(){return await this.done(),_(this,re,"m",_i).call(this)}async finalFunctionToolCallResult(){return await this.done(),_(this,re,"m",vi).call(this)}async totalUsage(){return await this.done(),_(this,re,"m",Ci).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=_(this,re,"m",Sn).call(this);n&&this._emit("finalMessage",n);const i=_(this,re,"m",yi).call(this);i&&this._emit("finalContent",i);const o=_(this,re,"m",_i).call(this);o&&this._emit("finalFunctionToolCall",o);const r=_(this,re,"m",vi).call(this);r!=null&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(l=>l.usage)&&this._emit("totalUsage",_(this,re,"m",Ci).call(this))}async _createChatCompletion(e,n,i){const o=i==null?void 0:i.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),_(this,re,"m",ia).call(this,n);const r=await e.chat.completions.create({...n,stream:!1},{...i,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Ki(r,n))}async _runChatCompletion(e,n,i){for(const o of n.messages)this._addMessage(o,!1);return await this._createChatCompletion(e,n,i)}async _runTools(e,n,i){var m,g,y;const o="tool",{tool_choice:r="auto",stream:l,...u}=n,d=typeof r!="string"&&((m=r==null?void 0:r.function)==null?void 0:m.name),{maxChatCompletions:c=bu}=i||{},f=n.tools.map(v=>{if(Gt(v)){if(!v.$callback)throw new U("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:v.$callback,name:v.function.name,description:v.function.description||"",parameters:v.function.parameters,parse:v.$parseRaw,strict:!0}}}return v}),h={};for(const v of f)v.type==="function"&&(h[v.function.name||v.function.function.name]=v.function);const p="tools"in n?f.map(v=>v.type==="function"?{type:"function",function:{name:v.function.name||v.function.function.name,parameters:v.function.parameters,description:v.function.description,strict:v.function.strict}}:v):void 0;for(const v of n.messages)this._addMessage(v,!1);for(let v=0;v<c;++v){const C=(g=(await this._createChatCompletion(e,{...u,tool_choice:r,tools:p,messages:[...this.messages]},i)).choices[0])==null?void 0:g.message;if(!C)throw new U("missing message in ChatCompletion response");if(!((y=C.tool_calls)!=null&&y.length))return;for(const T of C.tool_calls){if(T.type!=="function")continue;const w=T.id,{name:M,arguments:D}=T.function,A=h[M];if(A){if(d&&d!==M){const L=`Invalid tool_call: ${JSON.stringify(M)}. ${JSON.stringify(d)} requested. Please try again`;this._addMessage({role:o,tool_call_id:w,content:L});continue}}else{const L=`Invalid tool_call: ${JSON.stringify(M)}. Available options are: ${Object.keys(h).map(Te=>JSON.stringify(Te)).join(", ")}. Please try again`;this._addMessage({role:o,tool_call_id:w,content:L});continue}let V;try{V=Iu(A)?await A.parse(D):D}catch(L){const Te=L instanceof Error?L.message:String(L);this._addMessage({role:o,tool_call_id:w,content:Te});continue}const R=await A.function(V,this),N=_(this,re,"m",oa).call(this,R);if(this._addMessage({role:o,tool_call_id:w,content:N}),d)return}}}}re=new WeakSet,yi=function(){return _(this,re,"m",Sn).call(this).content??null},Sn=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(Cn(n))return{...n,content:n.content??null,refusal:n.refusal??null}}throw new U("stream ended without producing a ChatCompletionMessage with role=assistant")},_i=function(){var e,n;for(let i=this.messages.length-1;i>=0;i--){const o=this.messages[i];if(Cn(o)&&((e=o==null?void 0:o.tool_calls)!=null&&e.length))return(n=o.tool_calls.at(-1))==null?void 0:n.function}},vi=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(ea(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(i=>{var o;return i.role==="assistant"&&((o=i.tool_calls)==null?void 0:o.some(r=>r.type==="function"&&r.id===n.tool_call_id))}))return n.content}},Ci=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},ia=function(e){if(e.n!=null&&e.n>1)throw new U("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},oa=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Yi extends sa{static runTools(e,n,i){const o=new Yi,r={...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"runTools"}};return o._run(()=>o._runTools(e,n,r)),o}_addMessage(e,n=!0){super._addMessage(e,n),Cn(e)&&e.content&&this._emit("content",e.content)}}const ra=1,aa=2,la=4,ua=8,ca=16,da=32,fa=64,ha=128,pa=256,ma=ha|pa,ga=ca|da|ma|fa,ya=ra|aa|ga,_a=la|ua,Du=ya|_a,ne={STR:ra,NUM:aa,ARR:la,OBJ:ua,NULL:ca,BOOL:da,NAN:fa,INFINITY:ha,MINUS_INFINITY:pa,INF:ma,SPECIAL:ga,ATOM:ya,COLLECTION:_a,ALL:Du};class Lu extends Error{}class Fu extends Error{}function Uu(t,e=ne.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return Vu(t.trim(),e)}const Vu=(t,e)=>{const n=t.length;let i=0;const o=p=>{throw new Lu(`${p} at position ${i}`)},r=p=>{throw new Fu(`${p} at position ${i}`)},l=()=>(h(),i>=n&&o("Unexpected end of input"),t[i]==='"'?u():t[i]==="{"?d():t[i]==="["?c():t.substring(i,i+4)==="null"||ne.NULL&e&&n-i<4&&"null".startsWith(t.substring(i))?(i+=4,null):t.substring(i,i+4)==="true"||ne.BOOL&e&&n-i<4&&"true".startsWith(t.substring(i))?(i+=4,!0):t.substring(i,i+5)==="false"||ne.BOOL&e&&n-i<5&&"false".startsWith(t.substring(i))?(i+=5,!1):t.substring(i,i+8)==="Infinity"||ne.INFINITY&e&&n-i<8&&"Infinity".startsWith(t.substring(i))?(i+=8,1/0):t.substring(i,i+9)==="-Infinity"||ne.MINUS_INFINITY&e&&1<n-i&&n-i<9&&"-Infinity".startsWith(t.substring(i))?(i+=9,-1/0):t.substring(i,i+3)==="NaN"||ne.NAN&e&&n-i<3&&"NaN".startsWith(t.substring(i))?(i+=3,NaN):f()),u=()=>{const p=i;let m=!1;for(i++;i<n&&(t[i]!=='"'||m&&t[i-1]==="\\");)m=t[i]==="\\"?!m:!1,i++;if(t.charAt(i)=='"')try{return JSON.parse(t.substring(p,++i-Number(m)))}catch(g){r(String(g))}else if(ne.STR&e)try{return JSON.parse(t.substring(p,i-Number(m))+'"')}catch{return JSON.parse(t.substring(p,t.lastIndexOf("\\"))+'"')}o("Unterminated string literal")},d=()=>{i++,h();const p={};try{for(;t[i]!=="}";){if(h(),i>=n&&ne.OBJ&e)return p;const m=u();h(),i++;try{const g=l();Object.defineProperty(p,m,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if(ne.OBJ&e)return p;throw g}h(),t[i]===","&&i++}}catch{if(ne.OBJ&e)return p;o("Expected '}' at end of object")}return i++,p},c=()=>{i++;const p=[];try{for(;t[i]!=="]";)p.push(l()),h(),t[i]===","&&i++}catch{if(ne.ARR&e)return p;o("Expected ']' at end of array")}return i++,p},f=()=>{if(i===0){t==="-"&&ne.NUM&e&&o("Not sure what '-' is");try{return JSON.parse(t)}catch(m){if(ne.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}r(String(m))}}const p=i;for(t[i]==="-"&&i++;t[i]&&!",]}".includes(t[i]);)i++;i==n&&!(ne.NUM&e)&&o("Unterminated number literal");try{return JSON.parse(t.substring(p,i))}catch{t.substring(p,i)==="-"&&ne.NUM&e&&o("Not sure what '-' is");try{return JSON.parse(t.substring(p,t.lastIndexOf("e")))}catch(g){r(String(g))}}},h=()=>{for(;i<n&&` 
\r	`.includes(t[i]);)i++};return l()},bo=t=>Uu(t,ne.ALL^ne.NUM);var ee,Ne,et,Ve,ii,Xt,oi,si,ri,Qt,ai,Do;class Ut extends sa{constructor(e){super(),ee.add(this),Ne.set(this,void 0),et.set(this,void 0),Ve.set(this,void 0),$(this,Ne,e),$(this,et,[])}get currentChatCompletionSnapshot(){return _(this,Ve,"f")}static fromReadableStream(e){const n=new Ut(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,i){const o=new Ut(n);return o._run(()=>o._runChatCompletion(e,{...n,stream:!0},{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createChatCompletion(e,n,i){var l;super._createChatCompletion;const o=i==null?void 0:i.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),_(this,ee,"m",ii).call(this);const r=await e.chat.completions.create({...n,stream:!0},{...i,signal:this.controller.signal});this._connected();for await(const u of r)_(this,ee,"m",oi).call(this,u);if((l=r.controller.signal)!=null&&l.aborted)throw new ve;return this._addChatCompletion(_(this,ee,"m",Qt).call(this))}async _fromReadableStream(e,n){var l;const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),_(this,ee,"m",ii).call(this),this._connected();const o=Ie.fromReadableStream(e,this.controller);let r;for await(const u of o)r&&r!==u.id&&this._addChatCompletion(_(this,ee,"m",Qt).call(this)),_(this,ee,"m",oi).call(this,u),r=u.id;if((l=o.controller.signal)!=null&&l.aborted)throw new ve;return this._addChatCompletion(_(this,ee,"m",Qt).call(this))}[(Ne=new WeakMap,et=new WeakMap,Ve=new WeakMap,ee=new WeakSet,ii=function(){this.ended||$(this,Ve,void 0)},Xt=function(n){let i=_(this,et,"f")[n.index];return i||(i={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},_(this,et,"f")[n.index]=i,i)},oi=function(n){var o,r,l,u,d,c,f,h,p,m,g,y,v,E,C;if(this.ended)return;const i=_(this,ee,"m",Do).call(this,n);this._emit("chunk",n,i);for(const T of n.choices){const w=i.choices[T.index];T.delta.content!=null&&((o=w.message)==null?void 0:o.role)==="assistant"&&((r=w.message)!=null&&r.content)&&(this._emit("content",T.delta.content,w.message.content),this._emit("content.delta",{delta:T.delta.content,snapshot:w.message.content,parsed:w.message.parsed})),T.delta.refusal!=null&&((l=w.message)==null?void 0:l.role)==="assistant"&&((u=w.message)!=null&&u.refusal)&&this._emit("refusal.delta",{delta:T.delta.refusal,snapshot:w.message.refusal}),((d=T.logprobs)==null?void 0:d.content)!=null&&((c=w.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=T.logprobs)==null?void 0:f.content,snapshot:((h=w.logprobs)==null?void 0:h.content)??[]}),((p=T.logprobs)==null?void 0:p.refusal)!=null&&((m=w.message)==null?void 0:m.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(g=T.logprobs)==null?void 0:g.refusal,snapshot:((y=w.logprobs)==null?void 0:y.refusal)??[]});const M=_(this,ee,"m",Xt).call(this,w);w.finish_reason&&(_(this,ee,"m",ri).call(this,w),M.current_tool_call_index!=null&&_(this,ee,"m",si).call(this,w,M.current_tool_call_index));for(const D of T.delta.tool_calls??[])M.current_tool_call_index!==D.index&&(_(this,ee,"m",ri).call(this,w),M.current_tool_call_index!=null&&_(this,ee,"m",si).call(this,w,M.current_tool_call_index)),M.current_tool_call_index=D.index;for(const D of T.delta.tool_calls??[]){const A=(v=w.message.tool_calls)==null?void 0:v[D.index];A!=null&&A.type&&((A==null?void 0:A.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(E=A.function)==null?void 0:E.name,index:D.index,arguments:A.function.arguments,parsed_arguments:A.function.parsed_arguments,arguments_delta:((C=D.function)==null?void 0:C.arguments)??""}):(A==null||A.type,void 0))}}},si=function(n,i){var l,u,d;if(_(this,ee,"m",Xt).call(this,n).done_tool_calls.has(i))return;const r=(l=n.message.tool_calls)==null?void 0:l[i];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if(r.type==="function"){const c=(d=(u=_(this,Ne,"f"))==null?void 0:u.tools)==null?void 0:d.find(f=>f.type==="function"&&f.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:i,arguments:r.function.arguments,parsed_arguments:Gt(c)?c.$parseRaw(r.function.arguments):c!=null&&c.function.strict?JSON.parse(r.function.arguments):null})}else r.type},ri=function(n){var o,r;const i=_(this,ee,"m",Xt).call(this,n);if(n.message.content&&!i.content_done){i.content_done=!0;const l=_(this,ee,"m",ai).call(this);this._emit("content.done",{content:n.message.content,parsed:l?l.$parseRaw(n.message.content):null})}n.message.refusal&&!i.refusal_done&&(i.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(o=n.logprobs)!=null&&o.content&&!i.logprobs_content_done&&(i.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(r=n.logprobs)!=null&&r.refusal&&!i.logprobs_refusal_done&&(i.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},Qt=function(){if(this.ended)throw new U("stream has ended, this shouldn't happen");const n=_(this,Ve,"f");if(!n)throw new U("request ended without sending any chunks");return $(this,Ve,void 0),$(this,et,[]),$u(n,_(this,Ne,"f"))},ai=function(){var i;const n=(i=_(this,Ne,"f"))==null?void 0:i.response_format;return Wi(n)?n:null},Do=function(n){var i,o,r,l;let u=_(this,Ve,"f");const{choices:d,...c}=n;u?Object.assign(u,c):u=$(this,Ve,{...c,choices:[]});for(const{delta:f,finish_reason:h,index:p,logprobs:m=null,...g}of n.choices){let y=u.choices[p];if(y||(y=u.choices[p]={finish_reason:h,index:p,message:{},logprobs:m,...g}),m)if(!y.logprobs)y.logprobs=Object.assign({},m);else{const{content:D,refusal:A,...V}=m;Object.assign(y.logprobs,V),D&&((i=y.logprobs).content??(i.content=[]),y.logprobs.content.push(...D)),A&&((o=y.logprobs).refusal??(o.refusal=[]),y.logprobs.refusal.push(...A))}if(h&&(y.finish_reason=h,_(this,Ne,"f")&&na(_(this,Ne,"f")))){if(h==="length")throw new Fr;if(h==="content_filter")throw new Ur}if(Object.assign(y,g),!f)continue;const{content:v,refusal:E,function_call:C,role:T,tool_calls:w,...M}=f;if(Object.assign(y.message,M),E&&(y.message.refusal=(y.message.refusal||"")+E),T&&(y.message.role=T),C&&(y.message.function_call?(C.name&&(y.message.function_call.name=C.name),C.arguments&&((r=y.message.function_call).arguments??(r.arguments=""),y.message.function_call.arguments+=C.arguments)):y.message.function_call=C),v&&(y.message.content=(y.message.content||"")+v,!y.message.refusal&&_(this,ee,"m",ai).call(this)&&(y.message.parsed=bo(y.message.content))),w){y.message.tool_calls||(y.message.tool_calls=[]);for(const{index:D,id:A,type:V,function:R,...N}of w){const L=(l=y.message.tool_calls)[D]??(l[D]={});Object.assign(L,N),A&&(L.id=A),V&&(L.type=V),R&&(L.function??(L.function={name:R.name??"",arguments:""})),R!=null&&R.name&&(L.function.name=R.name),R!=null&&R.arguments&&(L.function.arguments+=R.arguments,ku(_(this,Ne,"f"),L)&&(L.function.parsed_arguments=bo(L.function.arguments)))}}}return u},Symbol.asyncIterator)](){const e=[],n=[];let i=!1;return this.on("chunk",o=>{const r=n.shift();r?r.resolve(o):e.push(o)}),this.on("end",()=>{i=!0;for(const o of n)o.resolve(void 0);n.length=0}),this.on("abort",o=>{i=!0;for(const r of n)r.reject(o);n.length=0}),this.on("error",o=>{i=!0;for(const r of n)r.reject(o);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:i?{value:void 0,done:!0}:new Promise((r,l)=>n.push({resolve:r,reject:l})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ie(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function $u(t,e){const{id:n,choices:i,created:o,model:r,system_fingerprint:l,...u}=t,d={...u,id:n,choices:i.map(({message:c,finish_reason:f,index:h,logprobs:p,...m})=>{if(!f)throw new U(`missing finish_reason for choice ${h}`);const{content:g=null,function_call:y,tool_calls:v,...E}=c,C=c.role;if(!C)throw new U(`missing role for choice ${h}`);if(y){const{arguments:T,name:w}=y;if(T==null)throw new U(`missing function_call.arguments for choice ${h}`);if(!w)throw new U(`missing function_call.name for choice ${h}`);return{...m,message:{content:g,function_call:{arguments:T,name:w},role:C,refusal:c.refusal??null},finish_reason:f,index:h,logprobs:p}}return v?{...m,index:h,finish_reason:f,logprobs:p,message:{...E,role:C,content:g,refusal:c.refusal??null,tool_calls:v.map((T,w)=>{const{function:M,type:D,id:A,...V}=T,{arguments:R,name:N,...L}=M||{};if(A==null)throw new U(`missing choices[${h}].tool_calls[${w}].id
${jt(t)}`);if(D==null)throw new U(`missing choices[${h}].tool_calls[${w}].type
${jt(t)}`);if(N==null)throw new U(`missing choices[${h}].tool_calls[${w}].function.name
${jt(t)}`);if(R==null)throw new U(`missing choices[${h}].tool_calls[${w}].function.arguments
${jt(t)}`);return{...V,id:A,type:D,function:{...L,name:N,arguments:R}}})}}:{...m,message:{...E,content:g,role:C,refusal:c.refusal??null},finish_reason:f,index:h,logprobs:p}}),created:o,model:r,object:"chat.completion",...l?{system_fingerprint:l}:{}};return Mu(d,e)}function jt(t){return JSON.stringify(t)}class An extends Ut{static fromReadableStream(e){const n=new An(null);return n._run(()=>n._fromReadableStream(e)),n}static runTools(e,n,i){const o=new An(n),r={...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"runTools"}};return o._run(()=>o._runTools(e,n,r)),o}}let zi=class extends B{constructor(){super(...arguments),this.messages=new jr(this._client)}create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}retrieve(e,n){return this._client.get(x`/chat/completions/${e}`,n)}update(e,n,i){return this._client.post(x`/chat/completions/${e}`,{body:n,...i})}list(e={},n){return this._client.getAPIList("/chat/completions",Q,{query:e,...n})}delete(e,n){return this._client.delete(x`/chat/completions/${e}`,n)}parse(e,n){return Nu(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(i=>Ki(i,e))}runTools(e,n){return e.stream?An.runTools(this._client,e,n):Yi.runTools(this._client,e,n)}stream(e,n){return Ut.createChatCompletion(this._client,e,n)}};zi.Messages=jr;let Zi=class extends B{constructor(){super(...arguments),this.completions=new zi(this._client)}};Zi.Completions=zi;const va=Symbol("brand.privateNullableHeaders");function*Ou(t){if(!t)return;if(va in t){const{values:i,nulls:o}=t;yield*i.entries();for(const r of o)yield[r,null];return}let e=!1,n;t instanceof Headers?n=t.entries():Co(t)?n=t:(e=!0,n=Object.entries(t??{}));for(let i of n){const o=i[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");const r=Co(i[1])?i[1]:[i[1]];let l=!1;for(const u of r)u!==void 0&&(e&&!l&&(l=!0,yield[o,null]),yield[o,u])}}const b=t=>{const e=new Headers,n=new Set;for(const i of t){const o=new Set;for(const[r,l]of Ou(i)){const u=r.toLowerCase();o.has(u)||(e.delete(r),o.add(u)),l===null?(e.delete(r),n.add(u)):(e.append(r,l),n.delete(u))}}return{[va]:!0,values:e,nulls:n}};class Ca extends B{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:b([{Accept:"application/octet-stream"},n==null?void 0:n.headers]),__binaryResponse:!0})}}class Ta extends B{create(e,n){return this._client.post("/audio/transcriptions",Ze({body:e,...n,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class wa extends B{create(e,n){return this._client.post("/audio/translations",Ze({body:e,...n,__metadata:{model:e.model}},this._client))}}class qt extends B{constructor(){super(...arguments),this.transcriptions=new Ta(this._client),this.translations=new wa(this._client),this.speech=new Ca(this._client)}}qt.Transcriptions=Ta;qt.Translations=wa;qt.Speech=Ca;class Sa extends B{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(x`/batches/${e}`,n)}list(e={},n){return this._client.getAPIList("/batches",Q,{query:e,...n})}cancel(e,n){return this._client.post(x`/batches/${e}/cancel`,n)}}class Aa extends B{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,n){return this._client.get(x`/assistants/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,n,i){return this._client.post(x`/assistants/${e}`,{body:n,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}list(e={},n){return this._client.getAPIList("/assistants",Q,{query:e,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,n){return this._client.delete(x`/assistants/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class Ea extends B{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class xa extends B{create(e,n){return this._client.post("/realtime/transcription_sessions",{body:e,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class On extends B{constructor(){super(...arguments),this.sessions=new Ea(this._client),this.transcriptionSessions=new xa(this._client)}}On.Sessions=Ea;On.TranscriptionSessions=xa;class Ia extends B{create(e,n,i){return this._client.post(x`/threads/${e}/messages`,{body:n,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}retrieve(e,n,i){const{thread_id:o}=n;return this._client.get(x`/threads/${o}/messages/${e}`,{...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}update(e,n,i){const{thread_id:o,...r}=n;return this._client.post(x`/threads/${o}/messages/${e}`,{body:r,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}list(e,n={},i){return this._client.getAPIList(x`/threads/${e}/messages`,Q,{query:n,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}delete(e,n,i){const{thread_id:o}=n;return this._client.delete(x`/threads/${o}/messages/${e}`,{...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}}class Ma extends B{retrieve(e,n,i){const{thread_id:o,run_id:r,...l}=n;return this._client.get(x`/threads/${o}/runs/${r}/steps/${e}`,{query:l,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}list(e,n,i){const{thread_id:o,...r}=n;return this._client.getAPIList(x`/threads/${o}/runs/${e}/steps`,Q,{query:r,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}}const Bu=t=>{if(typeof Buffer<"u"){const e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(t),n=e.length,i=new Uint8Array(n);for(let o=0;o<n;o++)i[o]=e.charCodeAt(o);return Array.from(new Float32Array(i.buffer))}};var li={};const Tt=t=>{var e,n,i,o;if(typeof globalThis.process<"u")return((e=li==null?void 0:li[t])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(o=(i=(n=globalThis.Deno.env)==null?void 0:n.get)==null?void 0:i.call(n,t))==null?void 0:o.trim()};var ie,Ye,Ti,xe,cn,Se,ze,rt,Ke,En,_e,dn,fn,Dt,Rt,Pt,Lo,Fo,Uo,Vo,$o,Oo,Bo;class Lt extends Hi{constructor(){super(...arguments),ie.add(this),Ti.set(this,[]),xe.set(this,{}),cn.set(this,{}),Se.set(this,void 0),ze.set(this,void 0),rt.set(this,void 0),Ke.set(this,void 0),En.set(this,void 0),_e.set(this,void 0),dn.set(this,void 0),fn.set(this,void 0),Dt.set(this,void 0)}[(Ti=new WeakMap,xe=new WeakMap,cn=new WeakMap,Se=new WeakMap,ze=new WeakMap,rt=new WeakMap,Ke=new WeakMap,En=new WeakMap,_e=new WeakMap,dn=new WeakMap,fn=new WeakMap,Dt=new WeakMap,ie=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let i=!1;return this.on("event",o=>{const r=n.shift();r?r.resolve(o):e.push(o)}),this.on("end",()=>{i=!0;for(const o of n)o.resolve(void 0);n.length=0}),this.on("abort",o=>{i=!0;for(const r of n)r.reject(o);n.length=0}),this.on("error",o=>{i=!0;for(const r of n)r.reject(o);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:i?{value:void 0,done:!0}:new Promise((r,l)=>n.push({resolve:r,reject:l})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new Ye;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var r;const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),this._connected();const o=Ie.fromReadableStream(e,this.controller);for await(const l of o)_(this,ie,"m",Rt).call(this,l);if((r=o.controller.signal)!=null&&r.aborted)throw new ve;return this._addRun(_(this,ie,"m",Pt).call(this))}toReadableStream(){return new Ie(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,i,o){const r=new Ye;return r._run(()=>r._runToolAssistantStream(e,n,i,{...o,headers:{...o==null?void 0:o.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,n,i,o){var d;const r=o==null?void 0:o.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const l={...i,stream:!0},u=await e.submitToolOutputs(n,l,{...o,signal:this.controller.signal});this._connected();for await(const c of u)_(this,ie,"m",Rt).call(this,c);if((d=u.controller.signal)!=null&&d.aborted)throw new ve;return this._addRun(_(this,ie,"m",Pt).call(this))}static createThreadAssistantStream(e,n,i){const o=new Ye;return o._run(()=>o._threadAssistantStream(e,n,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),o}static createAssistantStream(e,n,i,o){const r=new Ye;return r._run(()=>r._runAssistantStream(e,n,i,{...o,headers:{...o==null?void 0:o.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return _(this,dn,"f")}currentRun(){return _(this,fn,"f")}currentMessageSnapshot(){return _(this,Se,"f")}currentRunStepSnapshot(){return _(this,Dt,"f")}async finalRunSteps(){return await this.done(),Object.values(_(this,xe,"f"))}async finalMessages(){return await this.done(),Object.values(_(this,cn,"f"))}async finalRun(){if(await this.done(),!_(this,ze,"f"))throw Error("Final run was not received.");return _(this,ze,"f")}async _createThreadAssistantStream(e,n,i){var u;const o=i==null?void 0:i.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const r={...n,stream:!0},l=await e.createAndRun(r,{...i,signal:this.controller.signal});this._connected();for await(const d of l)_(this,ie,"m",Rt).call(this,d);if((u=l.controller.signal)!=null&&u.aborted)throw new ve;return this._addRun(_(this,ie,"m",Pt).call(this))}async _createAssistantStream(e,n,i,o){var d;const r=o==null?void 0:o.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const l={...i,stream:!0},u=await e.create(n,l,{...o,signal:this.controller.signal});this._connected();for await(const c of u)_(this,ie,"m",Rt).call(this,c);if((d=u.controller.signal)!=null&&d.aborted)throw new ve;return this._addRun(_(this,ie,"m",Pt).call(this))}static accumulateDelta(e,n){for(const[i,o]of Object.entries(n)){if(!e.hasOwnProperty(i)){e[i]=o;continue}let r=e[i];if(r==null){e[i]=o;continue}if(i==="index"||i==="type"){e[i]=o;continue}if(typeof r=="string"&&typeof o=="string")r+=o;else if(typeof r=="number"&&typeof o=="number")r+=o;else if(ei(r)&&ei(o))r=this.accumulateDelta(r,o);else if(Array.isArray(r)&&Array.isArray(o)){if(r.every(l=>typeof l=="string"||typeof l=="number")){r.push(...o);continue}for(const l of o){if(!ei(l))throw new Error(`Expected array delta entry to be an object but got: ${l}`);const u=l.index;if(u==null)throw console.error(l),new Error("Expected array delta entry to have an `index` property");if(typeof u!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${u}`);const d=r[u];d==null?r.push(l):r[u]=this.accumulateDelta(d,l)}continue}else throw Error(`Unhandled record type: ${i}, deltaValue: ${o}, accValue: ${r}`);e[i]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,n,i){return await this._createThreadAssistantStream(n,e,i)}async _runAssistantStream(e,n,i,o){return await this._createAssistantStream(n,e,i,o)}async _runToolAssistantStream(e,n,i,o){return await this._createToolAssistantStream(n,e,i,o)}}Ye=Lt,Rt=function(e){if(!this.ended)switch($(this,dn,e),_(this,ie,"m",Uo).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":_(this,ie,"m",Bo).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":_(this,ie,"m",Fo).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":_(this,ie,"m",Lo).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Pt=function(){if(this.ended)throw new U("stream has ended, this shouldn't happen");if(!_(this,ze,"f"))throw Error("Final run has not been received");return _(this,ze,"f")},Lo=function(e){const[n,i]=_(this,ie,"m",$o).call(this,e,_(this,Se,"f"));$(this,Se,n),_(this,cn,"f")[n.id]=n;for(const o of i){const r=n.content[o.index];(r==null?void 0:r.type)=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const o of e.data.delta.content){if(o.type=="text"&&o.text){let r=o.text,l=n.content[o.index];if(l&&l.type=="text")this._emit("textDelta",r,l.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(o.index!=_(this,rt,"f")){if(_(this,Ke,"f"))switch(_(this,Ke,"f").type){case"text":this._emit("textDone",_(this,Ke,"f").text,_(this,Se,"f"));break;case"image_file":this._emit("imageFileDone",_(this,Ke,"f").image_file,_(this,Se,"f"));break}$(this,rt,o.index)}$(this,Ke,n.content[o.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(_(this,rt,"f")!==void 0){const o=e.data.content[_(this,rt,"f")];if(o)switch(o.type){case"image_file":this._emit("imageFileDone",o.image_file,_(this,Se,"f"));break;case"text":this._emit("textDone",o.text,_(this,Se,"f"));break}}_(this,Se,"f")&&this._emit("messageDone",e.data),$(this,Se,void 0)}},Fo=function(e){const n=_(this,ie,"m",Vo).call(this,e);switch($(this,Dt,n),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const i=e.data.delta;if(i.step_details&&i.step_details.type=="tool_calls"&&i.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const r of i.step_details.tool_calls)r.index==_(this,En,"f")?this._emit("toolCallDelta",r,n.step_details.tool_calls[r.index]):(_(this,_e,"f")&&this._emit("toolCallDone",_(this,_e,"f")),$(this,En,r.index),$(this,_e,n.step_details.tool_calls[r.index]),_(this,_e,"f")&&this._emit("toolCallCreated",_(this,_e,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":$(this,Dt,void 0),e.data.step_details.type=="tool_calls"&&_(this,_e,"f")&&(this._emit("toolCallDone",_(this,_e,"f")),$(this,_e,void 0)),this._emit("runStepDone",e.data,n);break}},Uo=function(e){_(this,Ti,"f").push(e),this._emit("event",e)},Vo=function(e){switch(e.event){case"thread.run.step.created":return _(this,xe,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=_(this,xe,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let i=e.data;if(i.delta){const o=Ye.accumulateDelta(n,i.delta);_(this,xe,"f")[e.data.id]=o}return _(this,xe,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":_(this,xe,"f")[e.data.id]=e.data;break}if(_(this,xe,"f")[e.data.id])return _(this,xe,"f")[e.data.id];throw new Error("No snapshot available")},$o=function(e,n){let i=[];switch(e.event){case"thread.message.created":return[e.data,i];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let o=e.data;if(o.delta.content)for(const r of o.delta.content)if(r.index in n.content){let l=n.content[r.index];n.content[r.index]=_(this,ie,"m",Oo).call(this,r,l)}else n.content[r.index]=r,i.push(r);return[n,i];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,i];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Oo=function(e,n){return Ye.accumulateDelta(n,e)},Bo=function(e){switch($(this,fn,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":$(this,ze,e.data),_(this,_e,"f")&&(this._emit("toolCallDone",_(this,_e,"f")),$(this,_e,void 0));break}};let Xi=class extends B{constructor(){super(...arguments),this.steps=new Ma(this._client)}create(e,n,i){const{include:o,...r}=n;return this._client.post(x`/threads/${e}/runs`,{query:{include:o},body:r,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers]),stream:n.stream??!1})}retrieve(e,n,i){const{thread_id:o}=n;return this._client.get(x`/threads/${o}/runs/${e}`,{...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}update(e,n,i){const{thread_id:o,...r}=n;return this._client.post(x`/threads/${o}/runs/${e}`,{body:r,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}list(e,n={},i){return this._client.getAPIList(x`/threads/${e}/runs`,Q,{query:n,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}cancel(e,n,i){const{thread_id:o}=n;return this._client.post(x`/threads/${o}/runs/${e}/cancel`,{...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}async createAndPoll(e,n,i){const o=await this.create(e,n,i);return await this.poll(o.id,{thread_id:e},i)}createAndStream(e,n,i){return Lt.createAssistantStream(e,this._client.beta.threads.runs,n,i)}async poll(e,n,i){var r;const o=b([i==null?void 0:i.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((r=i==null?void 0:i.pollIntervalMs)==null?void 0:r.toString())??void 0}]);for(;;){const{data:l,response:u}=await this.retrieve(e,n,{...i,headers:{...i==null?void 0:i.headers,...o}}).withResponse();switch(l.status){case"queued":case"in_progress":case"cancelling":let d=5e3;if(i!=null&&i.pollIntervalMs)d=i.pollIntervalMs;else{const c=u.headers.get("openai-poll-after-ms");if(c){const f=parseInt(c);isNaN(f)||(d=f)}}await Bt(d);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return l}}}stream(e,n,i){return Lt.createAssistantStream(e,this._client.beta.threads.runs,n,i)}submitToolOutputs(e,n,i){const{thread_id:o,...r}=n;return this._client.post(x`/threads/${o}/runs/${e}/submit_tool_outputs`,{body:r,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers]),stream:n.stream??!1})}async submitToolOutputsAndPoll(e,n,i){const o=await this.submitToolOutputs(e,n,i);return await this.poll(o.id,n,i)}submitToolOutputsStream(e,n,i){return Lt.createToolAssistantStream(e,this._client.beta.threads.runs,n,i)}};Xi.Steps=Ma;class Bn extends B{constructor(){super(...arguments),this.runs=new Xi(this._client),this.messages=new Ia(this._client)}create(e={},n){return this._client.post("/threads",{body:e,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,n){return this._client.get(x`/threads/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,n,i){return this._client.post(x`/threads/${e}`,{body:n,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}delete(e,n){return this._client.delete(x`/threads/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:e.stream??!1})}async createAndRunPoll(e,n){const i=await this.createAndRun(e,n);return await this.runs.poll(i.id,{thread_id:i.thread_id},n)}createAndRunStream(e,n){return Lt.createThreadAssistantStream(e,this._client.beta.threads,n)}}Bn.Runs=Xi;Bn.Messages=Ia;class Jt extends B{constructor(){super(...arguments),this.realtime=new On(this._client),this.assistants=new Aa(this._client),this.threads=new Bn(this._client)}}Jt.Realtime=On;Jt.Assistants=Aa;Jt.Threads=Bn;class Ra extends B{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}class Pa extends B{retrieve(e,n,i){const{container_id:o}=n;return this._client.get(x`/containers/${o}/files/${e}/content`,{...i,headers:b([{Accept:"application/binary"},i==null?void 0:i.headers]),__binaryResponse:!0})}}let Qi=class extends B{constructor(){super(...arguments),this.content=new Pa(this._client)}create(e,n,i){return this._client.post(x`/containers/${e}/files`,Ze({body:n,...i},this._client))}retrieve(e,n,i){const{container_id:o}=n;return this._client.get(x`/containers/${o}/files/${e}`,i)}list(e,n={},i){return this._client.getAPIList(x`/containers/${e}/files`,Q,{query:n,...i})}delete(e,n,i){const{container_id:o}=n;return this._client.delete(x`/containers/${o}/files/${e}`,{...i,headers:b([{Accept:"*/*"},i==null?void 0:i.headers])})}};Qi.Content=Pa;class ji extends B{constructor(){super(...arguments),this.files=new Qi(this._client)}create(e,n){return this._client.post("/containers",{body:e,...n})}retrieve(e,n){return this._client.get(x`/containers/${e}`,n)}list(e={},n){return this._client.getAPIList("/containers",Q,{query:e,...n})}delete(e,n){return this._client.delete(x`/containers/${e}`,{...n,headers:b([{Accept:"*/*"},n==null?void 0:n.headers])})}}ji.Files=Qi;class ka extends B{create(e,n){const i=!!e.encoding_format;let o=i?e.encoding_format:"base64";i&&se(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const r=this._client.post("/embeddings",{body:{...e,encoding_format:o},...n});return i?r:(se(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(l=>(l&&l.data&&l.data.forEach(u=>{const d=u.embedding;u.embedding=Bu(d)}),l)))}}class Na extends B{retrieve(e,n,i){const{eval_id:o,run_id:r}=n;return this._client.get(x`/evals/${o}/runs/${r}/output_items/${e}`,i)}list(e,n,i){const{eval_id:o,...r}=n;return this._client.getAPIList(x`/evals/${o}/runs/${e}/output_items`,Q,{query:r,...i})}}class eo extends B{constructor(){super(...arguments),this.outputItems=new Na(this._client)}create(e,n,i){return this._client.post(x`/evals/${e}/runs`,{body:n,...i})}retrieve(e,n,i){const{eval_id:o}=n;return this._client.get(x`/evals/${o}/runs/${e}`,i)}list(e,n={},i){return this._client.getAPIList(x`/evals/${e}/runs`,Q,{query:n,...i})}delete(e,n,i){const{eval_id:o}=n;return this._client.delete(x`/evals/${o}/runs/${e}`,i)}cancel(e,n,i){const{eval_id:o}=n;return this._client.post(x`/evals/${o}/runs/${e}`,i)}}eo.OutputItems=Na;class to extends B{constructor(){super(...arguments),this.runs=new eo(this._client)}create(e,n){return this._client.post("/evals",{body:e,...n})}retrieve(e,n){return this._client.get(x`/evals/${e}`,n)}update(e,n,i){return this._client.post(x`/evals/${e}`,{body:n,...i})}list(e={},n){return this._client.getAPIList("/evals",Q,{query:e,...n})}delete(e,n){return this._client.delete(x`/evals/${e}`,n)}}to.Runs=eo;let ba=class extends B{create(e,n){return this._client.post("/files",Ze({body:e,...n},this._client))}retrieve(e,n){return this._client.get(x`/files/${e}`,n)}list(e={},n){return this._client.getAPIList("/files",Q,{query:e,...n})}delete(e,n){return this._client.delete(x`/files/${e}`,n)}content(e,n){return this._client.get(x`/files/${e}/content`,{...n,headers:b([{Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:i=30*60*1e3}={}){const o=new Set(["processed","error","deleted"]),r=Date.now();let l=await this.retrieve(e);for(;!l.status||!o.has(l.status);)if(await Bt(n),l=await this.retrieve(e),Date.now()-r>i)throw new qi({message:`Giving up on waiting for file ${e} to finish processing after ${i} milliseconds.`});return l}};class Da extends B{}let La=class extends B{run(e,n){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...n})}validate(e,n){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...n})}};class no extends B{constructor(){super(...arguments),this.graders=new La(this._client)}}no.Graders=La;class Fa extends B{create(e,n,i){return this._client.getAPIList(x`/fine_tuning/checkpoints/${e}/permissions`,$n,{body:n,method:"post",...i})}retrieve(e,n={},i){return this._client.getAPIList(x`/fine_tuning/checkpoints/${e}/permissions`,Q,{query:n,...i})}delete(e,n,i){const{fine_tuned_model_checkpoint:o}=n;return this._client.delete(x`/fine_tuning/checkpoints/${o}/permissions/${e}`,i)}}let io=class extends B{constructor(){super(...arguments),this.permissions=new Fa(this._client)}};io.Permissions=Fa;class Ua extends B{list(e,n={},i){return this._client.getAPIList(x`/fine_tuning/jobs/${e}/checkpoints`,Q,{query:n,...i})}}class oo extends B{constructor(){super(...arguments),this.checkpoints=new Ua(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(x`/fine_tuning/jobs/${e}`,n)}list(e={},n){return this._client.getAPIList("/fine_tuning/jobs",Q,{query:e,...n})}cancel(e,n){return this._client.post(x`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},i){return this._client.getAPIList(x`/fine_tuning/jobs/${e}/events`,Q,{query:n,...i})}pause(e,n){return this._client.post(x`/fine_tuning/jobs/${e}/pause`,n)}resume(e,n){return this._client.post(x`/fine_tuning/jobs/${e}/resume`,n)}}oo.Checkpoints=Ua;class gt extends B{constructor(){super(...arguments),this.methods=new Da(this._client),this.jobs=new oo(this._client),this.checkpoints=new io(this._client),this.alpha=new no(this._client)}}gt.Methods=Da;gt.Jobs=oo;gt.Checkpoints=io;gt.Alpha=no;class Va extends B{}class so extends B{constructor(){super(...arguments),this.graderModels=new Va(this._client)}}so.GraderModels=Va;class $a extends B{createVariation(e,n){return this._client.post("/images/variations",Ze({body:e,...n},this._client))}edit(e,n){return this._client.post("/images/edits",Ze({body:e,...n},this._client))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}}let Oa=class extends B{retrieve(e,n){return this._client.get(x`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",$n,e)}delete(e,n){return this._client.delete(x`/models/${e}`,n)}};class Ba extends B{create(e,n){return this._client.post("/moderations",{body:e,...n})}}function Gu(t,e){return!e||!Ju(e)?{...t,output_parsed:null,output:t.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(i=>({...i,parsed:null}))}:n)}:Ga(t,e)}function Ga(t,e){const n=t.output.map(o=>{if(o.type==="function_call")return{...o,parsed_arguments:Ku(e,o)};if(o.type==="message"){const r=o.content.map(l=>l.type==="output_text"?{...l,parsed:qu(e,l.text)}:l);return{...o,content:r}}return o}),i=Object.assign({},t,{output:n});return Object.getOwnPropertyDescriptor(t,"output_text")||qa(i),Object.defineProperty(i,"output_parsed",{enumerable:!0,get(){for(const o of i.output)if(o.type==="message"){for(const r of o.content)if(r.type==="output_text"&&r.parsed!==null)return r.parsed}return null}}),i}function qu(t,e){var n,i,o,r;return((i=(n=t.text)==null?void 0:n.format)==null?void 0:i.type)!=="json_schema"?null:"$parseRaw"in((o=t.text)==null?void 0:o.format)?((r=t.text)==null?void 0:r.format).$parseRaw(e):JSON.parse(e)}function Ju(t){var e;return!!Wi((e=t.text)==null?void 0:e.format)}function Hu(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function Wu(t,e){return t.find(n=>n.type==="function"&&n.name===e)}function Ku(t,e){const n=Wu(t.tools??[],e.name);return{...e,...e,parsed_arguments:Hu(n)?n.$parseRaw(e.arguments):n!=null&&n.strict?JSON.parse(e.arguments):null}}function qa(t){const e=[];for(const n of t.output)if(n.type==="message")for(const i of n.content)i.type==="output_text"&&e.push(i.text);t.output_text=e.join("")}var tt,en,$e,tn,Go,qo,Jo,Ho;class ro extends Hi{constructor(e){super(),tt.add(this),en.set(this,void 0),$e.set(this,void 0),tn.set(this,void 0),$(this,en,e)}static createResponse(e,n,i){const o=new ro(n);return o._run(()=>o._createOrRetrieveResponse(e,n,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createOrRetrieveResponse(e,n,i){var u;const o=i==null?void 0:i.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),_(this,tt,"m",Go).call(this);let r,l=null;"response_id"in n?(r=await e.responses.retrieve(n.response_id,{stream:!0},{...i,signal:this.controller.signal,stream:!0}),l=n.starting_after??null):r=await e.responses.create({...n,stream:!0},{...i,signal:this.controller.signal}),this._connected();for await(const d of r)_(this,tt,"m",qo).call(this,d,l);if((u=r.controller.signal)!=null&&u.aborted)throw new ve;return _(this,tt,"m",Jo).call(this)}[(en=new WeakMap,$e=new WeakMap,tn=new WeakMap,tt=new WeakSet,Go=function(){this.ended||$(this,$e,void 0)},qo=function(n,i){if(this.ended)return;const o=(l,u)=>{(i==null||u.sequence_number>i)&&this._emit(l,u)},r=_(this,tt,"m",Ho).call(this,n);switch(o("event",n),n.type){case"response.output_text.delta":{const l=r.output[n.output_index];if(!l)throw new U(`missing output at index ${n.output_index}`);if(l.type==="message"){const u=l.content[n.content_index];if(!u)throw new U(`missing content at index ${n.content_index}`);if(u.type!=="output_text")throw new U(`expected content to be 'output_text', got ${u.type}`);o("response.output_text.delta",{...n,snapshot:u.text})}break}case"response.function_call_arguments.delta":{const l=r.output[n.output_index];if(!l)throw new U(`missing output at index ${n.output_index}`);l.type==="function_call"&&o("response.function_call_arguments.delta",{...n,snapshot:l.arguments});break}default:o(n.type,n);break}},Jo=function(){if(this.ended)throw new U("stream has ended, this shouldn't happen");const n=_(this,$e,"f");if(!n)throw new U("request ended without sending any events");$(this,$e,void 0);const i=Yu(n,_(this,en,"f"));return $(this,tn,i),i},Ho=function(n){let i=_(this,$e,"f");if(!i){if(n.type!=="response.created")throw new U(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return i=$(this,$e,n.response),i}switch(n.type){case"response.output_item.added":{i.output.push(n.item);break}case"response.content_part.added":{const o=i.output[n.output_index];if(!o)throw new U(`missing output at index ${n.output_index}`);o.type==="message"&&o.content.push(n.part);break}case"response.output_text.delta":{const o=i.output[n.output_index];if(!o)throw new U(`missing output at index ${n.output_index}`);if(o.type==="message"){const r=o.content[n.content_index];if(!r)throw new U(`missing content at index ${n.content_index}`);if(r.type!=="output_text")throw new U(`expected content to be 'output_text', got ${r.type}`);r.text+=n.delta}break}case"response.function_call_arguments.delta":{const o=i.output[n.output_index];if(!o)throw new U(`missing output at index ${n.output_index}`);o.type==="function_call"&&(o.arguments+=n.delta);break}case"response.completed":{$(this,$e,n.response);break}}return i},Symbol.asyncIterator)](){const e=[],n=[];let i=!1;return this.on("event",o=>{const r=n.shift();r?r.resolve(o):e.push(o)}),this.on("end",()=>{i=!0;for(const o of n)o.resolve(void 0);n.length=0}),this.on("abort",o=>{i=!0;for(const r of n)r.reject(o);n.length=0}),this.on("error",o=>{i=!0;for(const r of n)r.reject(o);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:i?{value:void 0,done:!0}:new Promise((r,l)=>n.push({resolve:r,reject:l})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=_(this,tn,"f");if(!e)throw new U("stream ended without producing a ChatCompletion");return e}}function Yu(t,e){return Gu(t,e)}class Ja extends B{list(e,n={},i){return this._client.getAPIList(x`/responses/${e}/input_items`,Q,{query:n,...i})}}class ao extends B{constructor(){super(...arguments),this.inputItems=new Ja(this._client)}create(e,n){return this._client.post("/responses",{body:e,...n,stream:e.stream??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&qa(i),i))}retrieve(e,n={},i){return this._client.get(x`/responses/${e}`,{query:n,...i,stream:(n==null?void 0:n.stream)??!1})}delete(e,n){return this._client.delete(x`/responses/${e}`,{...n,headers:b([{Accept:"*/*"},n==null?void 0:n.headers])})}parse(e,n){return this._client.responses.create(e,n)._thenUnwrap(i=>Ga(i,e))}stream(e,n){return ro.createResponse(this._client,e,n)}cancel(e,n){return this._client.post(x`/responses/${e}/cancel`,n)}}ao.InputItems=Ja;class Ha extends B{create(e,n,i){return this._client.post(x`/uploads/${e}/parts`,Ze({body:n,...i},this._client))}}class lo extends B{constructor(){super(...arguments),this.parts=new Ha(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(x`/uploads/${e}/cancel`,n)}complete(e,n,i){return this._client.post(x`/uploads/${e}/complete`,{body:n,...i})}}lo.Parts=Ha;const zu=async t=>{const e=await Promise.allSettled(t),n=e.filter(o=>o.status==="rejected");if(n.length){for(const o of n)console.error(o.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const i=[];for(const o of e)o.status==="fulfilled"&&i.push(o.value);return i};class Wa extends B{create(e,n,i){return this._client.post(x`/vector_stores/${e}/file_batches`,{body:n,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}retrieve(e,n,i){const{vector_store_id:o}=n;return this._client.get(x`/vector_stores/${o}/file_batches/${e}`,{...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}cancel(e,n,i){const{vector_store_id:o}=n;return this._client.post(x`/vector_stores/${o}/file_batches/${e}/cancel`,{...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}async createAndPoll(e,n,i){const o=await this.create(e,n);return await this.poll(e,o.id,i)}listFiles(e,n,i){const{vector_store_id:o,...r}=n;return this._client.getAPIList(x`/vector_stores/${o}/file_batches/${e}/files`,Q,{query:r,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}async poll(e,n,i){var r;const o=b([i==null?void 0:i.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((r=i==null?void 0:i.pollIntervalMs)==null?void 0:r.toString())??void 0}]);for(;;){const{data:l,response:u}=await this.retrieve(n,{vector_store_id:e},{...i,headers:o}).withResponse();switch(l.status){case"in_progress":let d=5e3;if(i!=null&&i.pollIntervalMs)d=i.pollIntervalMs;else{const c=u.headers.get("openai-poll-after-ms");if(c){const f=parseInt(c);isNaN(f)||(d=f)}}await Bt(d);break;case"failed":case"cancelled":case"completed":return l}}}async uploadAndPoll(e,{files:n,fileIds:i=[]},o){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=(o==null?void 0:o.maxConcurrency)??5,l=Math.min(r,n.length),u=this._client,d=n.values(),c=[...i];async function f(p){for(let m of p){const g=await u.files.create({file:m,purpose:"assistants"},o);c.push(g.id)}}const h=Array(l).fill(d).map(f);return await zu(h),await this.createAndPoll(e,{file_ids:c})}}let Ka=class extends B{create(e,n,i){return this._client.post(x`/vector_stores/${e}/files`,{body:n,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}retrieve(e,n,i){const{vector_store_id:o}=n;return this._client.get(x`/vector_stores/${o}/files/${e}`,{...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}update(e,n,i){const{vector_store_id:o,...r}=n;return this._client.post(x`/vector_stores/${o}/files/${e}`,{body:r,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}list(e,n={},i){return this._client.getAPIList(x`/vector_stores/${e}/files`,Q,{query:n,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}delete(e,n,i){const{vector_store_id:o}=n;return this._client.delete(x`/vector_stores/${o}/files/${e}`,{...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}async createAndPoll(e,n,i){const o=await this.create(e,n,i);return await this.poll(e,o.id,i)}async poll(e,n,i){var r;const o=b([i==null?void 0:i.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((r=i==null?void 0:i.pollIntervalMs)==null?void 0:r.toString())??void 0}]);for(;;){const l=await this.retrieve(n,{vector_store_id:e},{...i,headers:o}).withResponse(),u=l.data;switch(u.status){case"in_progress":let d=5e3;if(i!=null&&i.pollIntervalMs)d=i.pollIntervalMs;else{const c=l.response.headers.get("openai-poll-after-ms");if(c){const f=parseInt(c);isNaN(f)||(d=f)}}await Bt(d);break;case"failed":case"completed":return u}}}async upload(e,n,i){const o=await this._client.files.create({file:n,purpose:"assistants"},i);return this.create(e,{file_id:o.id},i)}async uploadAndPoll(e,n,i){const o=await this.upload(e,n,i);return await this.poll(e,o.id,i)}content(e,n,i){const{vector_store_id:o}=n;return this._client.getAPIList(x`/vector_stores/${o}/files/${e}/content`,$n,{...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}};class Gn extends B{constructor(){super(...arguments),this.files=new Ka(this._client),this.fileBatches=new Wa(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,n){return this._client.get(x`/vector_stores/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,n,i){return this._client.post(x`/vector_stores/${e}`,{body:n,...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}list(e={},n){return this._client.getAPIList("/vector_stores",Q,{query:e,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,n){return this._client.delete(x`/vector_stores/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}search(e,n,i){return this._client.getAPIList(x`/vector_stores/${e}/search`,$n,{body:n,method:"post",...i,headers:b([{"OpenAI-Beta":"assistants=v2"},i==null?void 0:i.headers])})}}Gn.Files=Ka;Gn.FileBatches=Wa;var wi,uo,hn,Ya;class K{constructor({baseURL:e=Tt("OPENAI_BASE_URL"),apiKey:n=Tt("OPENAI_API_KEY"),organization:i=Tt("OPENAI_ORG_ID")??null,project:o=Tt("OPENAI_PROJECT_ID")??null,...r}={}){if(wi.add(this),hn.set(this,void 0),this.completions=new Ra(this),this.chat=new Zi(this),this.embeddings=new ka(this),this.files=new ba(this),this.images=new $a(this),this.audio=new qt(this),this.moderations=new Ba(this),this.models=new Oa(this),this.fineTuning=new gt(this),this.graders=new so(this),this.vectorStores=new Gn(this),this.beta=new Jt(this),this.batches=new Sa(this),this.uploads=new lo(this),this.responses=new ao(this),this.evals=new to(this),this.containers=new ji(this),n===void 0)throw new U("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const l={apiKey:n,organization:i,project:o,...r,baseURL:e||"https://api.openai.com/v1"};if(!l.dangerouslyAllowBrowser&&Zl())throw new U(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=l.baseURL,this.timeout=l.timeout??uo.DEFAULT_TIMEOUT,this.logger=l.logger??console;const u="warn";this.logLevel=u,this.logLevel=Po(l.logLevel,"ClientOptions.logLevel",this)??Po(Tt("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??u,this.fetchOptions=l.fetchOptions,this.maxRetries=l.maxRetries??2,this.fetch=l.fetch??tu(),$(this,hn,iu),this._options=l,this.apiKey=n,this.organization=i,this.project=o}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:n}){}authHeaders(e){return b([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return uu(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${it}`}defaultIdempotencyKey(){return`stainless-node-retry-${Ir()}`}makeStatusError(e,n,i,o){return oe.generate(e,n,i,o)}buildURL(e,n,i){const o=!_(this,wi,"m",Ya).call(this)&&i||this.baseURL,r=Jl(e)?new URL(e):new URL(o+(o.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),l=this.defaultQuery();return Wl(l)||(n={...l,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}async prepareOptions(e){}async prepareRequest(e,{url:n,options:i}){}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,i){return this.request(Promise.resolve(i).then(o=>({method:e,path:n,...o})))}request(e,n=null){return new Vn(this,this.makeRequest(e,n,void 0))}async makeRequest(e,n,i){var E,C;const o=await e,r=o.maxRetries??this.maxRetries;n==null&&(n=r),await this.prepareOptions(o);const{req:l,url:u,timeout:d}=this.buildRequest(o,{retryCount:r-n});await this.prepareRequest(l,{url:u,options:o});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),f=i===void 0?"":`, retryOf: ${i}`,h=Date.now();if(se(this).debug(`[${c}] sending request`,We({retryOfRequestLogID:i,method:o.method,url:u,options:o,headers:l.headers})),(E=o.signal)!=null&&E.aborted)throw new ve;const p=new AbortController,m=await this.fetchWithTimeout(u,l,d,p).catch(fi),g=Date.now();if(m instanceof Error){const T=`retrying, ${n} attempts remaining`;if((C=o.signal)!=null&&C.aborted)throw new ve;const w=di(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(n)return se(this).info(`[${c}] connection ${w?"timed out":"failed"} - ${T}`),se(this).debug(`[${c}] connection ${w?"timed out":"failed"} (${T})`,We({retryOfRequestLogID:i,url:u,durationMs:g-h,message:m.message})),this.retryRequest(o,n,i??c);throw se(this).info(`[${c}] connection ${w?"timed out":"failed"} - error; no more retries left`),se(this).debug(`[${c}] connection ${w?"timed out":"failed"} (error; no more retries left)`,We({retryOfRequestLogID:i,url:u,durationMs:g-h,message:m.message})),w?new qi:new Fn({cause:m})}const y=[...m.headers.entries()].filter(([T])=>T==="x-request-id").map(([T,w])=>", "+T+": "+JSON.stringify(w)).join(""),v=`[${c}${f}${y}] ${l.method} ${u} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${g-h}ms`;if(!m.ok){const T=this.shouldRetry(m);if(n&&T){const R=`retrying, ${n} attempts remaining`;return await nu(m.body),se(this).info(`${v} - ${R}`),se(this).debug(`[${c}] response error (${R})`,We({retryOfRequestLogID:i,url:m.url,status:m.status,headers:m.headers,durationMs:g-h})),this.retryRequest(o,n,i??c,m.headers)}const w=T?"error; no more retries left":"error; not retryable";se(this).info(`${v} - ${w}`);const M=await m.text().catch(R=>fi(R).message),D=zl(M),A=D?void 0:M;throw se(this).debug(`[${c}] response error (${w})`,We({retryOfRequestLogID:i,url:m.url,status:m.status,headers:m.headers,message:A,durationMs:Date.now()-h})),this.makeStatusError(m.status,D,A,m.headers)}return se(this).info(v),se(this).debug(`[${c}] response start`,We({retryOfRequestLogID:i,url:m.url,status:m.status,headers:m.headers,durationMs:g-h})),{response:m,options:o,controller:p,requestLogID:c,retryOfRequestLogID:i,startTime:h}}getAPIList(e,n,i){return this.requestAPIList(n,{method:"get",path:e,...i})}requestAPIList(e,n){const i=this.makeRequest(n,null,void 0);return new _u(this,i,e)}async fetchWithTimeout(e,n,i,o){const{signal:r,method:l,...u}=n||{};r&&r.addEventListener("abort",()=>o.abort());const d=setTimeout(()=>o.abort(),i),c=globalThis.ReadableStream&&u.body instanceof globalThis.ReadableStream||typeof u.body=="object"&&u.body!==null&&Symbol.asyncIterator in u.body,f={signal:o.signal,...c?{duplex:"half"}:{},method:"GET",...u};l&&(f.method=l.toUpperCase());try{return await this.fetch.call(void 0,e,f)}finally{clearTimeout(d)}}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,i,o){let r;const l=o==null?void 0:o.get("retry-after-ms");if(l){const d=parseFloat(l);Number.isNaN(d)||(r=d)}const u=o==null?void 0:o.get("retry-after");if(u&&!r){const d=parseFloat(u);Number.isNaN(d)?r=Date.parse(u)-Date.now():r=d*1e3}if(!(r&&0<=r&&r<60*1e3)){const d=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(n,d)}return await Bt(r),this.makeRequest(e,n-1,i)}calculateDefaultRetryTimeoutMillis(e,n){const r=n-e,l=Math.min(.5*Math.pow(2,r),8),u=1-Math.random()*.25;return l*u*1e3}buildRequest(e,{retryCount:n=0}={}){const i={...e},{method:o,path:r,query:l,defaultBaseURL:u}=i,d=this.buildURL(r,l,u);"timeout"in i&&Yl("timeout",i.timeout),i.timeout=i.timeout??this.timeout;const{bodyHeaders:c,body:f}=this.buildBody({options:i}),h=this.buildHeaders({options:e,method:o,bodyHeaders:c,retryCount:n});return{req:{method:o,headers:h,...i.signal&&{signal:i.signal},...globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"},...f&&{body:f},...this.fetchOptions??{},...i.fetchOptions??{}},url:d,timeout:i.timeout}}buildHeaders({options:e,method:n,bodyHeaders:i,retryCount:o}){let r={};this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const l=b([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...eu(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,i,e.headers]);return this.validateHeaders(l),l.values}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};const i=b([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&i.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:$r(e)}:_(this,hn,"f").call(this,{body:e,headers:i})}}uo=K,hn=new WeakMap,wi=new WeakSet,Ya=function(){return this.baseURL!=="https://api.openai.com/v1"};K.OpenAI=uo;K.DEFAULT_TIMEOUT=6e5;K.OpenAIError=U;K.APIError=oe;K.APIConnectionError=Fn;K.APIConnectionTimeoutError=qi;K.APIUserAbortError=ve;K.NotFoundError=kr;K.ConflictError=Nr;K.RateLimitError=Dr;K.BadRequestError=Mr;K.AuthenticationError=Rr;K.InternalServerError=Lr;K.PermissionDeniedError=Pr;K.UnprocessableEntityError=br;K.toFile=Au;K.Completions=Ra;K.Chat=Zi;K.Embeddings=ka;K.Files=ba;K.Images=$a;K.Audio=qt;K.Moderations=Ba;K.Models=Oa;K.FineTuning=gt;K.Graders=so;K.VectorStores=Gn;K.Beta=Jt;K.Batches=Sa;K.Uploads=lo;K.Responses=ao;K.Evals=to;K.Containers=ji;const qn=async(t,e={})=>{const n=new Headers({"Content-Type":"application/json",...e.headers}),i=await fetch(t,{...e,headers:n});if(!i.ok)throw i;const o=[204,205,304].includes(i==null?void 0:i.status);return!(i!=null&&i.body)||o?{}:i.json()};let Si=null,pn=null;const Ht=async()=>(Si??(Si=await qe.getActiveApiKey(ae)),Si),Jv=async()=>{Si=await qe.getActiveApiKey(ae),pn=null},Jn=async()=>{const t=await Ht();return!pn&&t&&(pn=new K({apiKey:t,dangerouslyAllowBrowser:!0})),pn},Zu=t=>{const e=Array.isArray(t.text)?t.text.join(`
`):t.text;switch(t.sender){case"character":return{role:"assistant",content:e};case"user":default:return{role:"user",content:e}}},za=t=>{const e=[],n=Ln(t,void 0,!t.characterConversationBase),i=t.characterConversationBase?t.characterConversationBase+n:n;return e.push({role:"system",content:i}),t.characterInitialMessage&&t.characterInitialMessage.length>0&&e.push({role:"assistant",content:t.characterInitialMessage.join(`
`)}),t.messages&&t.messages.length>0&&t.messages.forEach(o=>{e.push(Zu(o))}),e},Xu=async(t,e="",n=1e3)=>{var i,o;try{if(!await Ht())throw new Error("OpenAI API key is not configured. Please configure your API key in the application settings.");const l=await Jn();if(!l)throw new Error("Failed to initialize OpenAI client");const u=za(t),d=t.temperature||.7,f=(o=(i=(await l.chat.completions.create({model:e,messages:u,temperature:d,max_tokens:n})).choices[0])==null?void 0:i.message)==null?void 0:o.content;if(!f)throw new Error("No response received from OpenAI");return f}catch(r){throw console.error("Error getting chat completion:",r),r}},Qu=async(t,e="",n=1e3,i)=>{var o,r;try{if(!await Ht())throw new Error("OpenAI API key is not configured. Please configure your API key in the application settings.");const u=await Jn();if(!u)throw new Error("Failed to initialize OpenAI client");const d=za(t),c=t.temperature||.7,f=await u.chat.completions.create({model:e,messages:d,temperature:c,max_tokens:n,stream:!0});let h="";for await(const p of f){const m=((r=(o=p.choices[0])==null?void 0:o.delta)==null?void 0:r.content)??"";m&&(h+=m,i==null||i(m))}return h}catch(l){throw console.error("Error getting streaming chat completion:",l),l}},ju=(t,e="character")=>({id:`msg_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,sender:e,text:[t]}),ec=async()=>{try{if(!await Ht())return!1;const e=await Jn();return e?(await e.models.list(),!0):!1}catch(t){return console.error("Invalid OpenAI API key:",t),!1}},tc=async()=>!!await Ht(),nc=async()=>{try{const t=await Jn();return t?(await t.models.list()).data.filter(n=>n.id.includes("gpt")&&!n.id.includes("image")&&!n.id.includes("vision")&&!n.id.includes("dall-e")&&!n.id.includes("dalle")&&!n.id.includes("transcribe")).map(n=>n.id).sort((n,i)=>n.localeCompare(i)):[]}catch(t){return console.error("Error fetching available models:",t),[]}};var Y;(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function n(o){throw new Error}t.assertNever=n,t.arrayToEnum=o=>{const r={};for(const l of o)r[l]=l;return r},t.getValidEnumValues=o=>{const r=t.objectKeys(o).filter(u=>typeof o[o[u]]!="number"),l={};for(const u of r)l[u]=o[u];return t.objectValues(l)},t.objectValues=o=>t.objectKeys(o).map(function(r){return o[r]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{const r=[];for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&r.push(l);return r},t.find=(o,r)=>{for(const l of o)if(r(l))return l},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function i(o,r=" | "){return o.map(l=>typeof l=="string"?`'${l}'`:l).join(r)}t.joinValues=i,t.jsonStringifyReplacer=(o,r)=>typeof r=="bigint"?r.toString():r})(Y||(Y={}));var Wo;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Wo||(Wo={}));const P=Y.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Oe=t=>{switch(typeof t){case"undefined":return P.undefined;case"string":return P.string;case"number":return Number.isNaN(t)?P.nan:P.number;case"boolean":return P.boolean;case"function":return P.function;case"bigint":return P.bigint;case"symbol":return P.symbol;case"object":return Array.isArray(t)?P.array:t===null?P.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?P.promise:typeof Map<"u"&&t instanceof Map?P.map:typeof Set<"u"&&t instanceof Set?P.set:typeof Date<"u"&&t instanceof Date?P.date:P.object;default:return P.unknown}},S=Y.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class De extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(r){return r.message},i={_errors:[]},o=r=>{for(const l of r.issues)if(l.code==="invalid_union")l.unionErrors.map(o);else if(l.code==="invalid_return_type")o(l.returnTypeError);else if(l.code==="invalid_arguments")o(l.argumentsError);else if(l.path.length===0)i._errors.push(n(l));else{let u=i,d=0;for(;d<l.path.length;){const c=l.path[d];d===l.path.length-1?(u[c]=u[c]||{_errors:[]},u[c]._errors.push(n(l))):u[c]=u[c]||{_errors:[]},u=u[c],d++}}};return o(this),i}static assert(e){if(!(e instanceof De))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Y.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},i=[];for(const o of this.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(e(o))):i.push(e(o));return{formErrors:i,fieldErrors:n}}get formErrors(){return this.flatten()}}De.create=t=>new De(t);const Ai=(t,e)=>{let n;switch(t.code){case S.invalid_type:t.received===P.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Y.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:n=`Unrecognized key(s) in object: ${Y.joinValues(t.keys,", ")}`;break;case S.invalid_union:n="Invalid input";break;case S.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Y.joinValues(t.options)}`;break;case S.invalid_enum_value:n=`Invalid enum value. Expected ${Y.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:n="Invalid function arguments";break;case S.invalid_return_type:n="Invalid function return type";break;case S.invalid_date:n="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Y.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case S.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case S.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case S.custom:n="Invalid input";break;case S.invalid_intersection_types:n="Intersection results could not be merged";break;case S.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:n="Number must be finite";break;default:n=e.defaultError,Y.assertNever(t)}return{message:n}};let ic=Ai;function oc(){return ic}const sc=t=>{const{data:e,path:n,errorMaps:i,issueData:o}=t,r=[...n,...o.path||[]],l={...o,path:r};if(o.message!==void 0)return{...o,path:r,message:o.message};let u="";const d=i.filter(c=>!!c).slice().reverse();for(const c of d)u=c(l,{data:e,defaultError:u}).message;return{...o,path:r,message:u}};function I(t,e){const n=oc(),i=sc({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===Ai?void 0:Ai].filter(o=>!!o)});t.common.issues.push(i)}class de{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const i=[];for(const o of n){if(o.status==="aborted")return G;o.status==="dirty"&&e.dirty(),i.push(o.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,n){const i=[];for(const o of n){const r=await o.key,l=await o.value;i.push({key:r,value:l})}return de.mergeObjectSync(e,i)}static mergeObjectSync(e,n){const i={};for(const o of n){const{key:r,value:l}=o;if(r.status==="aborted"||l.status==="aborted")return G;r.status==="dirty"&&e.dirty(),l.status==="dirty"&&e.dirty(),r.value!=="__proto__"&&(typeof l.value<"u"||o.alwaysSet)&&(i[r.value]=l.value)}return{status:e.value,value:i}}}const G=Object.freeze({status:"aborted"}),kt=t=>({status:"dirty",value:t}),Ce=t=>({status:"valid",value:t}),Ko=t=>t.status==="aborted",Yo=t=>t.status==="dirty",ct=t=>t.status==="valid",xn=t=>typeof Promise<"u"&&t instanceof Promise;var k;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(k||(k={}));class ke{constructor(e,n,i,o){this._cachedPath=[],this.parent=e,this.data=n,this._path=i,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const zo=(t,e)=>{if(ct(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new De(t.common.issues);return this._error=n,this._error}}};function q(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:i,description:o}=t;if(e&&(n||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(l,u)=>{const{message:d}=t;return l.code==="invalid_enum_value"?{message:d??u.defaultError}:typeof u.data>"u"?{message:d??i??u.defaultError}:l.code!=="invalid_type"?{message:u.defaultError}:{message:d??n??u.defaultError}},description:o}}class W{get description(){return this._def.description}_getType(e){return Oe(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Oe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new de,ctx:{common:e.parent.common,data:e.data,parsedType:Oe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(xn(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const i=this.safeParse(e,n);if(i.success)return i.data;throw i.error}safeParse(e,n){const i={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Oe(e)},o=this._parseSync({data:e,path:i.path,parent:i});return zo(i,o)}"~validate"(e){var i,o;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Oe(e)};if(!this["~standard"].async)try{const r=this._parseSync({data:e,path:[],parent:n});return ct(r)?{value:r.value}:{issues:n.common.issues}}catch(r){(o=(i=r==null?void 0:r.message)==null?void 0:i.toLowerCase())!=null&&o.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(r=>ct(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(e,n){const i=await this.safeParseAsync(e,n);if(i.success)return i.data;throw i.error}async safeParseAsync(e,n){const i={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Oe(e)},o=this._parse({data:e,path:i.path,parent:i}),r=await(xn(o)?o:Promise.resolve(o));return zo(i,r)}refine(e,n){const i=o=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(o):n;return this._refinement((o,r)=>{const l=e(o),u=()=>r.addIssue({code:S.custom,...i(o)});return typeof Promise<"u"&&l instanceof Promise?l.then(d=>d?!0:(u(),!1)):l?!0:(u(),!1)})}refinement(e,n){return this._refinement((i,o)=>e(i)?!0:(o.addIssue(typeof n=="function"?n(i,o):n),!1))}_refinement(e){return new ht({schema:this,typeName:O.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Be.create(this,this._def)}nullable(){return pt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Pe.create(this)}promise(){return kn.create(this,this._def)}or(e){return Mn.create([this,e],this._def)}and(e){return Rn.create(this,e,this._def)}transform(e){return new ht({...q(this._def),schema:this,typeName:O.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new Mi({...q(this._def),innerType:this,defaultValue:n,typeName:O.ZodDefault})}brand(){return new Mc({typeName:O.ZodBranded,type:this,...q(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new Ri({...q(this._def),innerType:this,catchValue:n,typeName:O.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return co.create(this,e)}readonly(){return Pi.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const rc=/^c[^\s-]{8,}$/i,ac=/^[0-9a-z]+$/,lc=/^[0-9A-HJKMNP-TV-Z]{26}$/i,uc=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,cc=/^[a-z0-9_-]{21}$/i,dc=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,fc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,hc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,pc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let ui;const mc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,gc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,yc=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,_c=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,vc=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Cc=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Za="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Tc=new RegExp(`^${Za}$`);function Xa(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function wc(t){return new RegExp(`^${Xa(t)}$`)}function Sc(t){let e=`${Za}T${Xa(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function Ac(t,e){return!!((e==="v4"||!e)&&mc.test(t)||(e==="v6"||!e)&&yc.test(t))}function Ec(t,e){if(!dc.test(t))return!1;try{const[n]=t.split("."),i=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),o=JSON.parse(atob(i));return!(typeof o!="object"||o===null||"typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function xc(t,e){return!!((e==="v4"||!e)&&gc.test(t)||(e==="v6"||!e)&&_c.test(t))}class Me extends W{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==P.string){const r=this._getOrReturnCtx(e);return I(r,{code:S.invalid_type,expected:P.string,received:r.parsedType}),G}const i=new de;let o;for(const r of this._def.checks)if(r.kind==="min")e.data.length<r.value&&(o=this._getOrReturnCtx(e,o),I(o,{code:S.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),i.dirty());else if(r.kind==="max")e.data.length>r.value&&(o=this._getOrReturnCtx(e,o),I(o,{code:S.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),i.dirty());else if(r.kind==="length"){const l=e.data.length>r.value,u=e.data.length<r.value;(l||u)&&(o=this._getOrReturnCtx(e,o),l?I(o,{code:S.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):u&&I(o,{code:S.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),i.dirty())}else if(r.kind==="email")hc.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"email",code:S.invalid_string,message:r.message}),i.dirty());else if(r.kind==="emoji")ui||(ui=new RegExp(pc,"u")),ui.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"emoji",code:S.invalid_string,message:r.message}),i.dirty());else if(r.kind==="uuid")uc.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"uuid",code:S.invalid_string,message:r.message}),i.dirty());else if(r.kind==="nanoid")cc.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"nanoid",code:S.invalid_string,message:r.message}),i.dirty());else if(r.kind==="cuid")rc.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"cuid",code:S.invalid_string,message:r.message}),i.dirty());else if(r.kind==="cuid2")ac.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"cuid2",code:S.invalid_string,message:r.message}),i.dirty());else if(r.kind==="ulid")lc.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"ulid",code:S.invalid_string,message:r.message}),i.dirty());else if(r.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),I(o,{validation:"url",code:S.invalid_string,message:r.message}),i.dirty()}else r.kind==="regex"?(r.regex.lastIndex=0,r.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"regex",code:S.invalid_string,message:r.message}),i.dirty())):r.kind==="trim"?e.data=e.data.trim():r.kind==="includes"?e.data.includes(r.value,r.position)||(o=this._getOrReturnCtx(e,o),I(o,{code:S.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),i.dirty()):r.kind==="toLowerCase"?e.data=e.data.toLowerCase():r.kind==="toUpperCase"?e.data=e.data.toUpperCase():r.kind==="startsWith"?e.data.startsWith(r.value)||(o=this._getOrReturnCtx(e,o),I(o,{code:S.invalid_string,validation:{startsWith:r.value},message:r.message}),i.dirty()):r.kind==="endsWith"?e.data.endsWith(r.value)||(o=this._getOrReturnCtx(e,o),I(o,{code:S.invalid_string,validation:{endsWith:r.value},message:r.message}),i.dirty()):r.kind==="datetime"?Sc(r).test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{code:S.invalid_string,validation:"datetime",message:r.message}),i.dirty()):r.kind==="date"?Tc.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{code:S.invalid_string,validation:"date",message:r.message}),i.dirty()):r.kind==="time"?wc(r).test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{code:S.invalid_string,validation:"time",message:r.message}),i.dirty()):r.kind==="duration"?fc.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"duration",code:S.invalid_string,message:r.message}),i.dirty()):r.kind==="ip"?Ac(e.data,r.version)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"ip",code:S.invalid_string,message:r.message}),i.dirty()):r.kind==="jwt"?Ec(e.data,r.alg)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"jwt",code:S.invalid_string,message:r.message}),i.dirty()):r.kind==="cidr"?xc(e.data,r.version)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"cidr",code:S.invalid_string,message:r.message}),i.dirty()):r.kind==="base64"?vc.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"base64",code:S.invalid_string,message:r.message}),i.dirty()):r.kind==="base64url"?Cc.test(e.data)||(o=this._getOrReturnCtx(e,o),I(o,{validation:"base64url",code:S.invalid_string,message:r.message}),i.dirty()):Y.assertNever(r);return{status:i.value,value:e.data}}_regex(e,n,i){return this.refinement(o=>e.test(o),{validation:n,code:S.invalid_string,...k.errToObj(i)})}_addCheck(e){return new Me({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...k.errToObj(e)})}url(e){return this._addCheck({kind:"url",...k.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...k.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...k.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...k.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...k.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...k.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...k.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...k.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...k.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...k.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...k.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...k.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...k.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...k.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...k.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...k.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...k.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...k.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...k.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...k.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...k.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...k.errToObj(n)})}nonempty(e){return this.min(1,k.errToObj(e))}trim(){return new Me({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Me({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Me({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Me.create=t=>new Me({checks:[],typeName:O.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...q(t)});function Ic(t,e){const n=(t.toString().split(".")[1]||"").length,i=(e.toString().split(".")[1]||"").length,o=n>i?n:i,r=Number.parseInt(t.toFixed(o).replace(".","")),l=Number.parseInt(e.toFixed(o).replace(".",""));return r%l/10**o}class Xe extends W{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==P.number){const r=this._getOrReturnCtx(e);return I(r,{code:S.invalid_type,expected:P.number,received:r.parsedType}),G}let i;const o=new de;for(const r of this._def.checks)r.kind==="int"?Y.isInteger(e.data)||(i=this._getOrReturnCtx(e,i),I(i,{code:S.invalid_type,expected:"integer",received:"float",message:r.message}),o.dirty()):r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(i=this._getOrReturnCtx(e,i),I(i,{code:S.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),o.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(i=this._getOrReturnCtx(e,i),I(i,{code:S.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),o.dirty()):r.kind==="multipleOf"?Ic(e.data,r.value)!==0&&(i=this._getOrReturnCtx(e,i),I(i,{code:S.not_multiple_of,multipleOf:r.value,message:r.message}),o.dirty()):r.kind==="finite"?Number.isFinite(e.data)||(i=this._getOrReturnCtx(e,i),I(i,{code:S.not_finite,message:r.message}),o.dirty()):Y.assertNever(r);return{status:o.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,k.toString(n))}gt(e,n){return this.setLimit("min",e,!1,k.toString(n))}lte(e,n){return this.setLimit("max",e,!0,k.toString(n))}lt(e,n){return this.setLimit("max",e,!1,k.toString(n))}setLimit(e,n,i,o){return new Xe({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:i,message:k.toString(o)}]})}_addCheck(e){return new Xe({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:k.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:k.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:k.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:k.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:k.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:k.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:k.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:k.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:k.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Y.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(n===null||i.value>n)&&(n=i.value):i.kind==="max"&&(e===null||i.value<e)&&(e=i.value)}return Number.isFinite(n)&&Number.isFinite(e)}}Xe.create=t=>new Xe({checks:[],typeName:O.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...q(t)});class Qe extends W{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==P.bigint)return this._getInvalidInput(e);let i;const o=new de;for(const r of this._def.checks)r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(i=this._getOrReturnCtx(e,i),I(i,{code:S.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),o.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(i=this._getOrReturnCtx(e,i),I(i,{code:S.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),o.dirty()):r.kind==="multipleOf"?e.data%r.value!==BigInt(0)&&(i=this._getOrReturnCtx(e,i),I(i,{code:S.not_multiple_of,multipleOf:r.value,message:r.message}),o.dirty()):Y.assertNever(r);return{status:o.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return I(n,{code:S.invalid_type,expected:P.bigint,received:n.parsedType}),G}gte(e,n){return this.setLimit("min",e,!0,k.toString(n))}gt(e,n){return this.setLimit("min",e,!1,k.toString(n))}lte(e,n){return this.setLimit("max",e,!0,k.toString(n))}lt(e,n){return this.setLimit("max",e,!1,k.toString(n))}setLimit(e,n,i,o){return new Qe({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:i,message:k.toString(o)}]})}_addCheck(e){return new Qe({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:k.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:k.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:k.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:k.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:k.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Qe.create=t=>new Qe({checks:[],typeName:O.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...q(t)});class In extends W{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==P.boolean){const i=this._getOrReturnCtx(e);return I(i,{code:S.invalid_type,expected:P.boolean,received:i.parsedType}),G}return Ce(e.data)}}In.create=t=>new In({typeName:O.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...q(t)});class dt extends W{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==P.date){const r=this._getOrReturnCtx(e);return I(r,{code:S.invalid_type,expected:P.date,received:r.parsedType}),G}if(Number.isNaN(e.data.getTime())){const r=this._getOrReturnCtx(e);return I(r,{code:S.invalid_date}),G}const i=new de;let o;for(const r of this._def.checks)r.kind==="min"?e.data.getTime()<r.value&&(o=this._getOrReturnCtx(e,o),I(o,{code:S.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),i.dirty()):r.kind==="max"?e.data.getTime()>r.value&&(o=this._getOrReturnCtx(e,o),I(o,{code:S.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),i.dirty()):Y.assertNever(r);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new dt({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:k.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:k.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}dt.create=t=>new dt({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:O.ZodDate,...q(t)});class Zo extends W{_parse(e){if(this._getType(e)!==P.symbol){const i=this._getOrReturnCtx(e);return I(i,{code:S.invalid_type,expected:P.symbol,received:i.parsedType}),G}return Ce(e.data)}}Zo.create=t=>new Zo({typeName:O.ZodSymbol,...q(t)});class Xo extends W{_parse(e){if(this._getType(e)!==P.undefined){const i=this._getOrReturnCtx(e);return I(i,{code:S.invalid_type,expected:P.undefined,received:i.parsedType}),G}return Ce(e.data)}}Xo.create=t=>new Xo({typeName:O.ZodUndefined,...q(t)});class Qo extends W{_parse(e){if(this._getType(e)!==P.null){const i=this._getOrReturnCtx(e);return I(i,{code:S.invalid_type,expected:P.null,received:i.parsedType}),G}return Ce(e.data)}}Qo.create=t=>new Qo({typeName:O.ZodNull,...q(t)});class jo extends W{constructor(){super(...arguments),this._any=!0}_parse(e){return Ce(e.data)}}jo.create=t=>new jo({typeName:O.ZodAny,...q(t)});class Ei extends W{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ce(e.data)}}Ei.create=t=>new Ei({typeName:O.ZodUnknown,...q(t)});class Ge extends W{_parse(e){const n=this._getOrReturnCtx(e);return I(n,{code:S.invalid_type,expected:P.never,received:n.parsedType}),G}}Ge.create=t=>new Ge({typeName:O.ZodNever,...q(t)});class es extends W{_parse(e){if(this._getType(e)!==P.undefined){const i=this._getOrReturnCtx(e);return I(i,{code:S.invalid_type,expected:P.void,received:i.parsedType}),G}return Ce(e.data)}}es.create=t=>new es({typeName:O.ZodVoid,...q(t)});class Pe extends W{_parse(e){const{ctx:n,status:i}=this._processInputParams(e),o=this._def;if(n.parsedType!==P.array)return I(n,{code:S.invalid_type,expected:P.array,received:n.parsedType}),G;if(o.exactLength!==null){const l=n.data.length>o.exactLength.value,u=n.data.length<o.exactLength.value;(l||u)&&(I(n,{code:l?S.too_big:S.too_small,minimum:u?o.exactLength.value:void 0,maximum:l?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),i.dirty())}if(o.minLength!==null&&n.data.length<o.minLength.value&&(I(n,{code:S.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),i.dirty()),o.maxLength!==null&&n.data.length>o.maxLength.value&&(I(n,{code:S.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),i.dirty()),n.common.async)return Promise.all([...n.data].map((l,u)=>o.type._parseAsync(new ke(n,l,n.path,u)))).then(l=>de.mergeArray(i,l));const r=[...n.data].map((l,u)=>o.type._parseSync(new ke(n,l,n.path,u)));return de.mergeArray(i,r)}get element(){return this._def.type}min(e,n){return new Pe({...this._def,minLength:{value:e,message:k.toString(n)}})}max(e,n){return new Pe({...this._def,maxLength:{value:e,message:k.toString(n)}})}length(e,n){return new Pe({...this._def,exactLength:{value:e,message:k.toString(n)}})}nonempty(e){return this.min(1,e)}}Pe.create=(t,e)=>new Pe({type:t,minLength:null,maxLength:null,exactLength:null,typeName:O.ZodArray,...q(e)});function st(t){if(t instanceof j){const e={};for(const n in t.shape){const i=t.shape[n];e[n]=Be.create(st(i))}return new j({...t._def,shape:()=>e})}else return t instanceof Pe?new Pe({...t._def,type:st(t.element)}):t instanceof Be?Be.create(st(t.unwrap())):t instanceof pt?pt.create(st(t.unwrap())):t instanceof je?je.create(t.items.map(e=>st(e))):t}class j extends W{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=Y.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==P.object){const c=this._getOrReturnCtx(e);return I(c,{code:S.invalid_type,expected:P.object,received:c.parsedType}),G}const{status:i,ctx:o}=this._processInputParams(e),{shape:r,keys:l}=this._getCached(),u=[];if(!(this._def.catchall instanceof Ge&&this._def.unknownKeys==="strip"))for(const c in o.data)l.includes(c)||u.push(c);const d=[];for(const c of l){const f=r[c],h=o.data[c];d.push({key:{status:"valid",value:c},value:f._parse(new ke(o,h,o.path,c)),alwaysSet:c in o.data})}if(this._def.catchall instanceof Ge){const c=this._def.unknownKeys;if(c==="passthrough")for(const f of u)d.push({key:{status:"valid",value:f},value:{status:"valid",value:o.data[f]}});else if(c==="strict")u.length>0&&(I(o,{code:S.unrecognized_keys,keys:u}),i.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const f of u){const h=o.data[f];d.push({key:{status:"valid",value:f},value:c._parse(new ke(o,h,o.path,f)),alwaysSet:f in o.data})}}return o.common.async?Promise.resolve().then(async()=>{const c=[];for(const f of d){const h=await f.key,p=await f.value;c.push({key:h,value:p,alwaysSet:f.alwaysSet})}return c}).then(c=>de.mergeObjectSync(i,c)):de.mergeObjectSync(i,d)}get shape(){return this._def.shape()}strict(e){return k.errToObj,new j({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,i)=>{var r,l;const o=((l=(r=this._def).errorMap)==null?void 0:l.call(r,n,i).message)??i.defaultError;return n.code==="unrecognized_keys"?{message:k.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new j({...this._def,unknownKeys:"strip"})}passthrough(){return new j({...this._def,unknownKeys:"passthrough"})}extend(e){return new j({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new j({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:O.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new j({...this._def,catchall:e})}pick(e){const n={};for(const i of Y.objectKeys(e))e[i]&&this.shape[i]&&(n[i]=this.shape[i]);return new j({...this._def,shape:()=>n})}omit(e){const n={};for(const i of Y.objectKeys(this.shape))e[i]||(n[i]=this.shape[i]);return new j({...this._def,shape:()=>n})}deepPartial(){return st(this)}partial(e){const n={};for(const i of Y.objectKeys(this.shape)){const o=this.shape[i];e&&!e[i]?n[i]=o:n[i]=o.optional()}return new j({...this._def,shape:()=>n})}required(e){const n={};for(const i of Y.objectKeys(this.shape))if(e&&!e[i])n[i]=this.shape[i];else{let r=this.shape[i];for(;r instanceof Be;)r=r._def.innerType;n[i]=r}return new j({...this._def,shape:()=>n})}keyof(){return Qa(Y.objectKeys(this.shape))}}j.create=(t,e)=>new j({shape:()=>t,unknownKeys:"strip",catchall:Ge.create(),typeName:O.ZodObject,...q(e)});j.strictCreate=(t,e)=>new j({shape:()=>t,unknownKeys:"strict",catchall:Ge.create(),typeName:O.ZodObject,...q(e)});j.lazycreate=(t,e)=>new j({shape:t,unknownKeys:"strip",catchall:Ge.create(),typeName:O.ZodObject,...q(e)});class Mn extends W{_parse(e){const{ctx:n}=this._processInputParams(e),i=this._def.options;function o(r){for(const u of r)if(u.result.status==="valid")return u.result;for(const u of r)if(u.result.status==="dirty")return n.common.issues.push(...u.ctx.common.issues),u.result;const l=r.map(u=>new De(u.ctx.common.issues));return I(n,{code:S.invalid_union,unionErrors:l}),G}if(n.common.async)return Promise.all(i.map(async r=>{const l={...n,common:{...n.common,issues:[]},parent:null};return{result:await r._parseAsync({data:n.data,path:n.path,parent:l}),ctx:l}})).then(o);{let r;const l=[];for(const d of i){const c={...n,common:{...n.common,issues:[]},parent:null},f=d._parseSync({data:n.data,path:n.path,parent:c});if(f.status==="valid")return f;f.status==="dirty"&&!r&&(r={result:f,ctx:c}),c.common.issues.length&&l.push(c.common.issues)}if(r)return n.common.issues.push(...r.ctx.common.issues),r.result;const u=l.map(d=>new De(d));return I(n,{code:S.invalid_union,unionErrors:u}),G}}get options(){return this._def.options}}Mn.create=(t,e)=>new Mn({options:t,typeName:O.ZodUnion,...q(e)});function xi(t,e){const n=Oe(t),i=Oe(e);if(t===e)return{valid:!0,data:t};if(n===P.object&&i===P.object){const o=Y.objectKeys(e),r=Y.objectKeys(t).filter(u=>o.indexOf(u)!==-1),l={...t,...e};for(const u of r){const d=xi(t[u],e[u]);if(!d.valid)return{valid:!1};l[u]=d.data}return{valid:!0,data:l}}else if(n===P.array&&i===P.array){if(t.length!==e.length)return{valid:!1};const o=[];for(let r=0;r<t.length;r++){const l=t[r],u=e[r],d=xi(l,u);if(!d.valid)return{valid:!1};o.push(d.data)}return{valid:!0,data:o}}else return n===P.date&&i===P.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Rn extends W{_parse(e){const{status:n,ctx:i}=this._processInputParams(e),o=(r,l)=>{if(Ko(r)||Ko(l))return G;const u=xi(r.value,l.value);return u.valid?((Yo(r)||Yo(l))&&n.dirty(),{status:n.value,value:u.data}):(I(i,{code:S.invalid_intersection_types}),G)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([r,l])=>o(r,l)):o(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}Rn.create=(t,e,n)=>new Rn({left:t,right:e,typeName:O.ZodIntersection,...q(n)});class je extends W{_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==P.array)return I(i,{code:S.invalid_type,expected:P.array,received:i.parsedType}),G;if(i.data.length<this._def.items.length)return I(i,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),G;!this._def.rest&&i.data.length>this._def.items.length&&(I(i,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const r=[...i.data].map((l,u)=>{const d=this._def.items[u]||this._def.rest;return d?d._parse(new ke(i,l,i.path,u)):null}).filter(l=>!!l);return i.common.async?Promise.all(r).then(l=>de.mergeArray(n,l)):de.mergeArray(n,r)}get items(){return this._def.items}rest(e){return new je({...this._def,rest:e})}}je.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new je({items:t,typeName:O.ZodTuple,rest:null,...q(e)})};class Pn extends W{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==P.object)return I(i,{code:S.invalid_type,expected:P.object,received:i.parsedType}),G;const o=[],r=this._def.keyType,l=this._def.valueType;for(const u in i.data)o.push({key:r._parse(new ke(i,u,i.path,u)),value:l._parse(new ke(i,i.data[u],i.path,u)),alwaysSet:u in i.data});return i.common.async?de.mergeObjectAsync(n,o):de.mergeObjectSync(n,o)}get element(){return this._def.valueType}static create(e,n,i){return n instanceof W?new Pn({keyType:e,valueType:n,typeName:O.ZodRecord,...q(i)}):new Pn({keyType:Me.create(),valueType:e,typeName:O.ZodRecord,...q(n)})}}class ts extends W{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==P.map)return I(i,{code:S.invalid_type,expected:P.map,received:i.parsedType}),G;const o=this._def.keyType,r=this._def.valueType,l=[...i.data.entries()].map(([u,d],c)=>({key:o._parse(new ke(i,u,i.path,[c,"key"])),value:r._parse(new ke(i,d,i.path,[c,"value"]))}));if(i.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const d of l){const c=await d.key,f=await d.value;if(c.status==="aborted"||f.status==="aborted")return G;(c.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(c.value,f.value)}return{status:n.value,value:u}})}else{const u=new Map;for(const d of l){const c=d.key,f=d.value;if(c.status==="aborted"||f.status==="aborted")return G;(c.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(c.value,f.value)}return{status:n.value,value:u}}}}ts.create=(t,e,n)=>new ts({valueType:e,keyType:t,typeName:O.ZodMap,...q(n)});class Vt extends W{_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==P.set)return I(i,{code:S.invalid_type,expected:P.set,received:i.parsedType}),G;const o=this._def;o.minSize!==null&&i.data.size<o.minSize.value&&(I(i,{code:S.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),n.dirty()),o.maxSize!==null&&i.data.size>o.maxSize.value&&(I(i,{code:S.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),n.dirty());const r=this._def.valueType;function l(d){const c=new Set;for(const f of d){if(f.status==="aborted")return G;f.status==="dirty"&&n.dirty(),c.add(f.value)}return{status:n.value,value:c}}const u=[...i.data.values()].map((d,c)=>r._parse(new ke(i,d,i.path,c)));return i.common.async?Promise.all(u).then(d=>l(d)):l(u)}min(e,n){return new Vt({...this._def,minSize:{value:e,message:k.toString(n)}})}max(e,n){return new Vt({...this._def,maxSize:{value:e,message:k.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Vt.create=(t,e)=>new Vt({valueType:t,minSize:null,maxSize:null,typeName:O.ZodSet,...q(e)});class Ii extends W{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}Ii.create=(t,e)=>new Ii({getter:t,typeName:O.ZodLazy,...q(e)});class ns extends W{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return I(n,{received:n.data,code:S.invalid_literal,expected:this._def.value}),G}return{status:"valid",value:e.data}}get value(){return this._def.value}}ns.create=(t,e)=>new ns({value:t,typeName:O.ZodLiteral,...q(e)});function Qa(t,e){return new ft({values:t,typeName:O.ZodEnum,...q(e)})}class ft extends W{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),i=this._def.values;return I(n,{expected:Y.joinValues(i),received:n.parsedType,code:S.invalid_type}),G}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),i=this._def.values;return I(n,{received:n.data,code:S.invalid_enum_value,options:i}),G}return Ce(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return ft.create(e,{...this._def,...n})}exclude(e,n=this._def){return ft.create(this.options.filter(i=>!e.includes(i)),{...this._def,...n})}}ft.create=Qa;class is extends W{_parse(e){const n=Y.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==P.string&&i.parsedType!==P.number){const o=Y.objectValues(n);return I(i,{expected:Y.joinValues(o),received:i.parsedType,code:S.invalid_type}),G}if(this._cache||(this._cache=new Set(Y.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const o=Y.objectValues(n);return I(i,{received:i.data,code:S.invalid_enum_value,options:o}),G}return Ce(e.data)}get enum(){return this._def.values}}is.create=(t,e)=>new is({values:t,typeName:O.ZodNativeEnum,...q(e)});class kn extends W{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==P.promise&&n.common.async===!1)return I(n,{code:S.invalid_type,expected:P.promise,received:n.parsedType}),G;const i=n.parsedType===P.promise?n.data:Promise.resolve(n.data);return Ce(i.then(o=>this._def.type.parseAsync(o,{path:n.path,errorMap:n.common.contextualErrorMap})))}}kn.create=(t,e)=>new kn({type:t,typeName:O.ZodPromise,...q(e)});class ht extends W{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===O.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:i}=this._processInputParams(e),o=this._def.effect||null,r={addIssue:l=>{I(i,l),l.fatal?n.abort():n.dirty()},get path(){return i.path}};if(r.addIssue=r.addIssue.bind(r),o.type==="preprocess"){const l=o.transform(i.data,r);if(i.common.async)return Promise.resolve(l).then(async u=>{if(n.value==="aborted")return G;const d=await this._def.schema._parseAsync({data:u,path:i.path,parent:i});return d.status==="aborted"?G:d.status==="dirty"||n.value==="dirty"?kt(d.value):d});{if(n.value==="aborted")return G;const u=this._def.schema._parseSync({data:l,path:i.path,parent:i});return u.status==="aborted"?G:u.status==="dirty"||n.value==="dirty"?kt(u.value):u}}if(o.type==="refinement"){const l=u=>{const d=o.refinement(u,r);if(i.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(i.common.async===!1){const u=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return u.status==="aborted"?G:(u.status==="dirty"&&n.dirty(),l(u.value),{status:n.value,value:u.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(u=>u.status==="aborted"?G:(u.status==="dirty"&&n.dirty(),l(u.value).then(()=>({status:n.value,value:u.value}))))}if(o.type==="transform")if(i.common.async===!1){const l=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!ct(l))return G;const u=o.transform(l.value,r);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:u}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(l=>ct(l)?Promise.resolve(o.transform(l.value,r)).then(u=>({status:n.value,value:u})):G);Y.assertNever(o)}}ht.create=(t,e,n)=>new ht({schema:t,typeName:O.ZodEffects,effect:e,...q(n)});ht.createWithPreprocess=(t,e,n)=>new ht({schema:e,effect:{type:"preprocess",transform:t},typeName:O.ZodEffects,...q(n)});class Be extends W{_parse(e){return this._getType(e)===P.undefined?Ce(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Be.create=(t,e)=>new Be({innerType:t,typeName:O.ZodOptional,...q(e)});class pt extends W{_parse(e){return this._getType(e)===P.null?Ce(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}pt.create=(t,e)=>new pt({innerType:t,typeName:O.ZodNullable,...q(e)});class Mi extends W{_parse(e){const{ctx:n}=this._processInputParams(e);let i=n.data;return n.parsedType===P.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}Mi.create=(t,e)=>new Mi({innerType:t,typeName:O.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...q(e)});class Ri extends W{_parse(e){const{ctx:n}=this._processInputParams(e),i={...n,common:{...n.common,issues:[]}},o=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return xn(o)?o.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new De(i.common.issues)},input:i.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new De(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}Ri.create=(t,e)=>new Ri({innerType:t,typeName:O.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...q(e)});class os extends W{_parse(e){if(this._getType(e)!==P.nan){const i=this._getOrReturnCtx(e);return I(i,{code:S.invalid_type,expected:P.nan,received:i.parsedType}),G}return{status:"valid",value:e.data}}}os.create=t=>new os({typeName:O.ZodNaN,...q(t)});class Mc extends W{_parse(e){const{ctx:n}=this._processInputParams(e),i=n.data;return this._def.type._parse({data:i,path:n.path,parent:n})}unwrap(){return this._def.type}}class co extends W{_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{const r=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?G:r.status==="dirty"?(n.dirty(),kt(r.value)):this._def.out._parseAsync({data:r.value,path:i.path,parent:i})})();{const o=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return o.status==="aborted"?G:o.status==="dirty"?(n.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:i.path,parent:i})}}static create(e,n){return new co({in:e,out:n,typeName:O.ZodPipeline})}}class Pi extends W{_parse(e){const n=this._def.innerType._parse(e),i=o=>(ct(o)&&(o.value=Object.freeze(o.value)),o);return xn(n)?n.then(o=>i(o)):i(n)}unwrap(){return this._def.innerType}}Pi.create=(t,e)=>new Pi({innerType:t,typeName:O.ZodReadonly,...q(e)});var O;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(O||(O={}));const He=Me.create,ss=Xe.create;Qe.create;const Rc=In.create;dt.create;const rs=Ei.create;Ge.create;const Nt=Pe.create,Pc=j.create,kc=Mn.create;Rn.create;je.create;const Nc=Pn.create,bc=Ii.create,Dc=ft.create;kn.create;Be.create;pt.create;const nt={string:t=>Me.create({...t,coerce:!0}),number:t=>Xe.create({...t,coerce:!0}),boolean:t=>In.create({...t,coerce:!0}),bigint:t=>Qe.create({...t,coerce:!0}),date:t=>dt.create({...t,coerce:!0})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Lc,Fc;function Uc(){return{geminiUrl:Lc,vertexUrl:Fc}}function Vc(t,e,n){var i,o,r;if(!(!((i=t.httpOptions)===null||i===void 0)&&i.baseUrl)){const l=Uc();return t.vertexai?(o=l.vertexUrl)!==null&&o!==void 0?o:e:(r=l.geminiUrl)!==null&&r!==void 0?r:n}return t.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yt{}function F(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(i,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){const r=e[o];return r!=null?String(r):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function a(t,e,n){for(let r=0;r<e.length-1;r++){const l=e[r];if(l.endsWith("[]")){const u=l.slice(0,-2);if(!(u in t))if(Array.isArray(n))t[u]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(t[u])){const d=t[u];if(Array.isArray(n))for(let c=0;c<d.length;c++){const f=d[c];a(f,e.slice(r+1),n[c])}else for(const c of d)a(c,e.slice(r+1),n)}return}else if(l.endsWith("[0]")){const u=l.slice(0,-3);u in t||(t[u]=[{}]);const d=t[u];a(d[0],e.slice(r+1),n);return}(!t[l]||typeof t[l]!="object")&&(t[l]={}),t=t[l]}const i=e[e.length-1],o=t[i];if(o!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===o)return;if(typeof o=="object"&&typeof n=="object"&&o!==null&&n!==null)Object.assign(o,n);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else t[i]=n}function s(t,e){try{if(e.length===1&&e[0]==="_self")return t;for(let n=0;n<e.length;n++){if(typeof t!="object"||t===null)return;const i=e[n];if(i.endsWith("[]")){const o=i.slice(0,-2);if(o in t){const r=t[o];return Array.isArray(r)?r.map(l=>s(l,e.slice(n+1))):void 0}else return}else t=t[i]}return t}catch(n){if(n instanceof TypeError)return;throw n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var as;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(as||(as={}));var ls;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(ls||(ls={}));var Re;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Re||(Re={}));var us;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(us||(us={}));var cs;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(cs||(cs={}));var ds;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(ds||(ds={}));var fs;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(fs||(fs={}));var hs;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(hs||(hs={}));var ps;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(ps||(ps={}));var ms;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(ms||(ms={}));var gs;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(gs||(gs={}));var ys;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(ys||(ys={}));var _s;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(_s||(_s={}));var Nn;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Nn||(Nn={}));var vs;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(vs||(vs={}));var ki;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(ki||(ki={}));var Cs;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Cs||(Cs={}));var Ts;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Ts||(Ts={}));var ws;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(ws||(ws={}));var Ss;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Ss||(Ss={}));var As;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(As||(As={}));var Es;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(Es||(Es={}));var xs;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(xs||(xs={}));var Is;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(Is||(Is={}));var Ms;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi"})(Ms||(Ms={}));var Rs;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Rs||(Rs={}));var Ps;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Ps||(Ps={}));var ks;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(ks||(ks={}));var Ns;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Ns||(Ns={}));var bs;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(bs||(bs={}));var Ds;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Ds||(Ds={}));var Ls;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(Ls||(Ls={}));var Fs;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Fs||(Fs={}));var Us;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Us||(Us={}));var Vs;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Vs||(Vs={}));var $s;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})($s||($s={}));var Os;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(Os||(Os={}));var Bs;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Bs||(Bs={}));var at;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(at||(at={}));class Ni{constructor(e){const n={};for(const i of e.headers.entries())n[i[0]]=i[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class wt{get text(){var e,n,i,o,r,l,u,d;if(((o=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",f=!1;const h=[];for(const p of(d=(u=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[m,g]of Object.entries(p))m!=="text"&&m!=="thought"&&(g!==null||g!==void 0)&&h.push(m);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;f=!0,c+=p.text}}return h.length>0&&console.warn(`there are non-text parts ${h} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?c:void 0}get data(){var e,n,i,o,r,l,u,d;if(((o=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const f=[];for(const h of(d=(u=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[p,m]of Object.entries(h))p!=="inlineData"&&(m!==null||m!==void 0)&&f.push(p);h.inlineData&&typeof h.inlineData.data=="string"&&(c+=atob(h.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,n,i,o,r,l,u,d;if(((o=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(d=(u=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,n,i,o,r,l,u,d,c;if(((o=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(u=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(h=>h.executableCode).map(h=>h.executableCode).filter(h=>h!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,n,i,o,r,l,u,d,c;if(((o=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(u=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(h=>h.codeExecutionResult).map(h=>h.codeExecutionResult).filter(h=>h!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.output}}class Gs{}class qs{}class $c{}class Oc{}class Js{}class Hs{}class Ws{}class Bc{}class Ks{}class Ys{}class zs{}class Gc{}class qc{}class Jc{}class Hc{get text(){var e,n,i;let o="",r=!1;const l=[];for(const u of(i=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&i!==void 0?i:[]){for(const[d,c]of Object.entries(u))d!=="text"&&d!=="thought"&&c!==null&&l.push(d);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;r=!0,o+=u.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?o:void 0}get data(){var e,n,i;let o="";const r=[];for(const l of(i=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&i!==void 0?i:[]){for(const[u,d]of Object.entries(l))u!=="inlineData"&&d!==null&&r.push(u);l.inlineData&&typeof l.inlineData.data=="string"&&(o+=atob(l.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}}class Wc{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Z(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function ja(t,e){const n=Z(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function el(t){return Array.isArray(t)?t.map(e=>bn(e)):[bn(t)]}function bn(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function Kc(t){const e=bn(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Yc(t){const e=bn(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Zs(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function tl(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Zs(e)):[Zs(t)]}function bi(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function Xs(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function Qs(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function ce(t){if(t==null)throw new Error("ContentUnion is required");return bi(t)?t:{role:"user",parts:tl(t)}}function nl(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const i=ce(n);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(t.isVertexAI()){const n=ce(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>ce(n)):[ce(e)]}function Ae(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(Xs(t)||Qs(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ce(t)]}const e=[],n=[],i=bi(t[0]);for(const o of t){const r=bi(o);if(r!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(o);else{if(Xs(o)||Qs(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(o)}}return i||e.push({role:"user",parts:tl(n)}),e}const zc=new Set(["type","format","title","description","default","items","minItems","maxItems","enum","properties","required","minProperties","maxProperties","minimum","maximum","minLength","maxLength","pattern","anyOf","propertyOrdering"]),js=Dc(["string","number","integer","object","array","boolean","null"]),Zc=kc([js,Nt(js)]);function Xc(t=!0){const e=bc(()=>{const n=Pc({type:Zc.optional(),format:He().optional(),title:He().optional(),description:He().optional(),default:rs().optional(),items:e.optional(),minItems:nt.string().optional(),maxItems:nt.string().optional(),enum:Nt(rs()).optional(),properties:Nc(He(),e).optional(),required:Nt(He()).optional(),minProperties:nt.string().optional(),maxProperties:nt.string().optional(),propertyOrdering:Nt(He()).optional(),minimum:ss().optional(),maximum:ss().optional(),minLength:nt.string().optional(),maxLength:nt.string().optional(),pattern:He().optional(),anyOf:Nt(e).optional(),additionalProperties:Rc().optional()});return t?n.strict():n});return e}function Qc(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(i=>i!=="null");if(n.length===1)e.type=Object.values(Re).includes(n[0].toUpperCase())?n[0].toUpperCase():Re.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const i of n)e.anyOf.push({type:Object.values(Re).includes(i.toUpperCase())?i.toUpperCase():Re.TYPE_UNSPECIFIED})}}function lt(t){const e={},n=["items"],i=["anyOf"],o=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=t.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,t=r[1]):r[1].type==="null"&&(e.nullable=!0,t=r[0])),t.type instanceof Array&&Qc(t.type,e);for(const[l,u]of Object.entries(t))if(u!=null)if(l=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(Re).includes(u.toUpperCase())?u.toUpperCase():Re.TYPE_UNSPECIFIED}else if(n.includes(l))e[l]=lt(u);else if(i.includes(l)){const d=[];for(const c of u){if(c.type=="null"){e.nullable=!0;continue}d.push(lt(c))}e[l]=d}else if(o.includes(l)){const d={};for(const[c,f]of Object.entries(u))d[c]=lt(f);e[l]=d}else{if(l==="additionalProperties")continue;e[l]=u}return e}function Dn(t){if(Object.keys(t).includes("$schema")){delete t.$schema;const e=Xc().parse(t);return lt(e)}else return lt(t)}function il(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function fo(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Wt(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(e.parameters=Dn(e.parameters)),e.response&&(e.response=Dn(e.response));return t}function Kt(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function jc(t,e,n,i=1){const o=!e.startsWith(`${n}/`)&&e.split("/").length===i;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:o?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:o?`${n}/${e}`:e}function Je(t,e){if(typeof e!="string")throw new Error("name must be a string");return jc(t,e,"cachedContents")}function ol(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Le(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function ed(t){return t!=null&&typeof t=="object"&&"name"in t}function td(t){return t!=null&&typeof t=="object"&&"video"in t}function nd(t){return t!=null&&typeof t=="object"&&"uri"in t}function sl(t){var e;let n;if(ed(t)&&(n=t.name),!(nd(t)&&(n=t.uri,n===void 0))&&!(td(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const o=n.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${n}`);n=o[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function rl(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function al(t){for(const e of["models","tunedModels","publisherModels"])if(id(t,e))return t[e];return[]}function id(t,e){return t!==null&&typeof t=="object"&&e in t}function od(t,e={}){const n=t,i={name:n.name,description:n.description,parameters:lt(Hn(n.inputSchema))};return e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function sd(t,e={}){const n=[],i=new Set;for(const o of t){const r=o.name;if(i.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);i.add(r);const l=od(o,e);l.functionDeclarations&&n.push(...l.functionDeclarations)}return{functionDeclarations:n}}function rd(t){const e=[];for(const n of t)e.push(Hn(n));return e}function ad(t){const e={};for(const[n,i]of Object.entries(t)){const o=i;e[n]=Hn(o)}return e}function Hn(t){const e=new Set(["items"]),n=new Set(["anyOf"]),i=new Set(["properties"]),o={};for(const[r,l]of Object.entries(t))if(e.has(r))o[r]=Hn(l);else if(n.has(r))o[r]=rd(l);else if(i.has(r))o[r]=ad(l);else if(r==="type"){const u=l.toUpperCase();o[r]=Object.values(Re).includes(u)?u:Re.TYPE_UNSPECIFIED}else zc.has(r)&&(o[r]=l);return o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ld(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function ud(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["data"]);n!=null&&a(e,["data"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function cd(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function dd(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],ld(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],ud(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],cd(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function er(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>dd(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function fd(t){const e={},n=s(t,["behavior"]);n!=null&&a(e,["behavior"],n);const i=s(t,["description"]);i!=null&&a(e,["description"],i);const o=s(t,["name"]);o!=null&&a(e,["name"],o);const r=s(t,["parameters"]);r!=null&&a(e,["parameters"],r);const l=s(t,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const u=s(t,["response"]);u!=null&&a(e,["response"],u);const d=s(t,["responseJsonSchema"]);return d!=null&&a(e,["responseJsonSchema"],d),e}function hd(t){const e={},n=s(t,["startTime"]);n!=null&&a(e,["startTime"],n);const i=s(t,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function pd(t){const e={},n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],hd(n)),e}function md(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function gd(t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],md(n)),e}function yd(){return{}}function _d(t){const e={},n=s(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>fd(d))),a(e,["functionDeclarations"],u)}if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=s(t,["googleSearch"]);i!=null&&a(e,["googleSearch"],pd(i));const o=s(t,["googleSearchRetrieval"]);if(o!=null&&a(e,["googleSearchRetrieval"],gd(o)),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(s(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");s(t,["urlContext"])!=null&&a(e,["urlContext"],yd());const l=s(t,["codeExecution"]);return l!=null&&a(e,["codeExecution"],l),e}function vd(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&a(e,["allowedFunctionNames"],i),e}function Cd(t){const e={},n=s(t,["latitude"]);n!=null&&a(e,["latitude"],n);const i=s(t,["longitude"]);return i!=null&&a(e,["longitude"],i),e}function Td(t){const e={},n=s(t,["latLng"]);n!=null&&a(e,["latLng"],Cd(n));const i=s(t,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function wd(t){const e={},n=s(t,["functionCallingConfig"]);n!=null&&a(e,["functionCallingConfig"],vd(n));const i=s(t,["retrievalConfig"]);return i!=null&&a(e,["retrievalConfig"],Td(i)),e}function Sd(t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&a(e,["ttl"],i);const o=s(t,["expireTime"]);e!==void 0&&o!=null&&a(e,["expireTime"],o);const r=s(t,["displayName"]);e!==void 0&&r!=null&&a(e,["displayName"],r);const l=s(t,["contents"]);if(e!==void 0&&l!=null){let f=Ae(l);Array.isArray(f)&&(f=f.map(h=>er(h))),a(e,["contents"],f)}const u=s(t,["systemInstruction"]);e!==void 0&&u!=null&&a(e,["systemInstruction"],er(ce(u)));const d=s(t,["tools"]);if(e!==void 0&&d!=null){let f=d;Array.isArray(f)&&(f=f.map(h=>_d(h))),a(e,["tools"],f)}const c=s(t,["toolConfig"]);if(e!==void 0&&c!=null&&a(e,["toolConfig"],wd(c)),s(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function Ad(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["model"],ja(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],Sd(o,n)),n}function Ed(t,e){const n={},i=s(e,["name"]);i!=null&&a(n,["_url","name"],Je(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],o),n}function xd(t,e){const n={},i=s(e,["name"]);i!=null&&a(n,["_url","name"],Je(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],o),n}function Id(t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&a(e,["ttl"],i);const o=s(t,["expireTime"]);return e!==void 0&&o!=null&&a(e,["expireTime"],o),n}function Md(t,e){const n={},i=s(e,["name"]);i!=null&&a(n,["_url","name"],Je(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],Id(o,n)),n}function Rd(t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=s(t,["pageToken"]);return e!==void 0&&o!=null&&a(e,["_query","pageToken"],o),n}function Pd(t){const e={},n=s(t,["config"]);return n!=null&&a(e,["config"],Rd(n,e)),e}function kd(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function Nd(t){const e={},n=s(t,["displayName"]);n!=null&&a(e,["displayName"],n);const i=s(t,["data"]);i!=null&&a(e,["data"],i);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function bd(t){const e={},n=s(t,["displayName"]);n!=null&&a(e,["displayName"],n);const i=s(t,["fileUri"]);i!=null&&a(e,["fileUri"],i);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Dd(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],kd(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],Nd(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],bd(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function tr(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Dd(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function Ld(t){const e={};if(s(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=s(t,["description"]);n!=null&&a(e,["description"],n);const i=s(t,["name"]);i!=null&&a(e,["name"],i);const o=s(t,["parameters"]);o!=null&&a(e,["parameters"],o);const r=s(t,["parametersJsonSchema"]);r!=null&&a(e,["parametersJsonSchema"],r);const l=s(t,["response"]);l!=null&&a(e,["response"],l);const u=s(t,["responseJsonSchema"]);return u!=null&&a(e,["responseJsonSchema"],u),e}function Fd(t){const e={},n=s(t,["startTime"]);n!=null&&a(e,["startTime"],n);const i=s(t,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function Ud(t){const e={},n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],Fd(n)),e}function Vd(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function $d(t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],Vd(n)),e}function Od(){return{}}function Bd(t){const e={},n=s(t,["apiKeyString"]);return n!=null&&a(e,["apiKeyString"],n),e}function Gd(t){const e={},n=s(t,["apiKeyConfig"]);n!=null&&a(e,["apiKeyConfig"],Bd(n));const i=s(t,["authType"]);i!=null&&a(e,["authType"],i);const o=s(t,["googleServiceAccountConfig"]);o!=null&&a(e,["googleServiceAccountConfig"],o);const r=s(t,["httpBasicAuthConfig"]);r!=null&&a(e,["httpBasicAuthConfig"],r);const l=s(t,["oauthConfig"]);l!=null&&a(e,["oauthConfig"],l);const u=s(t,["oidcConfig"]);return u!=null&&a(e,["oidcConfig"],u),e}function qd(t){const e={},n=s(t,["authConfig"]);return n!=null&&a(e,["authConfig"],Gd(n)),e}function Jd(){return{}}function Hd(t){const e={},n=s(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(h=>Ld(h))),a(e,["functionDeclarations"],f)}const i=s(t,["retrieval"]);i!=null&&a(e,["retrieval"],i);const o=s(t,["googleSearch"]);o!=null&&a(e,["googleSearch"],Ud(o));const r=s(t,["googleSearchRetrieval"]);r!=null&&a(e,["googleSearchRetrieval"],$d(r)),s(t,["enterpriseWebSearch"])!=null&&a(e,["enterpriseWebSearch"],Od());const u=s(t,["googleMaps"]);u!=null&&a(e,["googleMaps"],qd(u)),s(t,["urlContext"])!=null&&a(e,["urlContext"],Jd());const c=s(t,["codeExecution"]);return c!=null&&a(e,["codeExecution"],c),e}function Wd(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&a(e,["allowedFunctionNames"],i),e}function Kd(t){const e={},n=s(t,["latitude"]);n!=null&&a(e,["latitude"],n);const i=s(t,["longitude"]);return i!=null&&a(e,["longitude"],i),e}function Yd(t){const e={},n=s(t,["latLng"]);n!=null&&a(e,["latLng"],Kd(n));const i=s(t,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function zd(t){const e={},n=s(t,["functionCallingConfig"]);n!=null&&a(e,["functionCallingConfig"],Wd(n));const i=s(t,["retrievalConfig"]);return i!=null&&a(e,["retrievalConfig"],Yd(i)),e}function Zd(t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&a(e,["ttl"],i);const o=s(t,["expireTime"]);e!==void 0&&o!=null&&a(e,["expireTime"],o);const r=s(t,["displayName"]);e!==void 0&&r!=null&&a(e,["displayName"],r);const l=s(t,["contents"]);if(e!==void 0&&l!=null){let h=Ae(l);Array.isArray(h)&&(h=h.map(p=>tr(p))),a(e,["contents"],h)}const u=s(t,["systemInstruction"]);e!==void 0&&u!=null&&a(e,["systemInstruction"],tr(ce(u)));const d=s(t,["tools"]);if(e!==void 0&&d!=null){let h=d;Array.isArray(h)&&(h=h.map(p=>Hd(p))),a(e,["tools"],h)}const c=s(t,["toolConfig"]);e!==void 0&&c!=null&&a(e,["toolConfig"],zd(c));const f=s(t,["kmsKeyName"]);return e!==void 0&&f!=null&&a(e,["encryption_spec","kmsKeyName"],f),n}function Xd(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["model"],ja(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],Zd(o,n)),n}function Qd(t,e){const n={},i=s(e,["name"]);i!=null&&a(n,["_url","name"],Je(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],o),n}function jd(t,e){const n={},i=s(e,["name"]);i!=null&&a(n,["_url","name"],Je(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],o),n}function ef(t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&a(e,["ttl"],i);const o=s(t,["expireTime"]);return e!==void 0&&o!=null&&a(e,["expireTime"],o),n}function tf(t,e){const n={},i=s(e,["name"]);i!=null&&a(n,["_url","name"],Je(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],ef(o,n)),n}function nf(t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=s(t,["pageToken"]);return e!==void 0&&o!=null&&a(e,["_query","pageToken"],o),n}function of(t){const e={},n=s(t,["config"]);return n!=null&&a(e,["config"],nf(n,e)),e}function mn(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["displayName"]);i!=null&&a(e,["displayName"],i);const o=s(t,["model"]);o!=null&&a(e,["model"],o);const r=s(t,["createTime"]);r!=null&&a(e,["createTime"],r);const l=s(t,["updateTime"]);l!=null&&a(e,["updateTime"],l);const u=s(t,["expireTime"]);u!=null&&a(e,["expireTime"],u);const d=s(t,["usageMetadata"]);return d!=null&&a(e,["usageMetadata"],d),e}function sf(){return{}}function rf(t){const e={},n=s(t,["nextPageToken"]);n!=null&&a(e,["nextPageToken"],n);const i=s(t,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>mn(r))),a(e,["cachedContents"],o)}return e}function gn(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["displayName"]);i!=null&&a(e,["displayName"],i);const o=s(t,["model"]);o!=null&&a(e,["model"],o);const r=s(t,["createTime"]);r!=null&&a(e,["createTime"],r);const l=s(t,["updateTime"]);l!=null&&a(e,["updateTime"],l);const u=s(t,["expireTime"]);u!=null&&a(e,["expireTime"],u);const d=s(t,["usageMetadata"]);return d!=null&&a(e,["usageMetadata"],d),e}function af(){return{}}function lf(t){const e={},n=s(t,["nextPageToken"]);n!=null&&a(e,["nextPageToken"],n);const i=s(t,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>gn(r))),a(e,["cachedContents"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var mt;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(mt||(mt={}));class Wn{constructor(e,n,i,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,i,o)}init(e,n,i){var o,r;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.idxInternal=0;let l={config:{}};i?typeof i=="object"?l=Object.assign({},i):l=i:l={config:{}},l.config&&(l.config.pageToken=n.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(r=(o=l.config)===null||o===void 0?void 0:o.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class uf extends yt{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Wn(mt.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(n),n)}async create(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Xd(this.apiClient,e);return u=F("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>gn(f))}else{const c=Ad(this.apiClient,e);return u=F("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>mn(f))}}async get(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Qd(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>gn(f))}else{const c=Ed(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>mn(f))}}async delete(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=jd(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(()=>{const f=af(),h=new Ys;return Object.assign(h,f),h})}else{const c=xd(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(()=>{const f=sf(),h=new Ys;return Object.assign(h,f),h})}}async update(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=tf(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>gn(f))}else{const c=Md(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>mn(f))}}async listInternal(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=of(e);return u=F("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>{const h=lf(f),p=new zs;return Object.assign(p,h),p})}else{const c=Pd(e);return u=F("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const h=rf(f),p=new zs;return Object.assign(p,h),p})}}}function nr(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function X(t){return this instanceof X?(this.v=t,this):new X(t)}function ut(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),o,r=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",l),o[Symbol.asyncIterator]=function(){return this},o;function l(m){return function(g){return Promise.resolve(g).then(m,h)}}function u(m,g){i[m]&&(o[m]=function(y){return new Promise(function(v,E){r.push([m,y,v,E])>1||d(m,y)})},g&&(o[m]=g(o[m])))}function d(m,g){try{c(i[m](g))}catch(y){p(r[0][3],y)}}function c(m){m.value instanceof X?Promise.resolve(m.value.v).then(f,h):p(r[0][2],m)}function f(m){d("next",m)}function h(m){d("throw",m)}function p(m,g){m(g),r.shift(),r.length&&d(r[0][0],r[0][1])}}function Ft(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof nr=="function"?nr(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(r){n[r]=t[r]&&function(l){return new Promise(function(u,d){l=t[r](l),o(u,d,l.done,l.value)})}}function o(r,l,u,d){Promise.resolve(d).then(function(c){r({value:c,done:u})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cf(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:ll(n)}function ll(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function df(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function ir(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let i=0;for(;i<n;)if(t[i].role==="user")e.push(t[i]),i++;else{const o=[];let r=!0;for(;i<n&&t[i].role==="model";)o.push(t[i]),r&&!ll(t[i])&&(r=!1),i++;r?e.push(...o):e.pop()}return e}class ff{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new hf(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class hf{constructor(e,n,i,o={},r=[]){this.apiClient=e,this.modelsModule=n,this.model=i,this.config=o,this.history=r,this.sendPromise=Promise.resolve(),df(r)}async sendMessage(e){var n;await this.sendPromise;const i=ce(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var r,l,u;const d=await o,c=(l=(r=d.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content,f=d.automaticFunctionCallingHistory,h=this.getHistory(!0).length;let p=[];f!=null&&(p=(u=f.slice(h))!==null&&u!==void 0?u:[]);const m=c?[c]:[];this.recordHistory(i,m,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var n;await this.sendPromise;const i=ce(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});const r=await o;return this.processStreamResponse(r,i)}getHistory(e=!1){const n=e?ir(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var i,o;return ut(this,arguments,function*(){var l,u,d,c;const f=[];try{for(var h=!0,p=Ft(e),m;m=yield X(p.next()),l=m.done,!l;h=!0){c=m.value,h=!1;const g=c;if(cf(g)){const y=(o=(i=g.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content;y!==void 0&&f.push(y)}yield yield X(g)}}catch(g){u={error:g}}finally{try{!h&&!l&&(d=p.return)&&(yield X(d.call(p)))}finally{if(u)throw u.error}}this.recordHistory(n,f)})}recordHistory(e,n,i){let o=[];n.length>0&&n.every(r=>r.role!==void 0)?o=n:o.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...ir(i)):this.history.push(e),this.history.push(...o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Kn extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Kn.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pf(t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=s(t,["pageToken"]);return e!==void 0&&o!=null&&a(e,["_query","pageToken"],o),n}function mf(t){const e={},n=s(t,["config"]);return n!=null&&a(e,["config"],pf(n,e)),e}function gf(t){const e={},n=s(t,["details"]);n!=null&&a(e,["details"],n);const i=s(t,["message"]);i!=null&&a(e,["message"],i);const o=s(t,["code"]);return o!=null&&a(e,["code"],o),e}function yf(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["displayName"]);i!=null&&a(e,["displayName"],i);const o=s(t,["mimeType"]);o!=null&&a(e,["mimeType"],o);const r=s(t,["sizeBytes"]);r!=null&&a(e,["sizeBytes"],r);const l=s(t,["createTime"]);l!=null&&a(e,["createTime"],l);const u=s(t,["expirationTime"]);u!=null&&a(e,["expirationTime"],u);const d=s(t,["updateTime"]);d!=null&&a(e,["updateTime"],d);const c=s(t,["sha256Hash"]);c!=null&&a(e,["sha256Hash"],c);const f=s(t,["uri"]);f!=null&&a(e,["uri"],f);const h=s(t,["downloadUri"]);h!=null&&a(e,["downloadUri"],h);const p=s(t,["state"]);p!=null&&a(e,["state"],p);const m=s(t,["source"]);m!=null&&a(e,["source"],m);const g=s(t,["videoMetadata"]);g!=null&&a(e,["videoMetadata"],g);const y=s(t,["error"]);return y!=null&&a(e,["error"],gf(y)),e}function _f(t){const e={},n=s(t,["file"]);n!=null&&a(e,["file"],yf(n));const i=s(t,["config"]);return i!=null&&a(e,["config"],i),e}function vf(t){const e={},n=s(t,["name"]);n!=null&&a(e,["_url","file"],sl(n));const i=s(t,["config"]);return i!=null&&a(e,["config"],i),e}function Cf(t){const e={},n=s(t,["name"]);n!=null&&a(e,["_url","file"],sl(n));const i=s(t,["config"]);return i!=null&&a(e,["config"],i),e}function Tf(t){const e={},n=s(t,["details"]);n!=null&&a(e,["details"],n);const i=s(t,["message"]);i!=null&&a(e,["message"],i);const o=s(t,["code"]);return o!=null&&a(e,["code"],o),e}function Di(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["displayName"]);i!=null&&a(e,["displayName"],i);const o=s(t,["mimeType"]);o!=null&&a(e,["mimeType"],o);const r=s(t,["sizeBytes"]);r!=null&&a(e,["sizeBytes"],r);const l=s(t,["createTime"]);l!=null&&a(e,["createTime"],l);const u=s(t,["expirationTime"]);u!=null&&a(e,["expirationTime"],u);const d=s(t,["updateTime"]);d!=null&&a(e,["updateTime"],d);const c=s(t,["sha256Hash"]);c!=null&&a(e,["sha256Hash"],c);const f=s(t,["uri"]);f!=null&&a(e,["uri"],f);const h=s(t,["downloadUri"]);h!=null&&a(e,["downloadUri"],h);const p=s(t,["state"]);p!=null&&a(e,["state"],p);const m=s(t,["source"]);m!=null&&a(e,["source"],m);const g=s(t,["videoMetadata"]);g!=null&&a(e,["videoMetadata"],g);const y=s(t,["error"]);return y!=null&&a(e,["error"],Tf(y)),e}function wf(t){const e={},n=s(t,["nextPageToken"]);n!=null&&a(e,["nextPageToken"],n);const i=s(t,["files"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>Di(r))),a(e,["files"],o)}return e}function Sf(){return{}}function Af(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ef extends yt{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Wn(mt.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>Di(n))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=mf(e);return r=F("files",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{const c=wf(d),f=new Gc;return Object.assign(f,c),f})}}async createInternal(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=_f(e);return r=F("upload/v1beta/files",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(()=>{const d=Sf(),c=new qc;return Object.assign(c,d),c})}}async get(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=vf(e);return r=F("files/{file}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>Di(d))}}async delete(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Cf(e);return r=F("files/{file}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(()=>{const d=Af(),c=new Jc;return Object.assign(c,d),c})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function xf(t){const e={},n=s(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function If(t){const e={},n=s(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function ul(t){const e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],xf(n)),e}function Mf(t){const e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],If(n)),e}function Rf(t){const e={},n=s(t,["speaker"]);n!=null&&a(e,["speaker"],n);const i=s(t,["voiceConfig"]);return i!=null&&a(e,["voiceConfig"],ul(i)),e}function Pf(t){const e={},n=s(t,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Rf(o))),a(e,["speakerVoiceConfigs"],i)}return e}function kf(t){const e={},n=s(t,["voiceConfig"]);n!=null&&a(e,["voiceConfig"],ul(n));const i=s(t,["multiSpeakerVoiceConfig"]);i!=null&&a(e,["multiSpeakerVoiceConfig"],Pf(i));const o=s(t,["languageCode"]);return o!=null&&a(e,["languageCode"],o),e}function Nf(t){const e={},n=s(t,["voiceConfig"]);if(n!=null&&a(e,["voiceConfig"],Mf(n)),s(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=s(t,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function bf(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function Df(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function Lf(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["data"]);n!=null&&a(e,["data"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Ff(t){const e={},n=s(t,["displayName"]);n!=null&&a(e,["displayName"],n);const i=s(t,["data"]);i!=null&&a(e,["data"],i);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Uf(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Vf(t){const e={},n=s(t,["displayName"]);n!=null&&a(e,["displayName"],n);const i=s(t,["fileUri"]);i!=null&&a(e,["fileUri"],i);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function $f(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],bf(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],Lf(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],Uf(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function Of(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],Df(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],Ff(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],Vf(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function Bf(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>$f(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function Gf(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Of(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function qf(t){const e={},n=s(t,["behavior"]);n!=null&&a(e,["behavior"],n);const i=s(t,["description"]);i!=null&&a(e,["description"],i);const o=s(t,["name"]);o!=null&&a(e,["name"],o);const r=s(t,["parameters"]);r!=null&&a(e,["parameters"],r);const l=s(t,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const u=s(t,["response"]);u!=null&&a(e,["response"],u);const d=s(t,["responseJsonSchema"]);return d!=null&&a(e,["responseJsonSchema"],d),e}function Jf(t){const e={};if(s(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=s(t,["description"]);n!=null&&a(e,["description"],n);const i=s(t,["name"]);i!=null&&a(e,["name"],i);const o=s(t,["parameters"]);o!=null&&a(e,["parameters"],o);const r=s(t,["parametersJsonSchema"]);r!=null&&a(e,["parametersJsonSchema"],r);const l=s(t,["response"]);l!=null&&a(e,["response"],l);const u=s(t,["responseJsonSchema"]);return u!=null&&a(e,["responseJsonSchema"],u),e}function Hf(t){const e={},n=s(t,["startTime"]);n!=null&&a(e,["startTime"],n);const i=s(t,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function Wf(t){const e={},n=s(t,["startTime"]);n!=null&&a(e,["startTime"],n);const i=s(t,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function Kf(t){const e={},n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],Hf(n)),e}function Yf(t){const e={},n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],Wf(n)),e}function zf(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function Zf(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function Xf(t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],zf(n)),e}function Qf(t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],Zf(n)),e}function jf(){return{}}function eh(t){const e={},n=s(t,["apiKeyString"]);return n!=null&&a(e,["apiKeyString"],n),e}function th(t){const e={},n=s(t,["apiKeyConfig"]);n!=null&&a(e,["apiKeyConfig"],eh(n));const i=s(t,["authType"]);i!=null&&a(e,["authType"],i);const o=s(t,["googleServiceAccountConfig"]);o!=null&&a(e,["googleServiceAccountConfig"],o);const r=s(t,["httpBasicAuthConfig"]);r!=null&&a(e,["httpBasicAuthConfig"],r);const l=s(t,["oauthConfig"]);l!=null&&a(e,["oauthConfig"],l);const u=s(t,["oidcConfig"]);return u!=null&&a(e,["oidcConfig"],u),e}function nh(t){const e={},n=s(t,["authConfig"]);return n!=null&&a(e,["authConfig"],th(n)),e}function ih(){return{}}function oh(){return{}}function sh(t){const e={},n=s(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>qf(d))),a(e,["functionDeclarations"],u)}if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=s(t,["googleSearch"]);i!=null&&a(e,["googleSearch"],Kf(i));const o=s(t,["googleSearchRetrieval"]);if(o!=null&&a(e,["googleSearchRetrieval"],Xf(o)),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(s(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");s(t,["urlContext"])!=null&&a(e,["urlContext"],ih());const l=s(t,["codeExecution"]);return l!=null&&a(e,["codeExecution"],l),e}function rh(t){const e={},n=s(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(h=>Jf(h))),a(e,["functionDeclarations"],f)}const i=s(t,["retrieval"]);i!=null&&a(e,["retrieval"],i);const o=s(t,["googleSearch"]);o!=null&&a(e,["googleSearch"],Yf(o));const r=s(t,["googleSearchRetrieval"]);r!=null&&a(e,["googleSearchRetrieval"],Qf(r)),s(t,["enterpriseWebSearch"])!=null&&a(e,["enterpriseWebSearch"],jf());const u=s(t,["googleMaps"]);u!=null&&a(e,["googleMaps"],nh(u)),s(t,["urlContext"])!=null&&a(e,["urlContext"],oh());const c=s(t,["codeExecution"]);return c!=null&&a(e,["codeExecution"],c),e}function ah(t){const e={},n=s(t,["handle"]);if(n!=null&&a(e,["handle"],n),s(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function lh(t){const e={},n=s(t,["handle"]);n!=null&&a(e,["handle"],n);const i=s(t,["transparent"]);return i!=null&&a(e,["transparent"],i),e}function or(){return{}}function sr(){return{}}function uh(t){const e={},n=s(t,["disabled"]);n!=null&&a(e,["disabled"],n);const i=s(t,["startOfSpeechSensitivity"]);i!=null&&a(e,["startOfSpeechSensitivity"],i);const o=s(t,["endOfSpeechSensitivity"]);o!=null&&a(e,["endOfSpeechSensitivity"],o);const r=s(t,["prefixPaddingMs"]);r!=null&&a(e,["prefixPaddingMs"],r);const l=s(t,["silenceDurationMs"]);return l!=null&&a(e,["silenceDurationMs"],l),e}function ch(t){const e={},n=s(t,["disabled"]);n!=null&&a(e,["disabled"],n);const i=s(t,["startOfSpeechSensitivity"]);i!=null&&a(e,["startOfSpeechSensitivity"],i);const o=s(t,["endOfSpeechSensitivity"]);o!=null&&a(e,["endOfSpeechSensitivity"],o);const r=s(t,["prefixPaddingMs"]);r!=null&&a(e,["prefixPaddingMs"],r);const l=s(t,["silenceDurationMs"]);return l!=null&&a(e,["silenceDurationMs"],l),e}function dh(t){const e={},n=s(t,["automaticActivityDetection"]);n!=null&&a(e,["automaticActivityDetection"],uh(n));const i=s(t,["activityHandling"]);i!=null&&a(e,["activityHandling"],i);const o=s(t,["turnCoverage"]);return o!=null&&a(e,["turnCoverage"],o),e}function fh(t){const e={},n=s(t,["automaticActivityDetection"]);n!=null&&a(e,["automaticActivityDetection"],ch(n));const i=s(t,["activityHandling"]);i!=null&&a(e,["activityHandling"],i);const o=s(t,["turnCoverage"]);return o!=null&&a(e,["turnCoverage"],o),e}function hh(t){const e={},n=s(t,["targetTokens"]);return n!=null&&a(e,["targetTokens"],n),e}function ph(t){const e={},n=s(t,["targetTokens"]);return n!=null&&a(e,["targetTokens"],n),e}function mh(t){const e={},n=s(t,["triggerTokens"]);n!=null&&a(e,["triggerTokens"],n);const i=s(t,["slidingWindow"]);return i!=null&&a(e,["slidingWindow"],hh(i)),e}function gh(t){const e={},n=s(t,["triggerTokens"]);n!=null&&a(e,["triggerTokens"],n);const i=s(t,["slidingWindow"]);return i!=null&&a(e,["slidingWindow"],ph(i)),e}function yh(t){const e={},n=s(t,["proactiveAudio"]);return n!=null&&a(e,["proactiveAudio"],n),e}function _h(t){const e={},n=s(t,["proactiveAudio"]);return n!=null&&a(e,["proactiveAudio"],n),e}function vh(t,e){const n={},i=s(t,["generationConfig"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig"],i);const o=s(t,["responseModalities"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig","responseModalities"],o);const r=s(t,["temperature"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig","temperature"],r);const l=s(t,["topP"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","topP"],l);const u=s(t,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const d=s(t,["maxOutputTokens"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","maxOutputTokens"],d);const c=s(t,["mediaResolution"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","mediaResolution"],c);const f=s(t,["seed"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","seed"],f);const h=s(t,["speechConfig"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","speechConfig"],kf(fo(h)));const p=s(t,["enableAffectiveDialog"]);e!==void 0&&p!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],p);const m=s(t,["systemInstruction"]);e!==void 0&&m!=null&&a(e,["setup","systemInstruction"],Bf(ce(m)));const g=s(t,["tools"]);if(e!==void 0&&g!=null){let M=Kt(g);Array.isArray(M)&&(M=M.map(D=>sh(Wt(D)))),a(e,["setup","tools"],M)}const y=s(t,["sessionResumption"]);e!==void 0&&y!=null&&a(e,["setup","sessionResumption"],ah(y));const v=s(t,["inputAudioTranscription"]);e!==void 0&&v!=null&&a(e,["setup","inputAudioTranscription"],or());const E=s(t,["outputAudioTranscription"]);e!==void 0&&E!=null&&a(e,["setup","outputAudioTranscription"],or());const C=s(t,["realtimeInputConfig"]);e!==void 0&&C!=null&&a(e,["setup","realtimeInputConfig"],dh(C));const T=s(t,["contextWindowCompression"]);e!==void 0&&T!=null&&a(e,["setup","contextWindowCompression"],mh(T));const w=s(t,["proactivity"]);return e!==void 0&&w!=null&&a(e,["setup","proactivity"],yh(w)),n}function Ch(t,e){const n={},i=s(t,["generationConfig"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig"],i);const o=s(t,["responseModalities"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig","responseModalities"],o);const r=s(t,["temperature"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig","temperature"],r);const l=s(t,["topP"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","topP"],l);const u=s(t,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const d=s(t,["maxOutputTokens"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","maxOutputTokens"],d);const c=s(t,["mediaResolution"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","mediaResolution"],c);const f=s(t,["seed"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","seed"],f);const h=s(t,["speechConfig"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","speechConfig"],Nf(fo(h)));const p=s(t,["enableAffectiveDialog"]);e!==void 0&&p!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],p);const m=s(t,["systemInstruction"]);e!==void 0&&m!=null&&a(e,["setup","systemInstruction"],Gf(ce(m)));const g=s(t,["tools"]);if(e!==void 0&&g!=null){let M=Kt(g);Array.isArray(M)&&(M=M.map(D=>rh(Wt(D)))),a(e,["setup","tools"],M)}const y=s(t,["sessionResumption"]);e!==void 0&&y!=null&&a(e,["setup","sessionResumption"],lh(y));const v=s(t,["inputAudioTranscription"]);e!==void 0&&v!=null&&a(e,["setup","inputAudioTranscription"],sr());const E=s(t,["outputAudioTranscription"]);e!==void 0&&E!=null&&a(e,["setup","outputAudioTranscription"],sr());const C=s(t,["realtimeInputConfig"]);e!==void 0&&C!=null&&a(e,["setup","realtimeInputConfig"],fh(C));const T=s(t,["contextWindowCompression"]);e!==void 0&&T!=null&&a(e,["setup","contextWindowCompression"],gh(T));const w=s(t,["proactivity"]);return e!==void 0&&w!=null&&a(e,["setup","proactivity"],_h(w)),n}function Th(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["setup","model"],Z(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],vh(o,n)),n}function wh(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["setup","model"],Z(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],Ch(o,n)),n}function Sh(){return{}}function Ah(){return{}}function Eh(){return{}}function xh(){return{}}function Ih(t){const e={},n=s(t,["media"]);n!=null&&a(e,["mediaChunks"],el(n));const i=s(t,["audio"]);i!=null&&a(e,["audio"],Yc(i));const o=s(t,["audioStreamEnd"]);o!=null&&a(e,["audioStreamEnd"],o);const r=s(t,["video"]);r!=null&&a(e,["video"],Kc(r));const l=s(t,["text"]);return l!=null&&a(e,["text"],l),s(t,["activityStart"])!=null&&a(e,["activityStart"],Sh()),s(t,["activityEnd"])!=null&&a(e,["activityEnd"],Eh()),e}function Mh(t){const e={},n=s(t,["media"]);if(n!=null&&a(e,["mediaChunks"],el(n)),s(t,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=s(t,["audioStreamEnd"]);if(i!=null&&a(e,["audioStreamEnd"],i),s(t,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(s(t,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return s(t,["activityStart"])!=null&&a(e,["activityStart"],Ah()),s(t,["activityEnd"])!=null&&a(e,["activityEnd"],xh()),e}function cl(t){const e={},n=s(t,["text"]);n!=null&&a(e,["text"],n);const i=s(t,["weight"]);return i!=null&&a(e,["weight"],i),e}function Rh(t){const e={},n=s(t,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>cl(o))),a(e,["weightedPrompts"],i)}return e}function dl(t){const e={},n=s(t,["temperature"]);n!=null&&a(e,["temperature"],n);const i=s(t,["topK"]);i!=null&&a(e,["topK"],i);const o=s(t,["seed"]);o!=null&&a(e,["seed"],o);const r=s(t,["guidance"]);r!=null&&a(e,["guidance"],r);const l=s(t,["bpm"]);l!=null&&a(e,["bpm"],l);const u=s(t,["density"]);u!=null&&a(e,["density"],u);const d=s(t,["brightness"]);d!=null&&a(e,["brightness"],d);const c=s(t,["scale"]);c!=null&&a(e,["scale"],c);const f=s(t,["muteBass"]);f!=null&&a(e,["muteBass"],f);const h=s(t,["muteDrums"]);h!=null&&a(e,["muteDrums"],h);const p=s(t,["onlyBassAndDrums"]);return p!=null&&a(e,["onlyBassAndDrums"],p),e}function Ph(t){const e={},n=s(t,["musicGenerationConfig"]);return n!=null&&a(e,["musicGenerationConfig"],dl(n)),e}function fl(t){const e={},n=s(t,["model"]);return n!=null&&a(e,["model"],n),e}function hl(t){const e={},n=s(t,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>cl(o))),a(e,["weightedPrompts"],i)}return e}function Li(t){const e={},n=s(t,["setup"]);n!=null&&a(e,["setup"],fl(n));const i=s(t,["clientContent"]);i!=null&&a(e,["clientContent"],hl(i));const o=s(t,["musicGenerationConfig"]);o!=null&&a(e,["musicGenerationConfig"],dl(o));const r=s(t,["playbackControl"]);return r!=null&&a(e,["playbackControl"],r),e}function kh(){return{}}function Nh(){return{}}function bh(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function Dh(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function Lh(t){const e={},n=s(t,["data"]);n!=null&&a(e,["data"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Fh(t){const e={},n=s(t,["displayName"]);n!=null&&a(e,["displayName"],n);const i=s(t,["data"]);i!=null&&a(e,["data"],i);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Uh(t){const e={},n=s(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Vh(t){const e={},n=s(t,["displayName"]);n!=null&&a(e,["displayName"],n);const i=s(t,["fileUri"]);i!=null&&a(e,["fileUri"],i);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function $h(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],bh(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],Lh(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],Uh(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function Oh(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],Dh(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],Fh(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],Vh(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function Bh(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>$h(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function Gh(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Oh(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function rr(t){const e={},n=s(t,["text"]);n!=null&&a(e,["text"],n);const i=s(t,["finished"]);return i!=null&&a(e,["finished"],i),e}function ar(t){const e={},n=s(t,["text"]);n!=null&&a(e,["text"],n);const i=s(t,["finished"]);return i!=null&&a(e,["finished"],i),e}function qh(t){const e={},n=s(t,["retrievedUrl"]);n!=null&&a(e,["retrievedUrl"],n);const i=s(t,["urlRetrievalStatus"]);return i!=null&&a(e,["urlRetrievalStatus"],i),e}function Jh(t){const e={},n=s(t,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>qh(o))),a(e,["urlMetadata"],i)}return e}function Hh(t){const e={},n=s(t,["modelTurn"]);n!=null&&a(e,["modelTurn"],Bh(n));const i=s(t,["turnComplete"]);i!=null&&a(e,["turnComplete"],i);const o=s(t,["interrupted"]);o!=null&&a(e,["interrupted"],o);const r=s(t,["groundingMetadata"]);r!=null&&a(e,["groundingMetadata"],r);const l=s(t,["generationComplete"]);l!=null&&a(e,["generationComplete"],l);const u=s(t,["inputTranscription"]);u!=null&&a(e,["inputTranscription"],rr(u));const d=s(t,["outputTranscription"]);d!=null&&a(e,["outputTranscription"],rr(d));const c=s(t,["urlContextMetadata"]);return c!=null&&a(e,["urlContextMetadata"],Jh(c)),e}function Wh(t){const e={},n=s(t,["modelTurn"]);n!=null&&a(e,["modelTurn"],Gh(n));const i=s(t,["turnComplete"]);i!=null&&a(e,["turnComplete"],i);const o=s(t,["interrupted"]);o!=null&&a(e,["interrupted"],o);const r=s(t,["groundingMetadata"]);r!=null&&a(e,["groundingMetadata"],r);const l=s(t,["generationComplete"]);l!=null&&a(e,["generationComplete"],l);const u=s(t,["inputTranscription"]);u!=null&&a(e,["inputTranscription"],ar(u));const d=s(t,["outputTranscription"]);return d!=null&&a(e,["outputTranscription"],ar(d)),e}function Kh(t){const e={},n=s(t,["id"]);n!=null&&a(e,["id"],n);const i=s(t,["args"]);i!=null&&a(e,["args"],i);const o=s(t,["name"]);return o!=null&&a(e,["name"],o),e}function Yh(t){const e={},n=s(t,["args"]);n!=null&&a(e,["args"],n);const i=s(t,["name"]);return i!=null&&a(e,["name"],i),e}function zh(t){const e={},n=s(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Kh(o))),a(e,["functionCalls"],i)}return e}function Zh(t){const e={},n=s(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Yh(o))),a(e,["functionCalls"],i)}return e}function Xh(t){const e={},n=s(t,["ids"]);return n!=null&&a(e,["ids"],n),e}function Qh(t){const e={},n=s(t,["ids"]);return n!=null&&a(e,["ids"],n),e}function nn(t){const e={},n=s(t,["modality"]);n!=null&&a(e,["modality"],n);const i=s(t,["tokenCount"]);return i!=null&&a(e,["tokenCount"],i),e}function on(t){const e={},n=s(t,["modality"]);n!=null&&a(e,["modality"],n);const i=s(t,["tokenCount"]);return i!=null&&a(e,["tokenCount"],i),e}function jh(t){const e={},n=s(t,["promptTokenCount"]);n!=null&&a(e,["promptTokenCount"],n);const i=s(t,["cachedContentTokenCount"]);i!=null&&a(e,["cachedContentTokenCount"],i);const o=s(t,["responseTokenCount"]);o!=null&&a(e,["responseTokenCount"],o);const r=s(t,["toolUsePromptTokenCount"]);r!=null&&a(e,["toolUsePromptTokenCount"],r);const l=s(t,["thoughtsTokenCount"]);l!=null&&a(e,["thoughtsTokenCount"],l);const u=s(t,["totalTokenCount"]);u!=null&&a(e,["totalTokenCount"],u);const d=s(t,["promptTokensDetails"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>nn(m))),a(e,["promptTokensDetails"],p)}const c=s(t,["cacheTokensDetails"]);if(c!=null){let p=c;Array.isArray(p)&&(p=p.map(m=>nn(m))),a(e,["cacheTokensDetails"],p)}const f=s(t,["responseTokensDetails"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(m=>nn(m))),a(e,["responseTokensDetails"],p)}const h=s(t,["toolUsePromptTokensDetails"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(m=>nn(m))),a(e,["toolUsePromptTokensDetails"],p)}return e}function ep(t){const e={},n=s(t,["promptTokenCount"]);n!=null&&a(e,["promptTokenCount"],n);const i=s(t,["cachedContentTokenCount"]);i!=null&&a(e,["cachedContentTokenCount"],i);const o=s(t,["candidatesTokenCount"]);o!=null&&a(e,["responseTokenCount"],o);const r=s(t,["toolUsePromptTokenCount"]);r!=null&&a(e,["toolUsePromptTokenCount"],r);const l=s(t,["thoughtsTokenCount"]);l!=null&&a(e,["thoughtsTokenCount"],l);const u=s(t,["totalTokenCount"]);u!=null&&a(e,["totalTokenCount"],u);const d=s(t,["promptTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(g=>on(g))),a(e,["promptTokensDetails"],m)}const c=s(t,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(g=>on(g))),a(e,["cacheTokensDetails"],m)}const f=s(t,["candidatesTokensDetails"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(g=>on(g))),a(e,["responseTokensDetails"],m)}const h=s(t,["toolUsePromptTokensDetails"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(g=>on(g))),a(e,["toolUsePromptTokensDetails"],m)}const p=s(t,["trafficType"]);return p!=null&&a(e,["trafficType"],p),e}function tp(t){const e={},n=s(t,["timeLeft"]);return n!=null&&a(e,["timeLeft"],n),e}function np(t){const e={},n=s(t,["timeLeft"]);return n!=null&&a(e,["timeLeft"],n),e}function ip(t){const e={},n=s(t,["newHandle"]);n!=null&&a(e,["newHandle"],n);const i=s(t,["resumable"]);i!=null&&a(e,["resumable"],i);const o=s(t,["lastConsumedClientMessageIndex"]);return o!=null&&a(e,["lastConsumedClientMessageIndex"],o),e}function op(t){const e={},n=s(t,["newHandle"]);n!=null&&a(e,["newHandle"],n);const i=s(t,["resumable"]);i!=null&&a(e,["resumable"],i);const o=s(t,["lastConsumedClientMessageIndex"]);return o!=null&&a(e,["lastConsumedClientMessageIndex"],o),e}function sp(t){const e={};s(t,["setupComplete"])!=null&&a(e,["setupComplete"],kh());const i=s(t,["serverContent"]);i!=null&&a(e,["serverContent"],Hh(i));const o=s(t,["toolCall"]);o!=null&&a(e,["toolCall"],zh(o));const r=s(t,["toolCallCancellation"]);r!=null&&a(e,["toolCallCancellation"],Xh(r));const l=s(t,["usageMetadata"]);l!=null&&a(e,["usageMetadata"],jh(l));const u=s(t,["goAway"]);u!=null&&a(e,["goAway"],tp(u));const d=s(t,["sessionResumptionUpdate"]);return d!=null&&a(e,["sessionResumptionUpdate"],ip(d)),e}function rp(t){const e={};s(t,["setupComplete"])!=null&&a(e,["setupComplete"],Nh());const i=s(t,["serverContent"]);i!=null&&a(e,["serverContent"],Wh(i));const o=s(t,["toolCall"]);o!=null&&a(e,["toolCall"],Zh(o));const r=s(t,["toolCallCancellation"]);r!=null&&a(e,["toolCallCancellation"],Qh(r));const l=s(t,["usageMetadata"]);l!=null&&a(e,["usageMetadata"],ep(l));const u=s(t,["goAway"]);u!=null&&a(e,["goAway"],np(u));const d=s(t,["sessionResumptionUpdate"]);return d!=null&&a(e,["sessionResumptionUpdate"],op(d)),e}function ap(){return{}}function lp(t){const e={},n=s(t,["text"]);n!=null&&a(e,["text"],n);const i=s(t,["weight"]);return i!=null&&a(e,["weight"],i),e}function up(t){const e={},n=s(t,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>lp(o))),a(e,["weightedPrompts"],i)}return e}function cp(t){const e={},n=s(t,["temperature"]);n!=null&&a(e,["temperature"],n);const i=s(t,["topK"]);i!=null&&a(e,["topK"],i);const o=s(t,["seed"]);o!=null&&a(e,["seed"],o);const r=s(t,["guidance"]);r!=null&&a(e,["guidance"],r);const l=s(t,["bpm"]);l!=null&&a(e,["bpm"],l);const u=s(t,["density"]);u!=null&&a(e,["density"],u);const d=s(t,["brightness"]);d!=null&&a(e,["brightness"],d);const c=s(t,["scale"]);c!=null&&a(e,["scale"],c);const f=s(t,["muteBass"]);f!=null&&a(e,["muteBass"],f);const h=s(t,["muteDrums"]);h!=null&&a(e,["muteDrums"],h);const p=s(t,["onlyBassAndDrums"]);return p!=null&&a(e,["onlyBassAndDrums"],p),e}function dp(t){const e={},n=s(t,["clientContent"]);n!=null&&a(e,["clientContent"],up(n));const i=s(t,["musicGenerationConfig"]);return i!=null&&a(e,["musicGenerationConfig"],cp(i)),e}function fp(t){const e={},n=s(t,["data"]);n!=null&&a(e,["data"],n);const i=s(t,["mimeType"]);i!=null&&a(e,["mimeType"],i);const o=s(t,["sourceMetadata"]);return o!=null&&a(e,["sourceMetadata"],dp(o)),e}function hp(t){const e={},n=s(t,["audioChunks"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>fp(o))),a(e,["audioChunks"],i)}return e}function pp(t){const e={},n=s(t,["text"]);n!=null&&a(e,["text"],n);const i=s(t,["filteredReason"]);return i!=null&&a(e,["filteredReason"],i),e}function mp(t){const e={};s(t,["setupComplete"])!=null&&a(e,["setupComplete"],ap());const i=s(t,["serverContent"]);i!=null&&a(e,["serverContent"],hp(i));const o=s(t,["filteredPrompt"]);return o!=null&&a(e,["filteredPrompt"],pp(o)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gp(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function yp(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["data"]);n!=null&&a(e,["data"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function _p(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function vp(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],gp(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],yp(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],_p(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function Yn(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>vp(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function Cp(t){const e={},n=s(t,["anyOf"]);n!=null&&a(e,["anyOf"],n);const i=s(t,["default"]);i!=null&&a(e,["default"],i);const o=s(t,["description"]);o!=null&&a(e,["description"],o);const r=s(t,["enum"]);r!=null&&a(e,["enum"],r);const l=s(t,["example"]);l!=null&&a(e,["example"],l);const u=s(t,["format"]);u!=null&&a(e,["format"],u);const d=s(t,["items"]);d!=null&&a(e,["items"],d);const c=s(t,["maxItems"]);c!=null&&a(e,["maxItems"],c);const f=s(t,["maxLength"]);f!=null&&a(e,["maxLength"],f);const h=s(t,["maxProperties"]);h!=null&&a(e,["maxProperties"],h);const p=s(t,["maximum"]);p!=null&&a(e,["maximum"],p);const m=s(t,["minItems"]);m!=null&&a(e,["minItems"],m);const g=s(t,["minLength"]);g!=null&&a(e,["minLength"],g);const y=s(t,["minProperties"]);y!=null&&a(e,["minProperties"],y);const v=s(t,["minimum"]);v!=null&&a(e,["minimum"],v);const E=s(t,["nullable"]);E!=null&&a(e,["nullable"],E);const C=s(t,["pattern"]);C!=null&&a(e,["pattern"],C);const T=s(t,["properties"]);T!=null&&a(e,["properties"],T);const w=s(t,["propertyOrdering"]);w!=null&&a(e,["propertyOrdering"],w);const M=s(t,["required"]);M!=null&&a(e,["required"],M);const D=s(t,["title"]);D!=null&&a(e,["title"],D);const A=s(t,["type"]);return A!=null&&a(e,["type"],A),e}function Tp(t){const e={};if(s(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=s(t,["category"]);n!=null&&a(e,["category"],n);const i=s(t,["threshold"]);return i!=null&&a(e,["threshold"],i),e}function wp(t){const e={},n=s(t,["behavior"]);n!=null&&a(e,["behavior"],n);const i=s(t,["description"]);i!=null&&a(e,["description"],i);const o=s(t,["name"]);o!=null&&a(e,["name"],o);const r=s(t,["parameters"]);r!=null&&a(e,["parameters"],r);const l=s(t,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const u=s(t,["response"]);u!=null&&a(e,["response"],u);const d=s(t,["responseJsonSchema"]);return d!=null&&a(e,["responseJsonSchema"],d),e}function Sp(t){const e={},n=s(t,["startTime"]);n!=null&&a(e,["startTime"],n);const i=s(t,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function Ap(t){const e={},n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],Sp(n)),e}function Ep(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function xp(t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],Ep(n)),e}function Ip(){return{}}function Mp(t){const e={},n=s(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>wp(d))),a(e,["functionDeclarations"],u)}if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=s(t,["googleSearch"]);i!=null&&a(e,["googleSearch"],Ap(i));const o=s(t,["googleSearchRetrieval"]);if(o!=null&&a(e,["googleSearchRetrieval"],xp(o)),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(s(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");s(t,["urlContext"])!=null&&a(e,["urlContext"],Ip());const l=s(t,["codeExecution"]);return l!=null&&a(e,["codeExecution"],l),e}function Rp(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&a(e,["allowedFunctionNames"],i),e}function Pp(t){const e={},n=s(t,["latitude"]);n!=null&&a(e,["latitude"],n);const i=s(t,["longitude"]);return i!=null&&a(e,["longitude"],i),e}function kp(t){const e={},n=s(t,["latLng"]);n!=null&&a(e,["latLng"],Pp(n));const i=s(t,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function Np(t){const e={},n=s(t,["functionCallingConfig"]);n!=null&&a(e,["functionCallingConfig"],Rp(n));const i=s(t,["retrievalConfig"]);return i!=null&&a(e,["retrievalConfig"],kp(i)),e}function bp(t){const e={},n=s(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function pl(t){const e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],bp(n)),e}function Dp(t){const e={},n=s(t,["speaker"]);n!=null&&a(e,["speaker"],n);const i=s(t,["voiceConfig"]);return i!=null&&a(e,["voiceConfig"],pl(i)),e}function Lp(t){const e={},n=s(t,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Dp(o))),a(e,["speakerVoiceConfigs"],i)}return e}function Fp(t){const e={},n=s(t,["voiceConfig"]);n!=null&&a(e,["voiceConfig"],pl(n));const i=s(t,["multiSpeakerVoiceConfig"]);i!=null&&a(e,["multiSpeakerVoiceConfig"],Lp(i));const o=s(t,["languageCode"]);return o!=null&&a(e,["languageCode"],o),e}function Up(t){const e={},n=s(t,["includeThoughts"]);n!=null&&a(e,["includeThoughts"],n);const i=s(t,["thinkingBudget"]);return i!=null&&a(e,["thinkingBudget"],i),e}function Vp(t,e,n){const i={},o=s(e,["systemInstruction"]);n!==void 0&&o!=null&&a(n,["systemInstruction"],Yn(ce(o)));const r=s(e,["temperature"]);r!=null&&a(i,["temperature"],r);const l=s(e,["topP"]);l!=null&&a(i,["topP"],l);const u=s(e,["topK"]);u!=null&&a(i,["topK"],u);const d=s(e,["candidateCount"]);d!=null&&a(i,["candidateCount"],d);const c=s(e,["maxOutputTokens"]);c!=null&&a(i,["maxOutputTokens"],c);const f=s(e,["stopSequences"]);f!=null&&a(i,["stopSequences"],f);const h=s(e,["responseLogprobs"]);h!=null&&a(i,["responseLogprobs"],h);const p=s(e,["logprobs"]);p!=null&&a(i,["logprobs"],p);const m=s(e,["presencePenalty"]);m!=null&&a(i,["presencePenalty"],m);const g=s(e,["frequencyPenalty"]);g!=null&&a(i,["frequencyPenalty"],g);const y=s(e,["seed"]);y!=null&&a(i,["seed"],y);const v=s(e,["responseMimeType"]);v!=null&&a(i,["responseMimeType"],v);const E=s(e,["responseSchema"]);if(E!=null&&a(i,["responseSchema"],Cp(Dn(E))),s(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(s(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=s(e,["safetySettings"]);if(n!==void 0&&C!=null){let N=C;Array.isArray(N)&&(N=N.map(L=>Tp(L))),a(n,["safetySettings"],N)}const T=s(e,["tools"]);if(n!==void 0&&T!=null){let N=Kt(T);Array.isArray(N)&&(N=N.map(L=>Mp(Wt(L)))),a(n,["tools"],N)}const w=s(e,["toolConfig"]);if(n!==void 0&&w!=null&&a(n,["toolConfig"],Np(w)),s(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const M=s(e,["cachedContent"]);n!==void 0&&M!=null&&a(n,["cachedContent"],Je(t,M));const D=s(e,["responseModalities"]);D!=null&&a(i,["responseModalities"],D);const A=s(e,["mediaResolution"]);A!=null&&a(i,["mediaResolution"],A);const V=s(e,["speechConfig"]);if(V!=null&&a(i,["speechConfig"],Fp(il(V))),s(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const R=s(e,["thinkingConfig"]);return R!=null&&a(i,["thinkingConfig"],Up(R)),i}function lr(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["contents"]);if(o!=null){let l=Ae(o);Array.isArray(l)&&(l=l.map(u=>Yn(u))),a(n,["contents"],l)}const r=s(e,["config"]);return r!=null&&a(n,["generationConfig"],Vp(t,r,n)),n}function $p(t,e){const n={},i=s(t,["taskType"]);e!==void 0&&i!=null&&a(e,["requests[]","taskType"],i);const o=s(t,["title"]);e!==void 0&&o!=null&&a(e,["requests[]","title"],o);const r=s(t,["outputDimensionality"]);if(e!==void 0&&r!=null&&a(e,["requests[]","outputDimensionality"],r),s(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(s(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Op(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["contents"]);o!=null&&a(n,["requests[]","content"],nl(t,o));const r=s(e,["config"]);r!=null&&a(n,["config"],$p(r,n));const l=s(e,["model"]);return l!==void 0&&a(n,["requests[]","model"],Z(t,l)),n}function Bp(t,e){const n={};if(s(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(s(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=s(t,["numberOfImages"]);e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i);const o=s(t,["aspectRatio"]);e!==void 0&&o!=null&&a(e,["parameters","aspectRatio"],o);const r=s(t,["guidanceScale"]);if(e!==void 0&&r!=null&&a(e,["parameters","guidanceScale"],r),s(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=s(t,["safetyFilterLevel"]);e!==void 0&&l!=null&&a(e,["parameters","safetySetting"],l);const u=s(t,["personGeneration"]);e!==void 0&&u!=null&&a(e,["parameters","personGeneration"],u);const d=s(t,["includeSafetyAttributes"]);e!==void 0&&d!=null&&a(e,["parameters","includeSafetyAttributes"],d);const c=s(t,["includeRaiReason"]);e!==void 0&&c!=null&&a(e,["parameters","includeRaiReason"],c);const f=s(t,["language"]);e!==void 0&&f!=null&&a(e,["parameters","language"],f);const h=s(t,["outputMimeType"]);e!==void 0&&h!=null&&a(e,["parameters","outputOptions","mimeType"],h);const p=s(t,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&a(e,["parameters","outputOptions","compressionQuality"],p),s(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(s(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Gp(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["prompt"]);o!=null&&a(n,["instances[0]","prompt"],o);const r=s(e,["config"]);return r!=null&&a(n,["config"],Bp(r,n)),n}function qp(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","name"],Z(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],o),n}function Jp(t,e,n){const i={},o=s(e,["pageSize"]);n!==void 0&&o!=null&&a(n,["_query","pageSize"],o);const r=s(e,["pageToken"]);n!==void 0&&r!=null&&a(n,["_query","pageToken"],r);const l=s(e,["filter"]);n!==void 0&&l!=null&&a(n,["_query","filter"],l);const u=s(e,["queryBase"]);return n!==void 0&&u!=null&&a(n,["_url","models_url"],rl(t,u)),i}function Hp(t,e){const n={},i=s(e,["config"]);return i!=null&&a(n,["config"],Jp(t,i,n)),n}function Wp(t,e){const n={},i=s(t,["displayName"]);e!==void 0&&i!=null&&a(e,["displayName"],i);const o=s(t,["description"]);e!==void 0&&o!=null&&a(e,["description"],o);const r=s(t,["defaultCheckpointId"]);return e!==void 0&&r!=null&&a(e,["defaultCheckpointId"],r),n}function Kp(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","name"],Z(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],Wp(o,n)),n}function Yp(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","name"],Z(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],o),n}function zp(t){const e={};if(s(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(s(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(s(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function Zp(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["contents"]);if(o!=null){let l=Ae(o);Array.isArray(l)&&(l=l.map(u=>Yn(u))),a(n,["contents"],l)}const r=s(e,["config"]);return r!=null&&a(n,["config"],zp(r)),n}function Xp(t){const e={};if(s(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=s(t,["imageBytes"]);n!=null&&a(e,["bytesBase64Encoded"],Le(n));const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Qp(t,e){const n={},i=s(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i),s(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(s(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=s(t,["durationSeconds"]);if(e!==void 0&&o!=null&&a(e,["parameters","durationSeconds"],o),s(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=s(t,["aspectRatio"]);if(e!==void 0&&r!=null&&a(e,["parameters","aspectRatio"],r),s(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const l=s(t,["personGeneration"]);if(e!==void 0&&l!=null&&a(e,["parameters","personGeneration"],l),s(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const u=s(t,["negativePrompt"]);e!==void 0&&u!=null&&a(e,["parameters","negativePrompt"],u);const d=s(t,["enhancePrompt"]);if(e!==void 0&&d!=null&&a(e,["parameters","enhancePrompt"],d),s(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(s(t,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");return n}function jp(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["prompt"]);o!=null&&a(n,["instances[0]","prompt"],o);const r=s(e,["image"]);if(r!=null&&a(n,["instances[0]","image"],Xp(r)),s(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const l=s(e,["config"]);return l!=null&&a(n,["config"],Qp(l,n)),n}function em(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function tm(t){const e={},n=s(t,["displayName"]);n!=null&&a(e,["displayName"],n);const i=s(t,["data"]);i!=null&&a(e,["data"],i);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function nm(t){const e={},n=s(t,["displayName"]);n!=null&&a(e,["displayName"],n);const i=s(t,["fileUri"]);i!=null&&a(e,["fileUri"],i);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function im(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],em(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],tm(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],nm(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function _t(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>im(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function om(t){const e={},n=s(t,["anyOf"]);n!=null&&a(e,["anyOf"],n);const i=s(t,["default"]);i!=null&&a(e,["default"],i);const o=s(t,["description"]);o!=null&&a(e,["description"],o);const r=s(t,["enum"]);r!=null&&a(e,["enum"],r);const l=s(t,["example"]);l!=null&&a(e,["example"],l);const u=s(t,["format"]);u!=null&&a(e,["format"],u);const d=s(t,["items"]);d!=null&&a(e,["items"],d);const c=s(t,["maxItems"]);c!=null&&a(e,["maxItems"],c);const f=s(t,["maxLength"]);f!=null&&a(e,["maxLength"],f);const h=s(t,["maxProperties"]);h!=null&&a(e,["maxProperties"],h);const p=s(t,["maximum"]);p!=null&&a(e,["maximum"],p);const m=s(t,["minItems"]);m!=null&&a(e,["minItems"],m);const g=s(t,["minLength"]);g!=null&&a(e,["minLength"],g);const y=s(t,["minProperties"]);y!=null&&a(e,["minProperties"],y);const v=s(t,["minimum"]);v!=null&&a(e,["minimum"],v);const E=s(t,["nullable"]);E!=null&&a(e,["nullable"],E);const C=s(t,["pattern"]);C!=null&&a(e,["pattern"],C);const T=s(t,["properties"]);T!=null&&a(e,["properties"],T);const w=s(t,["propertyOrdering"]);w!=null&&a(e,["propertyOrdering"],w);const M=s(t,["required"]);M!=null&&a(e,["required"],M);const D=s(t,["title"]);D!=null&&a(e,["title"],D);const A=s(t,["type"]);return A!=null&&a(e,["type"],A),e}function sm(t){const e={},n=s(t,["featureSelectionPreference"]);return n!=null&&a(e,["featureSelectionPreference"],n),e}function rm(t){const e={},n=s(t,["method"]);n!=null&&a(e,["method"],n);const i=s(t,["category"]);i!=null&&a(e,["category"],i);const o=s(t,["threshold"]);return o!=null&&a(e,["threshold"],o),e}function am(t){const e={};if(s(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=s(t,["description"]);n!=null&&a(e,["description"],n);const i=s(t,["name"]);i!=null&&a(e,["name"],i);const o=s(t,["parameters"]);o!=null&&a(e,["parameters"],o);const r=s(t,["parametersJsonSchema"]);r!=null&&a(e,["parametersJsonSchema"],r);const l=s(t,["response"]);l!=null&&a(e,["response"],l);const u=s(t,["responseJsonSchema"]);return u!=null&&a(e,["responseJsonSchema"],u),e}function lm(t){const e={},n=s(t,["startTime"]);n!=null&&a(e,["startTime"],n);const i=s(t,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function um(t){const e={},n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],lm(n)),e}function cm(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function dm(t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],cm(n)),e}function fm(){return{}}function hm(t){const e={},n=s(t,["apiKeyString"]);return n!=null&&a(e,["apiKeyString"],n),e}function pm(t){const e={},n=s(t,["apiKeyConfig"]);n!=null&&a(e,["apiKeyConfig"],hm(n));const i=s(t,["authType"]);i!=null&&a(e,["authType"],i);const o=s(t,["googleServiceAccountConfig"]);o!=null&&a(e,["googleServiceAccountConfig"],o);const r=s(t,["httpBasicAuthConfig"]);r!=null&&a(e,["httpBasicAuthConfig"],r);const l=s(t,["oauthConfig"]);l!=null&&a(e,["oauthConfig"],l);const u=s(t,["oidcConfig"]);return u!=null&&a(e,["oidcConfig"],u),e}function mm(t){const e={},n=s(t,["authConfig"]);return n!=null&&a(e,["authConfig"],pm(n)),e}function gm(){return{}}function ml(t){const e={},n=s(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(h=>am(h))),a(e,["functionDeclarations"],f)}const i=s(t,["retrieval"]);i!=null&&a(e,["retrieval"],i);const o=s(t,["googleSearch"]);o!=null&&a(e,["googleSearch"],um(o));const r=s(t,["googleSearchRetrieval"]);r!=null&&a(e,["googleSearchRetrieval"],dm(r)),s(t,["enterpriseWebSearch"])!=null&&a(e,["enterpriseWebSearch"],fm());const u=s(t,["googleMaps"]);u!=null&&a(e,["googleMaps"],mm(u)),s(t,["urlContext"])!=null&&a(e,["urlContext"],gm());const c=s(t,["codeExecution"]);return c!=null&&a(e,["codeExecution"],c),e}function ym(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&a(e,["allowedFunctionNames"],i),e}function _m(t){const e={},n=s(t,["latitude"]);n!=null&&a(e,["latitude"],n);const i=s(t,["longitude"]);return i!=null&&a(e,["longitude"],i),e}function vm(t){const e={},n=s(t,["latLng"]);n!=null&&a(e,["latLng"],_m(n));const i=s(t,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function Cm(t){const e={},n=s(t,["functionCallingConfig"]);n!=null&&a(e,["functionCallingConfig"],ym(n));const i=s(t,["retrievalConfig"]);return i!=null&&a(e,["retrievalConfig"],vm(i)),e}function Tm(t){const e={},n=s(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function wm(t){const e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],Tm(n)),e}function Sm(t){const e={},n=s(t,["voiceConfig"]);if(n!=null&&a(e,["voiceConfig"],wm(n)),s(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=s(t,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function Am(t){const e={},n=s(t,["includeThoughts"]);n!=null&&a(e,["includeThoughts"],n);const i=s(t,["thinkingBudget"]);return i!=null&&a(e,["thinkingBudget"],i),e}function Em(t,e,n){const i={},o=s(e,["systemInstruction"]);n!==void 0&&o!=null&&a(n,["systemInstruction"],_t(ce(o)));const r=s(e,["temperature"]);r!=null&&a(i,["temperature"],r);const l=s(e,["topP"]);l!=null&&a(i,["topP"],l);const u=s(e,["topK"]);u!=null&&a(i,["topK"],u);const d=s(e,["candidateCount"]);d!=null&&a(i,["candidateCount"],d);const c=s(e,["maxOutputTokens"]);c!=null&&a(i,["maxOutputTokens"],c);const f=s(e,["stopSequences"]);f!=null&&a(i,["stopSequences"],f);const h=s(e,["responseLogprobs"]);h!=null&&a(i,["responseLogprobs"],h);const p=s(e,["logprobs"]);p!=null&&a(i,["logprobs"],p);const m=s(e,["presencePenalty"]);m!=null&&a(i,["presencePenalty"],m);const g=s(e,["frequencyPenalty"]);g!=null&&a(i,["frequencyPenalty"],g);const y=s(e,["seed"]);y!=null&&a(i,["seed"],y);const v=s(e,["responseMimeType"]);v!=null&&a(i,["responseMimeType"],v);const E=s(e,["responseSchema"]);E!=null&&a(i,["responseSchema"],om(Dn(E)));const C=s(e,["routingConfig"]);C!=null&&a(i,["routingConfig"],C);const T=s(e,["modelSelectionConfig"]);T!=null&&a(i,["modelConfig"],sm(T));const w=s(e,["safetySettings"]);if(n!==void 0&&w!=null){let pe=w;Array.isArray(pe)&&(pe=pe.map(Ue=>rm(Ue))),a(n,["safetySettings"],pe)}const M=s(e,["tools"]);if(n!==void 0&&M!=null){let pe=Kt(M);Array.isArray(pe)&&(pe=pe.map(Ue=>ml(Wt(Ue)))),a(n,["tools"],pe)}const D=s(e,["toolConfig"]);n!==void 0&&D!=null&&a(n,["toolConfig"],Cm(D));const A=s(e,["labels"]);n!==void 0&&A!=null&&a(n,["labels"],A);const V=s(e,["cachedContent"]);n!==void 0&&V!=null&&a(n,["cachedContent"],Je(t,V));const R=s(e,["responseModalities"]);R!=null&&a(i,["responseModalities"],R);const N=s(e,["mediaResolution"]);N!=null&&a(i,["mediaResolution"],N);const L=s(e,["speechConfig"]);L!=null&&a(i,["speechConfig"],Sm(il(L)));const Te=s(e,["audioTimestamp"]);Te!=null&&a(i,["audioTimestamp"],Te);const Fe=s(e,["thinkingConfig"]);return Fe!=null&&a(i,["thinkingConfig"],Am(Fe)),i}function ur(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["contents"]);if(o!=null){let l=Ae(o);Array.isArray(l)&&(l=l.map(u=>_t(u))),a(n,["contents"],l)}const r=s(e,["config"]);return r!=null&&a(n,["generationConfig"],Em(t,r,n)),n}function xm(t,e){const n={},i=s(t,["taskType"]);e!==void 0&&i!=null&&a(e,["instances[]","task_type"],i);const o=s(t,["title"]);e!==void 0&&o!=null&&a(e,["instances[]","title"],o);const r=s(t,["outputDimensionality"]);e!==void 0&&r!=null&&a(e,["parameters","outputDimensionality"],r);const l=s(t,["mimeType"]);e!==void 0&&l!=null&&a(e,["instances[]","mimeType"],l);const u=s(t,["autoTruncate"]);return e!==void 0&&u!=null&&a(e,["parameters","autoTruncate"],u),n}function Im(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["contents"]);o!=null&&a(n,["instances[]","content"],nl(t,o));const r=s(e,["config"]);return r!=null&&a(n,["config"],xm(r,n)),n}function Mm(t,e){const n={},i=s(t,["outputGcsUri"]);e!==void 0&&i!=null&&a(e,["parameters","storageUri"],i);const o=s(t,["negativePrompt"]);e!==void 0&&o!=null&&a(e,["parameters","negativePrompt"],o);const r=s(t,["numberOfImages"]);e!==void 0&&r!=null&&a(e,["parameters","sampleCount"],r);const l=s(t,["aspectRatio"]);e!==void 0&&l!=null&&a(e,["parameters","aspectRatio"],l);const u=s(t,["guidanceScale"]);e!==void 0&&u!=null&&a(e,["parameters","guidanceScale"],u);const d=s(t,["seed"]);e!==void 0&&d!=null&&a(e,["parameters","seed"],d);const c=s(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&a(e,["parameters","safetySetting"],c);const f=s(t,["personGeneration"]);e!==void 0&&f!=null&&a(e,["parameters","personGeneration"],f);const h=s(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&a(e,["parameters","includeSafetyAttributes"],h);const p=s(t,["includeRaiReason"]);e!==void 0&&p!=null&&a(e,["parameters","includeRaiReason"],p);const m=s(t,["language"]);e!==void 0&&m!=null&&a(e,["parameters","language"],m);const g=s(t,["outputMimeType"]);e!==void 0&&g!=null&&a(e,["parameters","outputOptions","mimeType"],g);const y=s(t,["outputCompressionQuality"]);e!==void 0&&y!=null&&a(e,["parameters","outputOptions","compressionQuality"],y);const v=s(t,["addWatermark"]);e!==void 0&&v!=null&&a(e,["parameters","addWatermark"],v);const E=s(t,["enhancePrompt"]);return e!==void 0&&E!=null&&a(e,["parameters","enhancePrompt"],E),n}function Rm(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["prompt"]);o!=null&&a(n,["instances[0]","prompt"],o);const r=s(e,["config"]);return r!=null&&a(n,["config"],Mm(r,n)),n}function zn(t){const e={},n=s(t,["gcsUri"]);n!=null&&a(e,["gcsUri"],n);const i=s(t,["imageBytes"]);i!=null&&a(e,["bytesBase64Encoded"],Le(i));const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Pm(t){const e={},n=s(t,["maskMode"]);n!=null&&a(e,["maskMode"],n);const i=s(t,["segmentationClasses"]);i!=null&&a(e,["maskClasses"],i);const o=s(t,["maskDilation"]);return o!=null&&a(e,["dilation"],o),e}function km(t){const e={},n=s(t,["controlType"]);n!=null&&a(e,["controlType"],n);const i=s(t,["enableControlImageComputation"]);return i!=null&&a(e,["computeControl"],i),e}function Nm(t){const e={},n=s(t,["styleDescription"]);return n!=null&&a(e,["styleDescription"],n),e}function bm(t){const e={},n=s(t,["subjectType"]);n!=null&&a(e,["subjectType"],n);const i=s(t,["subjectDescription"]);return i!=null&&a(e,["subjectDescription"],i),e}function Dm(t){const e={},n=s(t,["referenceImage"]);n!=null&&a(e,["referenceImage"],zn(n));const i=s(t,["referenceId"]);i!=null&&a(e,["referenceId"],i);const o=s(t,["referenceType"]);o!=null&&a(e,["referenceType"],o);const r=s(t,["maskImageConfig"]);r!=null&&a(e,["maskImageConfig"],Pm(r));const l=s(t,["controlImageConfig"]);l!=null&&a(e,["controlImageConfig"],km(l));const u=s(t,["styleImageConfig"]);u!=null&&a(e,["styleImageConfig"],Nm(u));const d=s(t,["subjectImageConfig"]);return d!=null&&a(e,["subjectImageConfig"],bm(d)),e}function Lm(t,e){const n={},i=s(t,["outputGcsUri"]);e!==void 0&&i!=null&&a(e,["parameters","storageUri"],i);const o=s(t,["negativePrompt"]);e!==void 0&&o!=null&&a(e,["parameters","negativePrompt"],o);const r=s(t,["numberOfImages"]);e!==void 0&&r!=null&&a(e,["parameters","sampleCount"],r);const l=s(t,["aspectRatio"]);e!==void 0&&l!=null&&a(e,["parameters","aspectRatio"],l);const u=s(t,["guidanceScale"]);e!==void 0&&u!=null&&a(e,["parameters","guidanceScale"],u);const d=s(t,["seed"]);e!==void 0&&d!=null&&a(e,["parameters","seed"],d);const c=s(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&a(e,["parameters","safetySetting"],c);const f=s(t,["personGeneration"]);e!==void 0&&f!=null&&a(e,["parameters","personGeneration"],f);const h=s(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&a(e,["parameters","includeSafetyAttributes"],h);const p=s(t,["includeRaiReason"]);e!==void 0&&p!=null&&a(e,["parameters","includeRaiReason"],p);const m=s(t,["language"]);e!==void 0&&m!=null&&a(e,["parameters","language"],m);const g=s(t,["outputMimeType"]);e!==void 0&&g!=null&&a(e,["parameters","outputOptions","mimeType"],g);const y=s(t,["outputCompressionQuality"]);e!==void 0&&y!=null&&a(e,["parameters","outputOptions","compressionQuality"],y);const v=s(t,["editMode"]);e!==void 0&&v!=null&&a(e,["parameters","editMode"],v);const E=s(t,["baseSteps"]);return e!==void 0&&E!=null&&a(e,["parameters","editConfig","baseSteps"],E),n}function Fm(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["prompt"]);o!=null&&a(n,["instances[0]","prompt"],o);const r=s(e,["referenceImages"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(d=>Dm(d))),a(n,["instances[0]","referenceImages"],u)}const l=s(e,["config"]);return l!=null&&a(n,["config"],Lm(l,n)),n}function Um(t,e){const n={},i=s(t,["includeRaiReason"]);e!==void 0&&i!=null&&a(e,["parameters","includeRaiReason"],i);const o=s(t,["outputMimeType"]);e!==void 0&&o!=null&&a(e,["parameters","outputOptions","mimeType"],o);const r=s(t,["outputCompressionQuality"]);e!==void 0&&r!=null&&a(e,["parameters","outputOptions","compressionQuality"],r);const l=s(t,["numberOfImages"]);e!==void 0&&l!=null&&a(e,["parameters","sampleCount"],l);const u=s(t,["mode"]);return e!==void 0&&u!=null&&a(e,["parameters","mode"],u),n}function Vm(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["image"]);o!=null&&a(n,["instances[0]","image"],zn(o));const r=s(e,["upscaleFactor"]);r!=null&&a(n,["parameters","upscaleConfig","upscaleFactor"],r);const l=s(e,["config"]);return l!=null&&a(n,["config"],Um(l,n)),n}function $m(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","name"],Z(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],o),n}function Om(t,e,n){const i={},o=s(e,["pageSize"]);n!==void 0&&o!=null&&a(n,["_query","pageSize"],o);const r=s(e,["pageToken"]);n!==void 0&&r!=null&&a(n,["_query","pageToken"],r);const l=s(e,["filter"]);n!==void 0&&l!=null&&a(n,["_query","filter"],l);const u=s(e,["queryBase"]);return n!==void 0&&u!=null&&a(n,["_url","models_url"],rl(t,u)),i}function Bm(t,e){const n={},i=s(e,["config"]);return i!=null&&a(n,["config"],Om(t,i,n)),n}function Gm(t,e){const n={},i=s(t,["displayName"]);e!==void 0&&i!=null&&a(e,["displayName"],i);const o=s(t,["description"]);e!==void 0&&o!=null&&a(e,["description"],o);const r=s(t,["defaultCheckpointId"]);return e!==void 0&&r!=null&&a(e,["defaultCheckpointId"],r),n}function qm(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],Gm(o,n)),n}function Jm(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","name"],Z(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],o),n}function Hm(t,e){const n={},i=s(t,["systemInstruction"]);e!==void 0&&i!=null&&a(e,["systemInstruction"],_t(ce(i)));const o=s(t,["tools"]);if(e!==void 0&&o!=null){let l=o;Array.isArray(l)&&(l=l.map(u=>ml(u))),a(e,["tools"],l)}const r=s(t,["generationConfig"]);return e!==void 0&&r!=null&&a(e,["generationConfig"],r),n}function Wm(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["contents"]);if(o!=null){let l=Ae(o);Array.isArray(l)&&(l=l.map(u=>_t(u))),a(n,["contents"],l)}const r=s(e,["config"]);return r!=null&&a(n,["config"],Hm(r,n)),n}function Km(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["contents"]);if(o!=null){let l=Ae(o);Array.isArray(l)&&(l=l.map(u=>_t(u))),a(n,["contents"],l)}const r=s(e,["config"]);return r!=null&&a(n,["config"],r),n}function Ym(t){const e={},n=s(t,["uri"]);n!=null&&a(e,["gcsUri"],n);const i=s(t,["videoBytes"]);i!=null&&a(e,["bytesBase64Encoded"],Le(i));const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function zm(t,e){const n={},i=s(t,["numberOfVideos"]);e!==void 0&&i!=null&&a(e,["parameters","sampleCount"],i);const o=s(t,["outputGcsUri"]);e!==void 0&&o!=null&&a(e,["parameters","storageUri"],o);const r=s(t,["fps"]);e!==void 0&&r!=null&&a(e,["parameters","fps"],r);const l=s(t,["durationSeconds"]);e!==void 0&&l!=null&&a(e,["parameters","durationSeconds"],l);const u=s(t,["seed"]);e!==void 0&&u!=null&&a(e,["parameters","seed"],u);const d=s(t,["aspectRatio"]);e!==void 0&&d!=null&&a(e,["parameters","aspectRatio"],d);const c=s(t,["resolution"]);e!==void 0&&c!=null&&a(e,["parameters","resolution"],c);const f=s(t,["personGeneration"]);e!==void 0&&f!=null&&a(e,["parameters","personGeneration"],f);const h=s(t,["pubsubTopic"]);e!==void 0&&h!=null&&a(e,["parameters","pubsubTopic"],h);const p=s(t,["negativePrompt"]);e!==void 0&&p!=null&&a(e,["parameters","negativePrompt"],p);const m=s(t,["enhancePrompt"]);e!==void 0&&m!=null&&a(e,["parameters","enhancePrompt"],m);const g=s(t,["generateAudio"]);e!==void 0&&g!=null&&a(e,["parameters","generateAudio"],g);const y=s(t,["lastFrame"]);return e!==void 0&&y!=null&&a(e,["instances[0]","lastFrame"],zn(y)),n}function Zm(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["_url","model"],Z(t,i));const o=s(e,["prompt"]);o!=null&&a(n,["instances[0]","prompt"],o);const r=s(e,["image"]);r!=null&&a(n,["instances[0]","image"],zn(r));const l=s(e,["video"]);l!=null&&a(n,["instances[0]","video"],Ym(l));const u=s(e,["config"]);return u!=null&&a(n,["config"],zm(u,n)),n}function Xm(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function Qm(t){const e={},n=s(t,["data"]);n!=null&&a(e,["data"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function jm(t){const e={},n=s(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function eg(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],Xm(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],Qm(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],jm(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function tg(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>eg(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function ng(t){const e={},n=s(t,["citationSources"]);return n!=null&&a(e,["citations"],n),e}function ig(t){const e={},n=s(t,["retrievedUrl"]);n!=null&&a(e,["retrievedUrl"],n);const i=s(t,["urlRetrievalStatus"]);return i!=null&&a(e,["urlRetrievalStatus"],i),e}function og(t){const e={},n=s(t,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>ig(o))),a(e,["urlMetadata"],i)}return e}function sg(t){const e={},n=s(t,["content"]);n!=null&&a(e,["content"],tg(n));const i=s(t,["citationMetadata"]);i!=null&&a(e,["citationMetadata"],ng(i));const o=s(t,["tokenCount"]);o!=null&&a(e,["tokenCount"],o);const r=s(t,["finishReason"]);r!=null&&a(e,["finishReason"],r);const l=s(t,["urlContextMetadata"]);l!=null&&a(e,["urlContextMetadata"],og(l));const u=s(t,["avgLogprobs"]);u!=null&&a(e,["avgLogprobs"],u);const d=s(t,["groundingMetadata"]);d!=null&&a(e,["groundingMetadata"],d);const c=s(t,["index"]);c!=null&&a(e,["index"],c);const f=s(t,["logprobsResult"]);f!=null&&a(e,["logprobsResult"],f);const h=s(t,["safetyRatings"]);return h!=null&&a(e,["safetyRatings"],h),e}function cr(t){const e={},n=s(t,["candidates"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>sg(u))),a(e,["candidates"],l)}const i=s(t,["modelVersion"]);i!=null&&a(e,["modelVersion"],i);const o=s(t,["promptFeedback"]);o!=null&&a(e,["promptFeedback"],o);const r=s(t,["usageMetadata"]);return r!=null&&a(e,["usageMetadata"],r),e}function rg(t){const e={},n=s(t,["values"]);return n!=null&&a(e,["values"],n),e}function ag(){return{}}function lg(t){const e={},n=s(t,["embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>rg(r))),a(e,["embeddings"],o)}return s(t,["metadata"])!=null&&a(e,["metadata"],ag()),e}function ug(t){const e={},n=s(t,["bytesBase64Encoded"]);n!=null&&a(e,["imageBytes"],Le(n));const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function gl(t){const e={},n=s(t,["safetyAttributes","categories"]);n!=null&&a(e,["categories"],n);const i=s(t,["safetyAttributes","scores"]);i!=null&&a(e,["scores"],i);const o=s(t,["contentType"]);return o!=null&&a(e,["contentType"],o),e}function cg(t){const e={},n=s(t,["_self"]);n!=null&&a(e,["image"],ug(n));const i=s(t,["raiFilteredReason"]);i!=null&&a(e,["raiFilteredReason"],i);const o=s(t,["_self"]);return o!=null&&a(e,["safetyAttributes"],gl(o)),e}function dg(t){const e={},n=s(t,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>cg(r))),a(e,["generatedImages"],o)}const i=s(t,["positivePromptSafetyAttributes"]);return i!=null&&a(e,["positivePromptSafetyAttributes"],gl(i)),e}function fg(t){const e={},n=s(t,["baseModel"]);n!=null&&a(e,["baseModel"],n);const i=s(t,["createTime"]);i!=null&&a(e,["createTime"],i);const o=s(t,["updateTime"]);return o!=null&&a(e,["updateTime"],o),e}function Fi(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["displayName"]);i!=null&&a(e,["displayName"],i);const o=s(t,["description"]);o!=null&&a(e,["description"],o);const r=s(t,["version"]);r!=null&&a(e,["version"],r);const l=s(t,["_self"]);l!=null&&a(e,["tunedModelInfo"],fg(l));const u=s(t,["inputTokenLimit"]);u!=null&&a(e,["inputTokenLimit"],u);const d=s(t,["outputTokenLimit"]);d!=null&&a(e,["outputTokenLimit"],d);const c=s(t,["supportedGenerationMethods"]);return c!=null&&a(e,["supportedActions"],c),e}function hg(t,e){const n={},i=s(e,["nextPageToken"]);i!=null&&a(n,["nextPageToken"],i);const o=s(e,["_self"]);if(o!=null){let r=al(o);Array.isArray(r)&&(r=r.map(l=>Fi(l))),a(n,["models"],r)}return n}function pg(){return{}}function mg(t){const e={},n=s(t,["totalTokens"]);n!=null&&a(e,["totalTokens"],n);const i=s(t,["cachedContentTokenCount"]);return i!=null&&a(e,["cachedContentTokenCount"],i),e}function gg(t){const e={},n=s(t,["video","uri"]);n!=null&&a(e,["uri"],n);const i=s(t,["video","encodedVideo"]);i!=null&&a(e,["videoBytes"],Le(i));const o=s(t,["encoding"]);return o!=null&&a(e,["mimeType"],o),e}function yg(t){const e={},n=s(t,["_self"]);return n!=null&&a(e,["video"],gg(n)),e}function _g(t){const e={},n=s(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>yg(l))),a(e,["generatedVideos"],r)}const i=s(t,["raiMediaFilteredCount"]);i!=null&&a(e,["raiMediaFilteredCount"],i);const o=s(t,["raiMediaFilteredReasons"]);return o!=null&&a(e,["raiMediaFilteredReasons"],o),e}function vg(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["metadata"]);i!=null&&a(e,["metadata"],i);const o=s(t,["done"]);o!=null&&a(e,["done"],o);const r=s(t,["error"]);r!=null&&a(e,["error"],r);const l=s(t,["response","generateVideoResponse"]);return l!=null&&a(e,["response"],_g(l)),e}function Cg(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function Tg(t){const e={},n=s(t,["displayName"]);n!=null&&a(e,["displayName"],n);const i=s(t,["data"]);i!=null&&a(e,["data"],i);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function wg(t){const e={},n=s(t,["displayName"]);n!=null&&a(e,["displayName"],n);const i=s(t,["fileUri"]);i!=null&&a(e,["fileUri"],i);const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Sg(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],Cg(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],Tg(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],wg(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function Ag(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Sg(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function Eg(t){const e={},n=s(t,["citations"]);return n!=null&&a(e,["citations"],n),e}function xg(t){const e={},n=s(t,["retrievedUrl"]);n!=null&&a(e,["retrievedUrl"],n);const i=s(t,["urlRetrievalStatus"]);return i!=null&&a(e,["urlRetrievalStatus"],i),e}function Ig(t){const e={},n=s(t,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>xg(o))),a(e,["urlMetadata"],i)}return e}function Mg(t){const e={},n=s(t,["content"]);n!=null&&a(e,["content"],Ag(n));const i=s(t,["citationMetadata"]);i!=null&&a(e,["citationMetadata"],Eg(i));const o=s(t,["finishMessage"]);o!=null&&a(e,["finishMessage"],o);const r=s(t,["finishReason"]);r!=null&&a(e,["finishReason"],r);const l=s(t,["urlContextMetadata"]);l!=null&&a(e,["urlContextMetadata"],Ig(l));const u=s(t,["avgLogprobs"]);u!=null&&a(e,["avgLogprobs"],u);const d=s(t,["groundingMetadata"]);d!=null&&a(e,["groundingMetadata"],d);const c=s(t,["index"]);c!=null&&a(e,["index"],c);const f=s(t,["logprobsResult"]);f!=null&&a(e,["logprobsResult"],f);const h=s(t,["safetyRatings"]);return h!=null&&a(e,["safetyRatings"],h),e}function dr(t){const e={},n=s(t,["candidates"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(c=>Mg(c))),a(e,["candidates"],d)}const i=s(t,["createTime"]);i!=null&&a(e,["createTime"],i);const o=s(t,["responseId"]);o!=null&&a(e,["responseId"],o);const r=s(t,["modelVersion"]);r!=null&&a(e,["modelVersion"],r);const l=s(t,["promptFeedback"]);l!=null&&a(e,["promptFeedback"],l);const u=s(t,["usageMetadata"]);return u!=null&&a(e,["usageMetadata"],u),e}function Rg(t){const e={},n=s(t,["truncated"]);n!=null&&a(e,["truncated"],n);const i=s(t,["token_count"]);return i!=null&&a(e,["tokenCount"],i),e}function Pg(t){const e={},n=s(t,["values"]);n!=null&&a(e,["values"],n);const i=s(t,["statistics"]);return i!=null&&a(e,["statistics"],Rg(i)),e}function kg(t){const e={},n=s(t,["billableCharacterCount"]);return n!=null&&a(e,["billableCharacterCount"],n),e}function Ng(t){const e={},n=s(t,["predictions[]","embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Pg(r))),a(e,["embeddings"],o)}const i=s(t,["metadata"]);return i!=null&&a(e,["metadata"],kg(i)),e}function bg(t){const e={},n=s(t,["gcsUri"]);n!=null&&a(e,["gcsUri"],n);const i=s(t,["bytesBase64Encoded"]);i!=null&&a(e,["imageBytes"],Le(i));const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function yl(t){const e={},n=s(t,["safetyAttributes","categories"]);n!=null&&a(e,["categories"],n);const i=s(t,["safetyAttributes","scores"]);i!=null&&a(e,["scores"],i);const o=s(t,["contentType"]);return o!=null&&a(e,["contentType"],o),e}function ho(t){const e={},n=s(t,["_self"]);n!=null&&a(e,["image"],bg(n));const i=s(t,["raiFilteredReason"]);i!=null&&a(e,["raiFilteredReason"],i);const o=s(t,["_self"]);o!=null&&a(e,["safetyAttributes"],yl(o));const r=s(t,["prompt"]);return r!=null&&a(e,["enhancedPrompt"],r),e}function Dg(t){const e={},n=s(t,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>ho(r))),a(e,["generatedImages"],o)}const i=s(t,["positivePromptSafetyAttributes"]);return i!=null&&a(e,["positivePromptSafetyAttributes"],yl(i)),e}function Lg(t){const e={},n=s(t,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>ho(o))),a(e,["generatedImages"],i)}return e}function Fg(t){const e={},n=s(t,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>ho(o))),a(e,["generatedImages"],i)}return e}function Ug(t){const e={},n=s(t,["endpoint"]);n!=null&&a(e,["name"],n);const i=s(t,["deployedModelId"]);return i!=null&&a(e,["deployedModelId"],i),e}function Vg(t){const e={},n=s(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&a(e,["baseModel"],n);const i=s(t,["createTime"]);i!=null&&a(e,["createTime"],i);const o=s(t,["updateTime"]);return o!=null&&a(e,["updateTime"],o),e}function $g(t){const e={},n=s(t,["checkpointId"]);n!=null&&a(e,["checkpointId"],n);const i=s(t,["epoch"]);i!=null&&a(e,["epoch"],i);const o=s(t,["step"]);return o!=null&&a(e,["step"],o),e}function Ui(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["displayName"]);i!=null&&a(e,["displayName"],i);const o=s(t,["description"]);o!=null&&a(e,["description"],o);const r=s(t,["versionId"]);r!=null&&a(e,["version"],r);const l=s(t,["deployedModels"]);if(l!=null){let h=l;Array.isArray(h)&&(h=h.map(p=>Ug(p))),a(e,["endpoints"],h)}const u=s(t,["labels"]);u!=null&&a(e,["labels"],u);const d=s(t,["_self"]);d!=null&&a(e,["tunedModelInfo"],Vg(d));const c=s(t,["defaultCheckpointId"]);c!=null&&a(e,["defaultCheckpointId"],c);const f=s(t,["checkpoints"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(p=>$g(p))),a(e,["checkpoints"],h)}return e}function Og(t,e){const n={},i=s(e,["nextPageToken"]);i!=null&&a(n,["nextPageToken"],i);const o=s(e,["_self"]);if(o!=null){let r=al(o);Array.isArray(r)&&(r=r.map(l=>Ui(l))),a(n,["models"],r)}return n}function Bg(){return{}}function Gg(t){const e={},n=s(t,["totalTokens"]);return n!=null&&a(e,["totalTokens"],n),e}function qg(t){const e={},n=s(t,["tokensInfo"]);return n!=null&&a(e,["tokensInfo"],n),e}function Jg(t){const e={},n=s(t,["gcsUri"]);n!=null&&a(e,["uri"],n);const i=s(t,["bytesBase64Encoded"]);i!=null&&a(e,["videoBytes"],Le(i));const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function Hg(t){const e={},n=s(t,["_self"]);return n!=null&&a(e,["video"],Jg(n)),e}function Wg(t){const e={},n=s(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>Hg(l))),a(e,["generatedVideos"],r)}const i=s(t,["raiMediaFilteredCount"]);i!=null&&a(e,["raiMediaFilteredCount"],i);const o=s(t,["raiMediaFilteredReasons"]);return o!=null&&a(e,["raiMediaFilteredReasons"],o),e}function Kg(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["metadata"]);i!=null&&a(e,["metadata"],i);const o=s(t,["done"]);o!=null&&a(e,["done"],o);const r=s(t,["error"]);r!=null&&a(e,["error"],r);const l=s(t,["response"]);return l!=null&&a(e,["response"],Wg(l)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Yg="Content-Type",zg="X-Server-Timeout",Zg="User-Agent",Vi="x-goog-api-client",Xg="1.6.0",Qg=`google-genai-sdk/${Xg}`,jg="v1beta1",ey="v1beta",fr=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class ty{constructor(e){var n,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:jg,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:ey,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,i){const o=[this.getRequestUrlInternal(n)];return i&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,i);if(e.queryParams)for(const[l,u]of Object.entries(e.queryParams))o.searchParams.append(l,String(u));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,n,e.abortSignal),this.unaryApiCall(o,r,e.httpMethod)}patchHttpOptions(e,n){const i=JSON.parse(JSON.stringify(e));for(const[o,r]of Object.entries(n))typeof r=="object"?i[o]=Object.assign(Object.assign({},i[o]),r):r!==void 0&&(i[o]=r);return i}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,i);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,n,e.abortSignal),this.streamApiCall(o,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,i){if(n&&n.timeout||i){const o=new AbortController,r=o.signal;n.timeout&&(n==null?void 0:n.timeout)>0&&setTimeout(()=>o.abort(),n.timeout),i&&i.addEventListener("abort",()=>{o.abort()}),e.signal=r}return n&&n.extraBody!==null&&ny(e,n.extraBody),e.headers=await this.getHeadersInternal(n),e}async unaryApiCall(e,n,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:i})).then(async o=>(await hr(o),new Ni(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,n,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:i})).then(async o=>(await hr(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){var n;return ut(this,arguments,function*(){const o=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let l="";for(;;){const{done:u,value:d}=yield X(o.read());if(u){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const c=r.decode(d);try{const h=JSON.parse(c);if("error"in h){const p=JSON.parse(JSON.stringify(h.error)),m=p.status,g=p.code,y=`got status: ${m}. ${JSON.stringify(h)}`;if(g>=400&&g<600)throw new Kn({message:y,status:g})}}catch(h){if(h.name==="ApiError")throw h}l+=c;let f=l.match(fr);for(;f;){const h=f[1];try{const p=new Response(h,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield X(new Ni(p)),l=l.slice(f[0].length),f=l.match(fr)}catch(p){throw new Error(`exception parsing stream chunk ${h}. ${p}`)}}}}finally{o.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){const e={},n=Qg+" "+this.clientOptions.userAgentExtra;return e[Zg]=n,e[Vi]=n,e[Yg]="application/json",e}async getHeadersInternal(e){const n=new Headers;if(e&&e.headers){for(const[i,o]of Object.entries(e.headers))n.append(i,o);e.timeout&&e.timeout>0&&n.append(zg,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n),n}async uploadFile(e,n){var i;const o={};n!=null&&(o.mimeType=n.mimeType,o.name=n.name,o.displayName=n.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const r=this.clientOptions.uploader,l=await r.stat(e);o.sizeBytes=String(l.size);const u=(i=n==null?void 0:n.mimeType)!==null&&i!==void 0?i:l.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=u;const d=await this.fetchUploadUrl(o,n);return r.upload(e,d,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n){var i;let o={};n!=null&&n.httpOptions?o=n.httpOptions:o={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const r={file:e},l=await this.request({path:F("upload/v1beta/files",r._url),body:JSON.stringify(r),httpMethod:"POST",httpOptions:o});if(!l||!(l!=null&&l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(i=l==null?void 0:l.headers)===null||i===void 0?void 0:i["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function hr(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let i;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await t.json():i={error:{message:await t.text(),code:t.status,status:t.statusText}};const o=JSON.stringify(i);throw n>=400&&n<600?new Kn({message:o,status:n}):new Error(o)}}function ny(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const r=JSON.parse(t.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))n=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(r,l){const u=Object.assign({},r);for(const d in l)if(Object.prototype.hasOwnProperty.call(l,d)){const c=l[d],f=u[d];c&&typeof c=="object"&&!Array.isArray(c)&&f&&typeof f=="object"&&!Array.isArray(f)?u[d]=i(f,c):(f&&c&&typeof f!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${d}". Original type: ${typeof f}, New type: ${typeof c}. Overwriting.`),u[d]=c)}return u}const o=i(n,e);t.body=JSON.stringify(o)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const iy="mcp_used/unknown";function _l(t){for(const e of t)if(po(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function vl(t){var e;const n=(e=t[Vi])!==null&&e!==void 0?e:"";t[Vi]=(n+` ${iy}`).trimStart()}function oy(t){var e,n,i;return(i=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(o=>po(o)))!==null&&i!==void 0?i:!1}function sy(t){var e,n,i;return(i=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(o=>!po(o)))!==null&&i!==void 0?i:!1}function po(t){return t!==null&&typeof t=="object"&&t instanceof mo}function ry(t,e=100){return ut(this,arguments,function*(){let i,o=0;for(;o<e;){const r=yield X(t.listTools({cursor:i}));for(const l of r.tools)yield yield X(l),o++;if(!r.nextCursor)break;i=r.nextCursor}})}class mo{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new mo(e,n)}async initialize(){var e,n,i,o;if(this.mcpTools.length>0)return;const r={},l=[];for(const f of this.mcpClients)try{for(var u=!0,d=(n=void 0,Ft(ry(f))),c;c=await d.next(),e=c.done,!e;u=!0){o=c.value,u=!1;const h=o;l.push(h);const p=h.name;if(r[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);r[p]=f}}catch(h){n={error:h}}finally{try{!u&&!e&&(i=d.return)&&await i.call(d)}finally{if(n)throw n.error}}this.mcpTools=l,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),sd(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const i of e)if(i.name in this.functionNameToMcpClient){const o=this.functionNameToMcpClient[i.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const l=await o.callTool({name:i.name,arguments:i.args},void 0,r);n.push({functionResponse:{name:i.name,response:l.isError?{error:l}:l}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function ay(t,e,n){const i=new Wc;let o;n.data instanceof Blob?o=JSON.parse(await n.data.text()):o=JSON.parse(n.data);const r=mp(o);Object.assign(i,r),e(i)}class ly{constructor(e,n,i){this.apiClient=e,this.auth=n,this.webSocketFactory=i}async connect(e){var n,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const o=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),l=dy(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),d=`${o}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${u}`;let c=()=>{};const f=new Promise(T=>{c=T}),h=e.callbacks,p=function(){c({})},m=this.apiClient,g={onopen:p,onmessage:T=>{ay(m,h.onmessage,T)},onerror:(n=h==null?void 0:h.onerror)!==null&&n!==void 0?n:function(T){},onclose:(i=h==null?void 0:h.onclose)!==null&&i!==void 0?i:function(T){}},y=this.webSocketFactory.create(d,cy(l),g);y.connect(),await f;const v=Z(this.apiClient,e.model),E=fl({model:v}),C=Li({setup:E});return y.send(JSON.stringify(C)),new uy(y,this.apiClient)}}class uy{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=Rh(e),i=hl(n);this.conn.send(JSON.stringify({clientContent:i}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=Ph(e),i=Li(n);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){const n=Li({playbackControl:e});this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(at.PLAY)}pause(){this.sendPlaybackControl(at.PAUSE)}stop(){this.sendPlaybackControl(at.STOP)}resetContext(){this.sendPlaybackControl(at.RESET_CONTEXT)}close(){this.conn.close()}}function cy(t){const e={};return t.forEach((n,i)=>{e[i]=n}),e}function dy(t){const e=new Headers;for(const[n,i]of Object.entries(t))e.append(n,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fy="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function hy(t,e,n){const i=new Hc;let o;if(n.data instanceof Blob?o=JSON.parse(await n.data.text()):o=JSON.parse(n.data),t.isVertexAI()){const r=rp(o);Object.assign(i,r)}else{const r=sp(o);Object.assign(i,r)}e(i)}class py{constructor(e,n,i){this.apiClient=e,this.auth=n,this.webSocketFactory=i,this.music=new ly(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,i,o,r,l,u;const d=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let f;const h=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&_l(e.config.tools)&&vl(h);const p=_y(h);if(this.apiClient.isVertexAI())f=`${d}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p);else{const R=this.apiClient.getApiKey();let N="BidiGenerateContent",L="key";R!=null&&R.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),N="BidiGenerateContentConstrained",L="access_token"),f=`${d}/ws/google.ai.generativelanguage.${c}.GenerativeService.${N}?${L}=${R}`}let m=()=>{};const g=new Promise(R=>{m=R}),y=e.callbacks,v=function(){var R;(R=y==null?void 0:y.onopen)===null||R===void 0||R.call(y),m({})},E=this.apiClient,C={onopen:v,onmessage:R=>{hy(E,y.onmessage,R)},onerror:(n=y==null?void 0:y.onerror)!==null&&n!==void 0?n:function(R){},onclose:(i=y==null?void 0:y.onclose)!==null&&i!==void 0?i:function(R){}},T=this.webSocketFactory.create(f,yy(p),C);T.connect(),await g;let w=Z(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&w.startsWith("publishers/")){const R=this.apiClient.getProject(),N=this.apiClient.getLocation();w=`projects/${R}/locations/${N}/`+w}let M={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Nn.AUDIO]}:e.config.responseModalities=[Nn.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const D=(u=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[],A=[];for(const R of D)if(this.isCallableTool(R)){const N=R;A.push(await N.tool())}else A.push(R);A.length>0&&(e.config.tools=A);const V={model:w,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?M=wh(this.apiClient,V):M=Th(this.apiClient,V),delete M.config,T.send(JSON.stringify(M)),new gy(T,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const my={turnComplete:!0};class gy{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let i=[];try{i=Ae(n.turns),e.isVertexAI()?i=i.map(o=>_t(o)):i=i.map(o=>Yn(o))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:i,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let i=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?i=n.functionResponses:i=[n.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(const r of i){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(fy)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},my),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:Mh(e)}:n={realtimeInput:Ih(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function yy(t){const e={};return t.forEach((n,i)=>{e[i]=n}),e}function _y(t){const e=new Headers;for(const[n,i]of Object.entries(t))e.append(n,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pr=10;function mr(t){var e,n,i;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(const l of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(yn(l)){o=!0;break}if(!o)return!0;const r=(i=t==null?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function yn(t){return"callTool"in t&&typeof t.callTool=="function"}function gr(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vy extends yt{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var i,o,r,l,u;const d=await this.processParamsForMcpUsage(n);if(!oy(n)||mr(n.config))return await this.generateContentInternal(d);if(sy(n))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let c,f;const h=Ae(d.contents),p=(r=(o=(i=d.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&r!==void 0?r:pr;let m=0;for(;m<p&&(c=await this.generateContentInternal(d),!(!c.functionCalls||c.functionCalls.length===0));){const g=c.candidates[0].content,y=[];for(const v of(u=(l=n.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[])if(yn(v)){const C=await v.callTool(c.functionCalls);y.push(...C)}m++,f={role:"user",parts:y},d.contents=Ae(d.contents),d.contents.push(g),d.contents.push(f),gr(d.config)&&(h.push(g),h.push(f))}return gr(d.config)&&(c.automaticFunctionCallingHistory=h),c},this.generateContentStream=async n=>{if(mr(n.config)){const i=await this.processParamsForMcpUsage(n);return await this.generateContentStreamInternal(i)}else return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(i=>{var o;let r;const l=[];if(i!=null&&i.generatedImages)for(const d of i.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((o=d==null?void 0:d.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?r=d==null?void 0:d.safetyAttributes:l.push(d);let u;return r?u={generatedImages:l,positivePromptSafetyAttributes:r}:u={generatedImages:l},u}),this.list=async n=>{var i;const l={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((i=l.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Wn(mt.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(l),l)},this.editImage=async n=>{const i={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(i.referenceImages=n.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async n=>{let i={numberOfImages:1,mode:"upscale"};n.config&&(i=Object.assign(Object.assign({},i),n.config));const o={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:i};return await this.upscaleImageInternal(o)}}async processParamsForMcpUsage(e){var n,i,o;const r=(n=e.config)===null||n===void 0?void 0:n.tools;if(!r)return e;const l=await Promise.all(r.map(async d=>yn(d)?await d.tool():d)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:l})};if(u.config.tools=l,e.config&&e.config.tools&&_l(e.config.tools)){const d=(o=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&o!==void 0?o:{};let c=Object.assign({},d);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),vl(c),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return u}async initAfcToolsMap(e){var n,i,o;const r=new Map;for(const l of(i=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&i!==void 0?i:[])if(yn(l)){const u=l,d=await u.tool();for(const c of(o=d.functionDeclarations)!==null&&o!==void 0?o:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,u)}}return r}async processAfcStream(e){var n,i,o;const r=(o=(i=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:pr;let l=!1,u=0;const d=await this.initAfcToolsMap(e);return function(c,f,h){var p,m;return ut(this,arguments,function*(){for(var g,y,v,E;u<r;){l&&(u++,l=!1);const M=yield X(c.processParamsForMcpUsage(h)),D=yield X(c.generateContentStreamInternal(M)),A=[],V=[];try{for(var C=!0,T=(y=void 0,Ft(D)),w;w=yield X(T.next()),g=w.done,!g;C=!0){E=w.value,C=!1;const R=E;if(yield yield X(R),R.candidates&&(!((p=R.candidates[0])===null||p===void 0)&&p.content)){V.push(R.candidates[0].content);for(const N of(m=R.candidates[0].content.parts)!==null&&m!==void 0?m:[])if(u<r&&N.functionCall){if(!N.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(N.functionCall.name)){const L=yield X(f.get(N.functionCall.name).callTool([N.functionCall]));A.push(...L)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${N.functionCall.name}`)}}}}catch(R){y={error:R}}finally{try{!C&&!g&&(v=T.return)&&(yield X(v.call(T)))}finally{if(y)throw y.error}}if(A.length>0){l=!0;const R=new wt;R.candidates=[{content:{role:"user",parts:A}}],yield yield X(R);const N=[];N.push(...V),N.push({role:"user",parts:A});const L=Ae(h.contents).concat(N);h.contents=L}else break}})}(this,d,e)}async generateContentInternal(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=ur(this.apiClient,e);return u=F("{model}:generateContent",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>{const h=dr(f),p=new wt;return Object.assign(p,h),p})}else{const c=lr(this.apiClient,e);return u=F("{model}:generateContent",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const h=cr(f),p=new wt;return Object.assign(p,h),p})}}async generateContentStreamInternal(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=ur(this.apiClient,e);return u=F("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),l.then(function(h){return ut(this,arguments,function*(){var p,m,g,y;try{for(var v=!0,E=Ft(h),C;C=yield X(E.next()),p=C.done,!p;v=!0){y=C.value,v=!1;const w=dr(yield X(y.json())),M=new wt;Object.assign(M,w),yield yield X(M)}}catch(T){m={error:T}}finally{try{!v&&!p&&(g=E.return)&&(yield X(g.call(E)))}finally{if(m)throw m.error}}})})}else{const c=lr(this.apiClient,e);return u=F("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),l.then(function(h){return ut(this,arguments,function*(){var p,m,g,y;try{for(var v=!0,E=Ft(h),C;C=yield X(E.next()),p=C.done,!p;v=!0){y=C.value,v=!1;const w=cr(yield X(y.json())),M=new wt;Object.assign(M,w),yield yield X(M)}}catch(T){m={error:T}}finally{try{!v&&!p&&(g=E.return)&&(yield X(g.call(E)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Im(this.apiClient,e);return u=F("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>{const h=Ng(f),p=new Gs;return Object.assign(p,h),p})}else{const c=Op(this.apiClient,e);return u=F("{model}:batchEmbedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const h=lg(f),p=new Gs;return Object.assign(p,h),p})}}async generateImagesInternal(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Rm(this.apiClient,e);return u=F("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>{const h=Dg(f),p=new qs;return Object.assign(p,h),p})}else{const c=Gp(this.apiClient,e);return u=F("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const h=dg(f),p=new qs;return Object.assign(p,h),p})}}async editImageInternal(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const u=Fm(this.apiClient,e);return r=F("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{const c=Lg(d),f=new $c;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const u=Vm(this.apiClient,e);return r=F("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{const c=Fg(d),f=new Oc;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=$m(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>Ui(f))}else{const c=qp(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Fi(f))}}async listInternal(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Bm(this.apiClient,e);return u=F("{models_url}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>{const h=Og(this.apiClient,f),p=new Js;return Object.assign(p,h),p})}else{const c=Hp(this.apiClient,e);return u=F("{models_url}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const h=hg(this.apiClient,f),p=new Js;return Object.assign(p,h),p})}}async update(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=qm(this.apiClient,e);return u=F("{model}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>Ui(f))}else{const c=Kp(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Fi(f))}}async delete(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Jm(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Bg(),h=new Hs;return Object.assign(h,f),h})}else{const c=Yp(this.apiClient,e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(()=>{const f=pg(),h=new Hs;return Object.assign(h,f),h})}}async countTokens(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Wm(this.apiClient,e);return u=F("{model}:countTokens",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>{const h=Gg(f),p=new Ws;return Object.assign(p,h),p})}else{const c=Zp(this.apiClient,e);return u=F("{model}:countTokens",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const h=mg(f),p=new Ws;return Object.assign(p,h),p})}}async computeTokens(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const u=Km(this.apiClient,e);return r=F("{model}:computeTokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{const c=qg(d),f=new Bc;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Zm(this.apiClient,e);return u=F("{model}:predictLongRunning",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>Kg(f))}else{const c=jp(this.apiClient,e);return u=F("{model}:predictLongRunning",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>vg(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Cy(t){const e={},n=s(t,["operationName"]);n!=null&&a(e,["_url","operationName"],n);const i=s(t,["config"]);return i!=null&&a(e,["config"],i),e}function Ty(t){const e={},n=s(t,["operationName"]);n!=null&&a(e,["_url","operationName"],n);const i=s(t,["config"]);return i!=null&&a(e,["config"],i),e}function wy(t){const e={},n=s(t,["operationName"]);n!=null&&a(e,["operationName"],n);const i=s(t,["resourceName"]);i!=null&&a(e,["_url","resourceName"],i);const o=s(t,["config"]);return o!=null&&a(e,["config"],o),e}function Sy(t){const e={},n=s(t,["video","uri"]);n!=null&&a(e,["uri"],n);const i=s(t,["video","encodedVideo"]);i!=null&&a(e,["videoBytes"],Le(i));const o=s(t,["encoding"]);return o!=null&&a(e,["mimeType"],o),e}function Ay(t){const e={},n=s(t,["_self"]);return n!=null&&a(e,["video"],Sy(n)),e}function Ey(t){const e={},n=s(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>Ay(l))),a(e,["generatedVideos"],r)}const i=s(t,["raiMediaFilteredCount"]);i!=null&&a(e,["raiMediaFilteredCount"],i);const o=s(t,["raiMediaFilteredReasons"]);return o!=null&&a(e,["raiMediaFilteredReasons"],o),e}function xy(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["metadata"]);i!=null&&a(e,["metadata"],i);const o=s(t,["done"]);o!=null&&a(e,["done"],o);const r=s(t,["error"]);r!=null&&a(e,["error"],r);const l=s(t,["response","generateVideoResponse"]);return l!=null&&a(e,["response"],Ey(l)),e}function Iy(t){const e={},n=s(t,["gcsUri"]);n!=null&&a(e,["uri"],n);const i=s(t,["bytesBase64Encoded"]);i!=null&&a(e,["videoBytes"],Le(i));const o=s(t,["mimeType"]);return o!=null&&a(e,["mimeType"],o),e}function My(t){const e={},n=s(t,["_self"]);return n!=null&&a(e,["video"],Iy(n)),e}function Ry(t){const e={},n=s(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>My(l))),a(e,["generatedVideos"],r)}const i=s(t,["raiMediaFilteredCount"]);i!=null&&a(e,["raiMediaFilteredCount"],i);const o=s(t,["raiMediaFilteredReasons"]);return o!=null&&a(e,["raiMediaFilteredReasons"],o),e}function yr(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["metadata"]);i!=null&&a(e,["metadata"],i);const o=s(t,["done"]);o!=null&&a(e,["done"],o);const r=s(t,["error"]);r!=null&&a(e,["error"],r);const l=s(t,["response"]);return l!=null&&a(e,["response"],Ry(l)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Py extends yt{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,i=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=n.name.split("/operations/")[0];let r;return i&&"httpOptions"in i&&(r=i.httpOptions),this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:r}})}else return this.getVideosOperationInternal({operationName:n.name,config:i})}async getVideosOperationInternal(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ty(e);return u=F("{operationName}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>yr(f))}else{const c=Cy(e);return u=F("{operationName}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>xy(f))}}async fetchPredictVideosOperationInternal(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const u=wy(e);return r=F("{resourceName}:fetchPredictOperation",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>yr(d))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ky(t){const e={},n=s(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function Cl(t){const e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],ky(n)),e}function Ny(t){const e={},n=s(t,["speaker"]);n!=null&&a(e,["speaker"],n);const i=s(t,["voiceConfig"]);return i!=null&&a(e,["voiceConfig"],Cl(i)),e}function by(t){const e={},n=s(t,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Ny(o))),a(e,["speakerVoiceConfigs"],i)}return e}function Dy(t){const e={},n=s(t,["voiceConfig"]);n!=null&&a(e,["voiceConfig"],Cl(n));const i=s(t,["multiSpeakerVoiceConfig"]);i!=null&&a(e,["multiSpeakerVoiceConfig"],by(i));const o=s(t,["languageCode"]);return o!=null&&a(e,["languageCode"],o),e}function Ly(t){const e={},n=s(t,["fps"]);n!=null&&a(e,["fps"],n);const i=s(t,["endOffset"]);i!=null&&a(e,["endOffset"],i);const o=s(t,["startOffset"]);return o!=null&&a(e,["startOffset"],o),e}function Fy(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["data"]);n!=null&&a(e,["data"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Uy(t){const e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=s(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const i=s(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Vy(t){const e={},n=s(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],Ly(n));const i=s(t,["thought"]);i!=null&&a(e,["thought"],i);const o=s(t,["inlineData"]);o!=null&&a(e,["inlineData"],Fy(o));const r=s(t,["fileData"]);r!=null&&a(e,["fileData"],Uy(r));const l=s(t,["thoughtSignature"]);l!=null&&a(e,["thoughtSignature"],l);const u=s(t,["codeExecutionResult"]);u!=null&&a(e,["codeExecutionResult"],u);const d=s(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const c=s(t,["functionCall"]);c!=null&&a(e,["functionCall"],c);const f=s(t,["functionResponse"]);f!=null&&a(e,["functionResponse"],f);const h=s(t,["text"]);return h!=null&&a(e,["text"],h),e}function $y(t){const e={},n=s(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Vy(r))),a(e,["parts"],o)}const i=s(t,["role"]);return i!=null&&a(e,["role"],i),e}function Oy(t){const e={},n=s(t,["behavior"]);n!=null&&a(e,["behavior"],n);const i=s(t,["description"]);i!=null&&a(e,["description"],i);const o=s(t,["name"]);o!=null&&a(e,["name"],o);const r=s(t,["parameters"]);r!=null&&a(e,["parameters"],r);const l=s(t,["parametersJsonSchema"]);l!=null&&a(e,["parametersJsonSchema"],l);const u=s(t,["response"]);u!=null&&a(e,["response"],u);const d=s(t,["responseJsonSchema"]);return d!=null&&a(e,["responseJsonSchema"],d),e}function By(t){const e={},n=s(t,["startTime"]);n!=null&&a(e,["startTime"],n);const i=s(t,["endTime"]);return i!=null&&a(e,["endTime"],i),e}function Gy(t){const e={},n=s(t,["timeRangeFilter"]);return n!=null&&a(e,["timeRangeFilter"],By(n)),e}function qy(t){const e={},n=s(t,["mode"]);n!=null&&a(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&a(e,["dynamicThreshold"],i),e}function Jy(t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],qy(n)),e}function Hy(){return{}}function Wy(t){const e={},n=s(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>Oy(d))),a(e,["functionDeclarations"],u)}if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=s(t,["googleSearch"]);i!=null&&a(e,["googleSearch"],Gy(i));const o=s(t,["googleSearchRetrieval"]);if(o!=null&&a(e,["googleSearchRetrieval"],Jy(o)),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(s(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");s(t,["urlContext"])!=null&&a(e,["urlContext"],Hy());const l=s(t,["codeExecution"]);return l!=null&&a(e,["codeExecution"],l),e}function Ky(t){const e={},n=s(t,["handle"]);if(n!=null&&a(e,["handle"],n),s(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function _r(){return{}}function Yy(t){const e={},n=s(t,["disabled"]);n!=null&&a(e,["disabled"],n);const i=s(t,["startOfSpeechSensitivity"]);i!=null&&a(e,["startOfSpeechSensitivity"],i);const o=s(t,["endOfSpeechSensitivity"]);o!=null&&a(e,["endOfSpeechSensitivity"],o);const r=s(t,["prefixPaddingMs"]);r!=null&&a(e,["prefixPaddingMs"],r);const l=s(t,["silenceDurationMs"]);return l!=null&&a(e,["silenceDurationMs"],l),e}function zy(t){const e={},n=s(t,["automaticActivityDetection"]);n!=null&&a(e,["automaticActivityDetection"],Yy(n));const i=s(t,["activityHandling"]);i!=null&&a(e,["activityHandling"],i);const o=s(t,["turnCoverage"]);return o!=null&&a(e,["turnCoverage"],o),e}function Zy(t){const e={},n=s(t,["targetTokens"]);return n!=null&&a(e,["targetTokens"],n),e}function Xy(t){const e={},n=s(t,["triggerTokens"]);n!=null&&a(e,["triggerTokens"],n);const i=s(t,["slidingWindow"]);return i!=null&&a(e,["slidingWindow"],Zy(i)),e}function Qy(t){const e={},n=s(t,["proactiveAudio"]);return n!=null&&a(e,["proactiveAudio"],n),e}function jy(t,e){const n={},i=s(t,["generationConfig"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig"],i);const o=s(t,["responseModalities"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig","responseModalities"],o);const r=s(t,["temperature"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig","temperature"],r);const l=s(t,["topP"]);e!==void 0&&l!=null&&a(e,["setup","generationConfig","topP"],l);const u=s(t,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const d=s(t,["maxOutputTokens"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","maxOutputTokens"],d);const c=s(t,["mediaResolution"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","mediaResolution"],c);const f=s(t,["seed"]);e!==void 0&&f!=null&&a(e,["setup","generationConfig","seed"],f);const h=s(t,["speechConfig"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","speechConfig"],Dy(fo(h)));const p=s(t,["enableAffectiveDialog"]);e!==void 0&&p!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],p);const m=s(t,["systemInstruction"]);e!==void 0&&m!=null&&a(e,["setup","systemInstruction"],$y(ce(m)));const g=s(t,["tools"]);if(e!==void 0&&g!=null){let M=Kt(g);Array.isArray(M)&&(M=M.map(D=>Wy(Wt(D)))),a(e,["setup","tools"],M)}const y=s(t,["sessionResumption"]);e!==void 0&&y!=null&&a(e,["setup","sessionResumption"],Ky(y));const v=s(t,["inputAudioTranscription"]);e!==void 0&&v!=null&&a(e,["setup","inputAudioTranscription"],_r());const E=s(t,["outputAudioTranscription"]);e!==void 0&&E!=null&&a(e,["setup","outputAudioTranscription"],_r());const C=s(t,["realtimeInputConfig"]);e!==void 0&&C!=null&&a(e,["setup","realtimeInputConfig"],zy(C));const T=s(t,["contextWindowCompression"]);e!==void 0&&T!=null&&a(e,["setup","contextWindowCompression"],Xy(T));const w=s(t,["proactivity"]);return e!==void 0&&w!=null&&a(e,["setup","proactivity"],Qy(w)),n}function e_(t,e){const n={},i=s(e,["model"]);i!=null&&a(n,["setup","model"],Z(t,i));const o=s(e,["config"]);return o!=null&&a(n,["config"],jy(o,n)),n}function t_(t,e,n){const i={},o=s(e,["expireTime"]);n!==void 0&&o!=null&&a(n,["expireTime"],o);const r=s(e,["newSessionExpireTime"]);n!==void 0&&r!=null&&a(n,["newSessionExpireTime"],r);const l=s(e,["uses"]);n!==void 0&&l!=null&&a(n,["uses"],l);const u=s(e,["liveConnectConstraints"]);n!==void 0&&u!=null&&a(n,["bidiGenerateContentSetup"],e_(t,u));const d=s(e,["lockAdditionalFields"]);return n!==void 0&&d!=null&&a(n,["fieldMask"],d),i}function n_(t,e){const n={},i=s(e,["config"]);return i!=null&&a(n,["config"],t_(t,i,n)),n}function i_(t){const e={},n=s(t,["name"]);return n!=null&&a(e,["name"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function o_(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){const o=Object.keys(i).map(r=>`${n}.${r}`);e.push(...o)}else e.push(n)}return e.join(",")}function s_(t,e){let n=null;const i=t.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){const r=i.setup;typeof r=="object"&&r!==null?(t.bidiGenerateContentSetup=r,n=r):delete t.bidiGenerateContentSetup}else i!==void 0&&delete t.bidiGenerateContentSetup;const o=t.fieldMask;if(n){const r=o_(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?t.fieldMask=r:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){const l=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];o.length>0&&(u=o.map(c=>l.includes(c)?`generationConfig.${c}`:c));const d=[];r&&d.push(r),u.length>0&&d.push(...u),d.length>0?t.fieldMask=d.join(","):delete t.fieldMask}else delete t.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?t.fieldMask=o.join(","):delete t.fieldMask;return t}class r_ extends yt{constructor(e){super(),this.apiClient=e}async create(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=n_(this.apiClient,e);r=F("auth_tokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query;const d=s_(u,e.config);return o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),o.then(c=>i_(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function a_(t){const e={},n=s(t,["name"]);n!=null&&a(e,["_url","name"],n);const i=s(t,["config"]);return i!=null&&a(e,["config"],i),e}function l_(t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=s(t,["pageToken"]);e!==void 0&&o!=null&&a(e,["_query","pageToken"],o);const r=s(t,["filter"]);return e!==void 0&&r!=null&&a(e,["_query","filter"],r),n}function u_(t){const e={},n=s(t,["config"]);return n!=null&&a(e,["config"],l_(n,e)),e}function c_(t){const e={},n=s(t,["textInput"]);n!=null&&a(e,["textInput"],n);const i=s(t,["output"]);return i!=null&&a(e,["output"],i),e}function d_(t){const e={};if(s(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=s(t,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>c_(o))),a(e,["examples","examples"],i)}return e}function f_(t,e){const n={};if(s(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=s(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&a(e,["displayName"],i),s(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=s(t,["epochCount"]);e!==void 0&&o!=null&&a(e,["tuningTask","hyperparameters","epochCount"],o);const r=s(t,["learningRateMultiplier"]);if(r!=null&&a(n,["tuningTask","hyperparameters","learningRateMultiplier"],r),s(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(s(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=s(t,["batchSize"]);e!==void 0&&l!=null&&a(e,["tuningTask","hyperparameters","batchSize"],l);const u=s(t,["learningRate"]);return e!==void 0&&u!=null&&a(e,["tuningTask","hyperparameters","learningRate"],u),n}function h_(t){const e={},n=s(t,["baseModel"]);n!=null&&a(e,["baseModel"],n);const i=s(t,["trainingDataset"]);i!=null&&a(e,["tuningTask","trainingData"],d_(i));const o=s(t,["config"]);return o!=null&&a(e,["config"],f_(o,e)),e}function p_(t){const e={},n=s(t,["name"]);n!=null&&a(e,["_url","name"],n);const i=s(t,["config"]);return i!=null&&a(e,["config"],i),e}function m_(t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&a(e,["_query","pageSize"],i);const o=s(t,["pageToken"]);e!==void 0&&o!=null&&a(e,["_query","pageToken"],o);const r=s(t,["filter"]);return e!==void 0&&r!=null&&a(e,["_query","filter"],r),n}function g_(t){const e={},n=s(t,["config"]);return n!=null&&a(e,["config"],m_(n,e)),e}function y_(t,e){const n={},i=s(t,["gcsUri"]);if(e!==void 0&&i!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],i),s(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function __(t){const e={},n=s(t,["gcsUri"]);return n!=null&&a(e,["validationDatasetUri"],n),e}function v_(t,e){const n={},i=s(t,["validationDataset"]);e!==void 0&&i!=null&&a(e,["supervisedTuningSpec"],__(i));const o=s(t,["tunedModelDisplayName"]);e!==void 0&&o!=null&&a(e,["tunedModelDisplayName"],o);const r=s(t,["description"]);e!==void 0&&r!=null&&a(e,["description"],r);const l=s(t,["epochCount"]);e!==void 0&&l!=null&&a(e,["supervisedTuningSpec","hyperParameters","epochCount"],l);const u=s(t,["learningRateMultiplier"]);e!==void 0&&u!=null&&a(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],u);const d=s(t,["exportLastCheckpointOnly"]);e!==void 0&&d!=null&&a(e,["supervisedTuningSpec","exportLastCheckpointOnly"],d);const c=s(t,["adapterSize"]);if(e!==void 0&&c!=null&&a(e,["supervisedTuningSpec","hyperParameters","adapterSize"],c),s(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(s(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return n}function C_(t){const e={},n=s(t,["baseModel"]);n!=null&&a(e,["baseModel"],n);const i=s(t,["trainingDataset"]);i!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],y_(i,e));const o=s(t,["config"]);return o!=null&&a(e,["config"],v_(o,e)),e}function T_(t){const e={},n=s(t,["name"]);n!=null&&a(e,["model"],n);const i=s(t,["name"]);return i!=null&&a(e,["endpoint"],i),e}function Tl(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["state"]);i!=null&&a(e,["state"],ol(i));const o=s(t,["createTime"]);o!=null&&a(e,["createTime"],o);const r=s(t,["tuningTask","startTime"]);r!=null&&a(e,["startTime"],r);const l=s(t,["tuningTask","completeTime"]);l!=null&&a(e,["endTime"],l);const u=s(t,["updateTime"]);u!=null&&a(e,["updateTime"],u);const d=s(t,["description"]);d!=null&&a(e,["description"],d);const c=s(t,["baseModel"]);c!=null&&a(e,["baseModel"],c);const f=s(t,["_self"]);f!=null&&a(e,["tunedModel"],T_(f));const h=s(t,["distillationSpec"]);h!=null&&a(e,["distillationSpec"],h);const p=s(t,["experiment"]);p!=null&&a(e,["experiment"],p);const m=s(t,["labels"]);m!=null&&a(e,["labels"],m);const g=s(t,["pipelineJob"]);g!=null&&a(e,["pipelineJob"],g);const y=s(t,["serviceAccount"]);y!=null&&a(e,["serviceAccount"],y);const v=s(t,["tunedModelDisplayName"]);return v!=null&&a(e,["tunedModelDisplayName"],v),e}function w_(t){const e={},n=s(t,["nextPageToken"]);n!=null&&a(e,["nextPageToken"],n);const i=s(t,["tunedModels"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>Tl(r))),a(e,["tuningJobs"],o)}return e}function S_(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["metadata"]);i!=null&&a(e,["metadata"],i);const o=s(t,["done"]);o!=null&&a(e,["done"],o);const r=s(t,["error"]);return r!=null&&a(e,["error"],r),e}function A_(t){const e={},n=s(t,["checkpointId"]);n!=null&&a(e,["checkpointId"],n);const i=s(t,["epoch"]);i!=null&&a(e,["epoch"],i);const o=s(t,["step"]);o!=null&&a(e,["step"],o);const r=s(t,["endpoint"]);return r!=null&&a(e,["endpoint"],r),e}function E_(t){const e={},n=s(t,["model"]);n!=null&&a(e,["model"],n);const i=s(t,["endpoint"]);i!=null&&a(e,["endpoint"],i);const o=s(t,["checkpoints"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>A_(l))),a(e,["checkpoints"],r)}return e}function $i(t){const e={},n=s(t,["name"]);n!=null&&a(e,["name"],n);const i=s(t,["state"]);i!=null&&a(e,["state"],ol(i));const o=s(t,["createTime"]);o!=null&&a(e,["createTime"],o);const r=s(t,["startTime"]);r!=null&&a(e,["startTime"],r);const l=s(t,["endTime"]);l!=null&&a(e,["endTime"],l);const u=s(t,["updateTime"]);u!=null&&a(e,["updateTime"],u);const d=s(t,["error"]);d!=null&&a(e,["error"],d);const c=s(t,["description"]);c!=null&&a(e,["description"],c);const f=s(t,["baseModel"]);f!=null&&a(e,["baseModel"],f);const h=s(t,["tunedModel"]);h!=null&&a(e,["tunedModel"],E_(h));const p=s(t,["supervisedTuningSpec"]);p!=null&&a(e,["supervisedTuningSpec"],p);const m=s(t,["tuningDataStats"]);m!=null&&a(e,["tuningDataStats"],m);const g=s(t,["encryptionSpec"]);g!=null&&a(e,["encryptionSpec"],g);const y=s(t,["partnerModelTuningSpec"]);y!=null&&a(e,["partnerModelTuningSpec"],y);const v=s(t,["distillationSpec"]);v!=null&&a(e,["distillationSpec"],v);const E=s(t,["experiment"]);E!=null&&a(e,["experiment"],E);const C=s(t,["labels"]);C!=null&&a(e,["labels"],C);const T=s(t,["pipelineJob"]);T!=null&&a(e,["pipelineJob"],T);const w=s(t,["serviceAccount"]);w!=null&&a(e,["serviceAccount"],w);const M=s(t,["tunedModelDisplayName"]);return M!=null&&a(e,["tunedModelDisplayName"],M),e}function x_(t){const e={},n=s(t,["nextPageToken"]);n!=null&&a(e,["nextPageToken"],n);const i=s(t,["tuningJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>$i(r))),a(e,["tuningJobs"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class I_ extends yt{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new Wn(mt.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(n),n),this.tune=async n=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(n);{const i=await this.tuneMldevInternal(n);let o="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?o=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(o=i.name.split("/operations/")[0]),{name:o,state:ki.JOB_STATE_QUEUED}}}}async getInternal(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=p_(e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>$i(f))}else{const c=a_(e);return u=F("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Tl(f))}}async listInternal(e){var n,i,o,r;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=g_(e);return u=F("tuningJobs",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),l.then(f=>{const h=x_(f),p=new Ks;return Object.assign(p,h),p})}else{const c=u_(e);return u=F("tunedModels",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const h=w_(f),p=new Ks;return Object.assign(p,h),p})}}async tuneInternal(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const u=C_(e);return r=F("tuningJobs",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>$i(d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=h_(e);return r=F("tunedModels",u._url),l=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>S_(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class M_{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const R_=1024*1024*8,P_=3,k_=1e3,N_=2,ci="x-goog-upload-status";async function b_(t,e,n){var i,o,r;let l=0,u=0,d=new Ni(new Response),c="upload";for(l=t.size;u<l;){const h=Math.min(R_,l-u),p=t.slice(u,u+h);u+h>=l&&(c+=", finalize");let m=0,g=k_;for(;m<P_&&(d=await n.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(u),"Content-Length":String(h)}}}),!(!((i=d==null?void 0:d.headers)===null||i===void 0)&&i[ci]));)m++,await L_(g),g=g*N_;if(u+=h,((o=d==null?void 0:d.headers)===null||o===void 0?void 0:o[ci])!=="active")break;if(l<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const f=await(d==null?void 0:d.json());if(((r=d==null?void 0:d.headers)===null||r===void 0?void 0:r[ci])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return f.file}async function D_(t){return{size:t.size,type:t.type}}function L_(t){return new Promise(e=>setTimeout(e,t))}class F_{async upload(e,n,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await b_(e,n,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await D_(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class U_{create(e,n,i){return new V_(e,n,i)}}class V_{constructor(e,n,i){this.url=e,this.headers=n,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vr="x-goog-api-key";class $_{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(vr)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(vr,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const O_="gl-node/";class B_{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const i=Vc(e,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion;const o=new $_(this.apiKey);this.apiClient=new ty({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:O_+"web",uploader:new F_,downloader:new M_}),this.models=new vy(this.apiClient),this.live=new py(this.apiClient,o,new U_),this.chats=new ff(this.models,this.apiClient),this.caches=new uf(this.apiClient),this.files=new Ef(this.apiClient),this.operations=new Py(this.apiClient),this.authTokens=new r_(this.apiClient),this.tunings=new I_(this.apiClient)}}let Oi=null;const vt=async()=>(Oi??(Oi=await qe.getActiveApiKey(fe)),Oi),Hv=async()=>{Oi=await qe.getActiveApiKey(fe),_n=null};let _n=null;const Zn=async()=>{const t=await vt();return!_n&&t&&(_n=new B_({apiKey:t})),_n},G_=t=>{const e=Array.isArray(t.text)?t.text.join(`
`):t.text;switch(t.sender){case"character":return{role:"model",parts:[{text:e}]};case"user":default:return{role:"user",parts:[{text:e}]}}},wl=t=>{const e=[],n=Ln(t,void 0,!t.characterConversationBase),i=t.characterConversationBase?t.characterConversationBase+n:n;return t.characterInitialMessage&&t.characterInitialMessage.length>0&&e.push({role:"model",parts:[{text:t.characterInitialMessage.join(`
`)}]}),t.messages&&t.messages.length>0&&t.messages.forEach(o=>{e.push(G_(o))}),e.length>0&&e[e.length-1].role==="model"&&(e.length===1&&e[0].role==="model"||e.length===0)&&e.push({role:"user",parts:[{text:"[instigate the conversation with the user]"}]}),e.length===0&&e.push({role:"user",parts:[{text:"[instigate the conversation with the user]"}]}),{messages:e,systemInstruction:i}},q_=async(t,e="gemini-2.5-flash",n=1e3)=>{var i,o,r,l,u;try{if(!await vt())throw new Error("Google AI API key is not configured. Please configure your API key in the application settings.");const c=await Zn();if(!c)throw new Error("Failed to initialize Google AI client");const{messages:f,systemInstruction:h}=wl(t),p=t.temperature||.7,m=f.map(E=>({role:E.role,parts:E.parts})),g={model:e,contents:m,generationConfig:{temperature:p,maxOutputTokens:n}};h&&(g.config={systemInstruction:h});const v=(u=(l=(r=(o=(i=(await c.models.generateContent(g)).candidates)==null?void 0:i[0])==null?void 0:o.content)==null?void 0:r.parts)==null?void 0:l[0])==null?void 0:u.text;if(!v)throw new Error("No response received from Google AI");return v}catch(d){throw console.error("Error getting chat completion:",d),d}},J_=async(t,e="gemini-2.5-flash",n=1e3,i)=>{var o,r,l,u,d;try{if(!await vt())throw new Error("Google AI API key is not configured. Please configure your API key in the application settings.");const f=await Zn();if(!f)throw new Error("Failed to initialize Google AI client");const{messages:h,systemInstruction:p}=wl(t),m=t.temperature||.7,g=h.map(C=>({role:C.role,parts:C.parts})),y={model:e,contents:g,generationConfig:{temperature:m,maxOutputTokens:n}};p&&(y.config={systemInstruction:p});const v=await f.models.generateContentStream(y);let E="";for await(const C of v){const T=(d=(u=(l=(r=(o=C.candidates)==null?void 0:o[0])==null?void 0:r.content)==null?void 0:l.parts)==null?void 0:u[0])==null?void 0:d.text;T&&(E+=T,i==null||i(T))}return E}catch(c){throw console.error("Error getting streaming chat completion:",c),c}},H_=(t,e="character")=>({id:`msg_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,sender:e,text:[t]}),W_=async()=>{var t,e,n,i,o;try{if(!await vt())return!1;const l=await Zn();return l?!!((o=(i=(n=(e=(t=(await l.models.generateContent({model:"gemini-1.5-flash",contents:[{role:"user",parts:[{text:"Hello"}]}]})).candidates)==null?void 0:t[0])==null?void 0:e.content)==null?void 0:n.parts)==null?void 0:i[0])!=null&&o.text):!1}catch(r){return console.error("Invalid Google AI API key:",r),!1}},K_=async()=>!!await vt(),Y_=async()=>{try{if(!await vt())throw new Error("Google AI API key not configured");const e=await Zn();if(!e)throw new Error("Failed to initialize Google AI client");const n=await e.models.list(),i=[];for await(const r of n)i.push(r);return i.filter(r=>{var l;return((l=r.supportedActions)==null?void 0:l.includes("generateContent"))&&!r.name.includes("embedding")&&!r.name.includes("tts")&&!r.name.includes("image")&&!r.name.includes("aqa")&&!r.name.includes("gemma")}).map(r=>r.name.replace("models/","")).sort((r,l)=>{const u=!r.includes("exp")&&!r.includes("preview"),d=!l.includes("exp")&&!l.includes("preview");return u&&!d?-1:!u&&d?1:r.localeCompare(l)})}catch(t){return console.error("Error fetching available models:",t),["gemini-2.5-pro","gemini-2.5-flash","gemini-2.0-flash","gemini-1.5-pro","gemini-1.5-flash","gemini-1.5-flash-8b"]}},z_=t=>({"gemini-2.5-pro":{name:"Gemini 2.5 Pro",tier:"premium",description:"Most powerful thinking model with maximum response accuracy"},"gemini-2.5-flash":{name:"Gemini 2.5 Flash",tier:"pro",description:"Best model for price-performance with thinking capabilities"},"gemini-2.5-flash-lite-preview-06-17":{name:"Gemini 2.5 Flash Lite",tier:"free",description:"Most cost-efficient model optimized for high throughput"},"gemini-2.0-flash":{name:"Gemini 2.0 Flash",tier:"pro",description:"Next generation model with speed and realtime streaming"},"gemini-2.0-flash-lite":{name:"Gemini 2.0 Flash Lite",tier:"free",description:"Cost-efficient and low latency version of 2.0 Flash"},"gemini-1.5-flash":{name:"Gemini 1.5 Flash",tier:"free",description:"Fast and versatile model for most tasks"},"gemini-1.5-flash-8b":{name:"Gemini 1.5 Flash 8B",tier:"free",description:"Smaller, faster version of Flash for high volume tasks"},"gemini-1.5-pro":{name:"Gemini 1.5 Pro",tier:"pro",description:"Complex reasoning tasks requiring more intelligence"},"gemini-1.0-pro":{name:"Gemini 1.0 Pro",tier:"pro",description:"Previous generation pro model (legacy)"}})[t]||{name:t,tier:"pro",description:"Unknown model"};let Cr=null,Z_="http://localhost:11434";const X_=async()=>(Cr??(Cr=await qe.getActiveApiKey(le)),Cr),Xn=async()=>await X_()??Z_,Q_=t=>{const e=Array.isArray(t.text)?t.text.join(`
`):t.text;switch(t.sender){case"character":return{role:"assistant",content:e};case"user":default:return{role:"user",content:e}}},Sl=t=>{const e=[],n=Ln(t,void 0,!t.characterConversationBase),i=t.characterConversationBase?t.characterConversationBase+n:n;return e.push({role:"system",content:i}),t.characterInitialMessage&&t.characterInitialMessage.length>0&&e.push({role:"assistant",content:t.characterInitialMessage.join(`
`)}),t.messages&&t.messages.length>0&&t.messages.forEach(o=>{e.push(Q_(o))}),e},j_=async(t,e="llama3.2",n=1e3)=>{var i;try{const o=await Xn(),r=Sl(t),l=t.temperature||.7,u={model:e,messages:r,stream:!1,options:{temperature:l,num_predict:n}},c=(i=(await qn(`${o}/api/chat`,{method:"POST",body:JSON.stringify(u),headers:{"Content-Type":"application/json"}})).message)==null?void 0:i.content;if(!c)throw new Error("No response received from Ollama");return c}catch(o){throw console.error("Error getting chat completion from Ollama:",o),o}},ev=async(t,e="llama3.2",n=1e3,i)=>{const o=await Xn(),r=Sl(t),l=t.temperature||.7;return tv(o,{model:e,messages:r,stream:!0,options:{temperature:l,num_predict:n}},i)},tv=async(t,e,n)=>{const i=await nv(t,e);return iv(i,n)},nv=async(t,e)=>{const n=await fetch(`${t}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n},iv=async(t,e)=>{var r;const n=(r=t.body)==null?void 0:r.getReader();if(!n)throw new Error("Failed to get response reader");const i=new TextDecoder;let o="";try{for(;;){const{done:l,value:u}=await n.read();if(l)break;const d=i.decode(u,{stream:!0}),c=ov(d);c&&(o+=c,e==null||e(c))}}finally{n.releaseLock()}return o},ov=t=>{var i;const e=t.split(`
`).filter(o=>o.trim());let n="";for(const o of e)try{const r=JSON.parse(o);(i=r.message)!=null&&i.content&&(n+=r.message.content)}catch{console.warn("Failed to parse streaming response line:",o)}return n},sv=(t,e="character")=>({id:`msg_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,sender:e,text:[t]}),rv=async()=>{try{const t=await Xn();return(await fetch(`${t}/api/tags`,{method:"GET",headers:{"Content-Type":"application/json"}})).ok}catch(t){return console.error("Ollama connection validation failed:",t),!1}},av=async()=>!0,lv=async()=>{try{const t=await Xn();return(await qn(`${t}/api/tags`,{method:"GET",headers:{"Content-Type":"application/json"}})).models.map(n=>n.name).sort((n,i)=>n.localeCompare(i))}catch(t){return console.error("Error fetching available Ollama models:",t),["llama3.2","llama3.1","llama3","mistral","codellama","phi3","gemma2"]}},uv=t=>{const e="free";let n="Local Ollama model";return t.includes("llama3")?n="Meta's Llama 3 family - excellent general purpose models":t.includes("mistral")?n="Mistral AI's efficient and capable language model":t.includes("codellama")?n="Meta's Code Llama - specialized for code generation":t.includes("phi")?n="Microsoft's Phi models - small but capable":t.includes("gemma")&&(n="Google's Gemma models - lightweight and efficient"),{name:t,tier:e,description:n,provider:le}};let Bi=null;const Qn="https://openrouter.ai/api/v1",jn=async()=>(Bi??(Bi=await qe.getActiveApiKey(ue)),Bi),Wv=async()=>{Bi=await qe.getActiveApiKey(ue)},cv=t=>{const e=Array.isArray(t.text)?t.text.join(`
`):t.text;switch(t.sender){case"character":return{role:"assistant",content:e};case"user":default:return{role:"user",content:e}}},Al=t=>{const e=[],n=Ln(t,void 0,!t.characterConversationBase),i=t.characterConversationBase?t.characterConversationBase+n:n;return e.push({role:"system",content:i}),t.characterInitialMessage&&t.characterInitialMessage.length>0&&e.push({role:"assistant",content:t.characterInitialMessage.join(`
`)}),t.messages&&t.messages.length>0&&t.messages.forEach(o=>{e.push(cv(o))}),e},dv=async(t,e="openai/gpt-3.5-turbo",n=1e3)=>{var i,o;try{const r=await jn();if(!r)throw new Error("OpenRouter API key is not configured. Please configure your API key in the application settings.");const l=Al(t),u=t.temperature||.7,d={model:e,messages:l,temperature:u,max_tokens:n},f=(o=(i=(await qn(`${Qn}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"TTInteractive Chat"},body:JSON.stringify(d)})).choices[0])==null?void 0:i.message)==null?void 0:o.content;if(!f)throw new Error("No response received from OpenRouter");return f}catch(r){throw console.error("Error getting chat completion:",r),r}},fv=(t,e)=>{var i,o;if(!t.startsWith("data: "))return{content:"",isDone:!1};const n=t.slice(6);if(n==="[DONE]")return{content:"",isDone:!0};try{const l=(o=(i=JSON.parse(n).choices[0])==null?void 0:i.delta)==null?void 0:o.content;if(l)return e==null||e(l),{content:l,isDone:!1}}catch{}return{content:"",isDone:!1}},hv=async(t,e)=>{var r;const n=(r=t.body)==null?void 0:r.getReader();if(!n)throw new Error("Failed to get response reader");let i="";const o=new TextDecoder;try{for(;;){const{done:l,value:u}=await n.read();if(l)break;const c=o.decode(u,{stream:!0}).split(`
`).filter(f=>f.trim());for(const f of c){const{content:h,isDone:p}=fv(f,e);if(p)return i;i+=h}}}finally{n.releaseLock()}return i},pv=async(t,e="openai/gpt-3.5-turbo",n=1e3,i)=>{try{const o=await jn();if(!o)throw new Error("OpenRouter API key is not configured. Please configure your API key in the application settings.");const r=Al(t),l=t.temperature||.7,u={model:e,messages:r,temperature:l,max_tokens:n,stream:!0},d=await fetch(`${Qn}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"TTInteractive Chat"},body:JSON.stringify(u)});if(!d.ok)throw new Error(`OpenRouter API error: ${d.status}`);return await hv(d,i)}catch(o){throw console.error("Error getting streaming chat completion:",o),o}},mv=(t,e="character")=>({id:`msg_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,sender:e,text:[t]}),gv=async()=>{try{const t=await jn();return t?(await fetch(`${Qn}/models`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"HTTP-Referer":window.location.origin,"X-Title":"TTInteractive Chat"}})).ok:!1}catch(t){return console.error("Invalid OpenRouter API key:",t),!1}},yv=async()=>!!await jn(),_v=t=>{var i,o;const e=(i=t==null?void 0:t.id)==null?void 0:i.toLowerCase(),n=(o=t==null?void 0:t.architecture)==null?void 0:o.modality;return!e.includes("vision")&&!e.includes("dalle")&&!e.includes("whisper")&&!e.includes("tts")&&!e.includes("embedding")&&(n==="text"||n==="text->text")},vv=(t,e)=>{const n=["openai/gpt-4o","openai/gpt-4o-mini","openai/gpt-3.5-turbo","anthropic/claude-3.5-sonnet","anthropic/claude-3-haiku","google/gemini-2.0-flash-exp","google/gemini-pro","meta-llama/llama-3.1-8b-instruct","mistralai/mistral-7b-instruct"],i=n.indexOf(t),o=n.indexOf(e);return i!==-1&&o!==-1?i-o:i!==-1?-1:o!==-1?1:t.localeCompare(e)},Cv=()=>["openai/gpt-4o","openai/gpt-4o-mini","openai/gpt-3.5-turbo","anthropic/claude-3.5-sonnet","anthropic/claude-3-haiku","google/gemini-2.0-flash-exp","meta-llama/llama-3.1-8b-instruct","mistralai/mistral-7b-instruct"],Tv=async()=>{try{return(await qn(`${Qn}/models`,{method:"GET",headers:{"HTTP-Referer":window.location.origin,"X-Title":"TTInteractive Chat"}})).data.filter(_v).map(e=>e.id).sort(vv)}catch(t){return console.error("Error fetching available OpenRouter models:",t),Cv()}},wv=t=>{const e=t.toLowerCase();return e.includes("gpt-3.5-turbo")||e.includes("gemini-flash")||e.includes("llama-3.1-8b")||e.includes("mistral-7b")||e.includes("claude-3-haiku")?"free":e.includes("gpt-4o")||e.includes("claude-3.5-sonnet")||e.includes("claude-3-opus")||e.includes("gemini-pro")||e.includes("llama-3.1-70b")||e.includes("llama-3.1-405b")?"premium":"pro"},Sv=t=>t.startsWith("openai/")?"OpenAI model via OpenRouter":t.startsWith("anthropic/")?"Anthropic Claude model via OpenRouter":t.startsWith("google/")?"Google Gemini model via OpenRouter":t.startsWith("meta-llama/")?"Meta Llama model via OpenRouter":t.startsWith("mistralai/")?"Mistral AI model via OpenRouter":"AI model via OpenRouter",Av=t=>({name:t,tier:wv(t),description:Sv(t),provider:ue});class Ev{constructor(e=ae){_o(this,"provider");this.provider=e}async getChatCompletion(e,n){const{model:i,maxTokens:o=1e3}=n;switch(this.provider){case ae:return Xu(e,i,o);case fe:return q_(e,i,o);case le:return j_(e,i,o);case ue:return dv(e,i,o);default:throw new Error(`Unsupported AI provider: ${this.provider}`)}}async getStreamingChatCompletion(e,n,i){const{model:o,maxTokens:r=1e3}=i;switch(this.provider){case ae:return Qu(e,o,r,n);case fe:return J_(e,o,r,n);case le:return ev(e,o,r,n);case ue:return pv(e,o,r,n);default:throw new Error(`Unsupported AI provider: ${this.provider}`)}}async validateApiKey(){switch(this.provider){case ae:return ec();case fe:return W_();case le:return rv();case ue:return gv();default:throw new Error(`Unsupported AI provider: ${this.provider}`)}}async hasApiKey(){switch(this.provider){case ae:return tc();case fe:return K_();case le:return av();case ue:return yv();default:throw new Error(`Unsupported AI provider: ${this.provider}`)}}async getAvailableModels(){switch(this.provider){case ae:return nc();case fe:return Y_();case le:return lv();case ue:return Tv();default:throw new Error(`Unsupported AI provider: ${this.provider}`)}}createMessageFromResponse(e,n="character"){switch(this.provider){case ae:return ju(e,n);case fe:return H_(e,n);case le:return sv(e,n);case ue:return mv(e,n);default:throw new Error(`Unsupported AI provider: ${this.provider}`)}}getProvider(){return this.provider}setProvider(e){this.provider=e}getDefaultModel(){switch(this.provider){case ae:return"";case fe:return"";case le:return"";case ue:return"";default:throw new Error(`Unsupported AI provider: ${this.provider}`)}}async getDefaultModelAsync(){switch(this.provider){case ae:return"";case fe:return"";case le:case ue:try{const e=await this.getAvailableModels();return e.length>0?e[0]:""}catch{return""}default:throw new Error(`Unsupported AI provider: ${this.provider}`)}}getModelInfo(e){switch(this.provider){case ae:{const n=e.includes("gpt-4");return{name:e,tier:n?"premium":"pro",description:n?"Advanced GPT-4 model":"Standard GPT model",provider:ae}}case fe:return{...z_(e),provider:fe};case le:return{...uv(e),provider:le};case ue:return{...Av(e),provider:ue};default:throw new Error(`Unsupported AI provider: ${this.provider}`)}}getProviderDisplayName(){switch(this.provider){case ae:return"OpenAI (GPT)";case fe:return"Google AI (Gemini)";case le:return"Ollama (Local)";case ue:return"OpenRouter (Multi-Provider)";default:return this.provider}}}const xv=(t=le)=>{const[e,n]=H.useState(!1),[i,o]=H.useState(null),[r]=H.useState(()=>new Ev(t)),l=H.useCallback(()=>{o(null)},[]),u=H.useCallback(async(y,v={})=>{try{n(!0),o(null);const{model:E=r.getDefaultModel(),maxTokens:C=1e3}=v,T=await r.getChatCompletion(y,{model:E,maxTokens:C});return r.createMessageFromResponse(T)}catch(E){const C=E instanceof Error?E.message:"Unknown error occurred";return o(C),null}finally{n(!1)}},[r]),d=H.useCallback(async(y,v,E={})=>{try{n(!0),o(null);const{model:C=r.getDefaultModel(),maxTokens:T=1e3}=E,w=await r.getStreamingChatCompletion(y,v,{model:C,maxTokens:T});return r.createMessageFromResponse(w)}catch(C){const T=C instanceof Error?C.message:"Unknown error occurred";return o(T),null}finally{n(!1)}},[r]),c=H.useCallback(async()=>{try{return o(null),await r.validateApiKey()}catch(y){const v=y instanceof Error?y.message:"Connection validation failed";return o(v),!1}},[r]),f=H.useCallback(async()=>{try{return o(null),await r.getAvailableModels()}catch(y){const v=y instanceof Error?y.message:"Failed to fetch models";return o(v),[]}},[r]),h=H.useCallback(y=>{r.setProvider(y),l()},[r,l]),p=H.useCallback(()=>r.getProviderDisplayName(),[r]),m=H.useCallback(async()=>{try{return await r.hasApiKey()}catch{return!1}},[r]),g=H.useCallback(()=>r.getDefaultModel(),[r]);return{isLoading:e,error:i,currentProvider:r.getProvider(),generateResponse:u,generateStreamingResponse:d,validateConnection:c,getAvailableModels:f,switchProvider:h,getProviderDisplayName:p,getDefaultModel:g,clearError:l,hasApiKey:m}},Kv=t=>!t||typeof t!="string"?!1:t.startsWith("sk-")&&t.length>=40,Yv=t=>!t||typeof t!="string"?!1:t.startsWith("AI")&&t.length>=35,zv=t=>{if(!t||typeof t!="string")return!1;try{const e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},Zv=t=>!t||typeof t!="string"?!1:t.startsWith("sk-or-")&&t.length>=40,Tr=t=>{switch(t){case ae:return"OpenAI";case fe:return"Google AI";case le:return"Ollama";case ue:return"OpenRouter";default:return t}},Iv=H.lazy(()=>Ot(()=>import("./CharacterSelect-CgkLg0SC.js"),__vite__mapDeps([6,1,2]))),Mv=H.lazy(()=>Ot(()=>import("./AlertModal-Cgpf0RjE.js"),__vite__mapDeps([7,1,2])));function Rv(){const{t}=Er(),[e,n]=H.useState(()=>Nl()),[i,o]=H.useState(()=>bl(e)),r=H.useRef(null),[l,u]=H.useState(!1),[d,c]=H.useState(!1),[f,h]=H.useState(null),{chats:p,currentChat:m,currentChatId:g,streamingResponse:y,setCurrentChat:v,addMessage:E,createChat:C}=Ar(),{isLoading:T,error:w,generateResponse:M,validateConnection:D,clearError:A,switchProvider:V,hasApiKey:R,getDefaultModel:N}=xv(e),L=z=>{h(z),c(!0)},Te=()=>{c(!1),h(null)},Fe=z=>{n(z),V(z);const we=N();o(we)},pe=z=>{o(z)};H.useEffect(()=>{const z=()=>{const we=Dl();v(we),setTimeout(()=>{u(!0)},50)};return z(),window.addEventListener("hashchange",z),()=>{window.removeEventListener("hashchange",z)}},[v,p]),H.useEffect(()=>{var z;(z=r.current)==null||z.setActiveTab(0)},[g]);const Ue=async z=>{var go;if(!m||!g){L(t("mainContent.noChatSelected"));return}if(!await R()){L(J.jsxs("div",{children:[J.jsx("p",{className:"font-semibold",children:t("mainContent.apiKeyRequired")}),J.jsxs("p",{children:[t("mainContent.noApiKeyFound")," ",Tr(e),"."]}),J.jsx("p",{children:t("mainContent.configureApiKey")})]}));return}let me=p.find(yo=>yo.id===g);if(!me){L(t("mainContent.chatNotFound"));return}z&&((go=me.messages)!=null&&go.some(Il=>Il.id===z.id)||(me={...me,messages:[...me.messages||[],z]}));const Ct=await M(me,{model:i,maxTokens:1e3});Ct&&g&&E(g,Ct)},El=async()=>{const z=Tr(e);try{if(!await qe.hasApiKey(e)){L(`${t("mainContent.noApiKeyFound")} ${z}! ${t("mainContent.configureApiKey")}`);return}}catch(me){console.error("Error checking API key:",me),L(`${t("mainContent.errorCheckingApiKey")} ${z}.`);return}const we=await D();L(we?`${z} ${t("mainContent.connectionValid")}`:`${z} ${t("mainContent.connectionFailed")}`)},xl=async z=>{if(z.trim()&&g){const we={sender:"user",text:[z.trim()]},me=await E(g,we);return{...we,id:me}}};return J.jsxs("div",{className:"flex-1 w-full flex flex-col items-center justify-center bg-gray-200 dark:bg-gray-900",children:[J.jsx(H.Suspense,{fallback:J.jsx("div",{children:t("mainContent.loading")}),children:J.jsx(Mv,{show:d,onClose:Te,okText:t("common.confirm"),children:f})}),l?J.jsx("div",{className:"w-full flex-1 flex flex-col bg-fixed md:bg-cover md:bg-center bg-no-repeat",style:{backgroundImage:m!=null&&m.backgroundImage?`url(${m.backgroundImage})`:void 0},children:g&&m?J.jsx(Gl,{currentChat:m,streamingResponse:y,isLoading:T,error:w,clearError:A,onModelChange:pe,onProviderChange:Fe,selectedModel:i,selectedProvider:e,handleGenerateResponse:Ue,handleValidateConnection:El,onSendMessage:xl,tabsRef:r}):J.jsxs("div",{className:"p-6",children:[J.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200 mb-4 mt-6",children:t("mainContent.selectCharacter")}),J.jsx(H.Suspense,{fallback:J.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:t("mainContent.loadingCharacters")}),children:J.jsx(Iv,{onSelect:async(z,we,me)=>{const Ct=await C(z,we,me);window.location.hash=`#${Ct}`}})})]})}):J.jsx("div",{className:"flex m-auto items-center justify-center h-full",children:J.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t("mainContent.loading")})})]})}const Xv=Object.freeze(Object.defineProperty({__proto__:null,default:Rv},Symbol.toStringTag,{value:"Module"}));export{Nv as B,bv as H,Xv as M,Yv as a,Zv as b,zv as c,Hv as d,Wv as e,Jv as r,xv as u,Kv as v};
