import{G as v,r as x,j as e,m as T,n as I,d as A,R as B,C as H}from"./index-C_wYTZAa.js";function V(a){return v({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"},child:[]}]})(a)}function w(a){return v({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12.008 0A822.933 822.933 0 0 0 1.59 6.043V18c3.578 2.087 7.238 4.274 10.418 6 3.928-2.267 6.71-3.868 10.402-6v-3.043l-1.045.6v1.8l-1.545.9-1.56-.9v-1.8l1.56-.885v-.002l.268.156a8.15 8.15 0 0 0 .404-1.754v-.002a8.72 8.72 0 0 0 .072-1.072 9.885 9.885 0 0 0-.072-1.127 8.873 8.873 0 0 0-.515-1.97v-.003a8.137 8.137 0 0 0-1.301-2.242 7.113 7.113 0 0 0-.615-.699 10.271 10.271 0 0 0-.846-.728 7.91 7.91 0 0 0-1.902-1.116 4.776 4.776 0 0 0-.586-.213v-.957c.41.118.812.265 1.2.442a9.2 9.2 0 0 1 1.618.943 9.4 9.4 0 0 1 1.158.986c.273.277.53.568.774.872.532.686.97 1.44 1.302 2.244h-.002a9.45 9.45 0 0 1 .645 2.613c.04.317.06.637.056.957 0 .314-.014.614-.043.914-.082.838-.37 1.786-.542 2.373l.472.27 1.045-.602V8.986l-1.303-.742v-.002l1.303.744V6c-3.56-2.057-7.212-4.154-10.402-6Zm8.08 14.826c-.02.052.003.002.004.002zM12.035 1.213l1.56.9v1.801l-1.56.885-1.545-.885h-.002v-.328a8.458 8.458 0 0 0-1.744.516 8.178 8.178 0 0 0-1.889 1.07l-.001.002a6.77 6.77 0 0 0-.9.783 9.171 9.171 0 0 0-.616.672 8.84 8.84 0 0 0-1.3 2.228l.228.127 1.287-.742 1.203.686c1.929-1.112 3.397-1.961 5.252-3.014l.027.014c1.926 1.114 3.398 1.955 5.238 3.029.028 1.997.014 4.064.014 6.086-1.874 1.084-3.753 2.16-5.28 3.043a859.719 859.719 0 0 1-5.294-3.043V8.957l.043-.027-1.203-.688-1.287.744-.229-.129h-.002a8.376 8.376 0 0 0-.53 2.057c-.044.36-.068.723-.07 1.086.002.344.026.687.07 1.027v.002c.015.215.06.429.102.643l-.83.484a7.017 7.017 0 0 1-.2-1.199A7.065 7.065 0 0 1 2.52 12c0-.329.028-.672.056-1a9.77 9.77 0 0 1 .658-2.6 9.438 9.438 0 0 1 1.303-2.244c.243-.3.5-.57.758-.842.37-.372.773-.71 1.203-1.013-1.215-.084-1.215-.084 0-.002a9.394 9.394 0 0 1 1.645-.942 9.866 9.866 0 0 1 2.347-.7l-.002-.542-1.043-.601 1.045.6zm0 .773-.887.514v1.027l.887.516.887-.516V2.5Zm-.03 6.928c-.935.532-1.888 1.084-2.689 1.543v3.086c.933.535 1.892 1.095 2.692 1.557.926-.565 1.865-1.093 2.676-1.557v-3.086c-.945-.542-1.857-1.074-2.678-1.543Zm-7.74 5.758 1.546.885v1.8l-.329.186c.146.177.303.344.471.5.277.288.58.55.902.785a8.07 8.07 0 0 0 1.83 1.059h.002a8.14 8.14 0 0 0 2.061.57c.417.058.837.087 1.258.086a8.37 8.37 0 0 0 1.332-.1 8.64 8.64 0 0 0 2.017-.572 8.076 8.076 0 0 0 1.86-1.1c.172-.114.315-.242.472-.37l.83.47a9.79 9.79 0 0 1-.945.787l.946.541 1.302-.756-1.302.758-.946-.543c-.516.37-1.067.69-1.644.955l-.002.002a9.502 9.502 0 0 1-2.588.756c-.441.057-.885.086-1.33.086a12.048 12.048 0 0 1-1.26-.072v.002a9.38 9.38 0 0 1-2.605-.744 9.044 9.044 0 0 1-1.688-.971 9.625 9.625 0 0 1-1.775-1.658h-.002l-.412.244-1.56-.9v-1.801zm0 .756-.886.515v1.028l.887.515.886-.515v-1.028zm15.555 0-.902.515v1.028l.902.515.887-.515v-1.028z"},child:[]}]})(a)}const R=(a,r)=>r?Object.entries(r).reduce((o,[n,l])=>o.replace(new RegExp(n,"g"),l),a):a;function K({message:a,selectedChat:r,msgSender:o,chatId:n,updateMessage:l,deleteMessage:s}){const u=a.sender!=="user",[m,d]=x.useState(!1),[c,g]=x.useState(a.text.join(`

`)),[i,t]=x.useState(!1),[h,p]=x.useState(!1),[N,y]=x.useState(!1);let b;u?b=r!=null&&r.characterImage?e.jsx("img",{src:r.characterImage,alt:r.characterName,className:"w-14 h-20 rounded-md overflow-hidden object-cover"}):e.jsx(V,{className:"mx-auto",size:38}):b=e.jsx(w,{className:"mx-auto mt-1",size:38});const k=()=>d(!0),M=()=>{g(a.text.join(`

`)),d(!1)},S=async()=>{if(!n||!l)return;t(!0);const f=c.split(/\n\n+/).map(j=>j.trim()).filter(Boolean);await l(n,a.id,{text:f}),t(!1),d(!1)},z=()=>p(!0),D=()=>p(!1),E=async()=>{if(!(!n||!s)){y(!0);try{await s(n,a.id)}catch(f){console.error("Error deleting message:",f)}y(!1),p(!1)}};return e.jsxs("div",{className:"p-2 flex gap-2 bg-black/80 rounded-md",children:[e.jsx("div",{className:"flex-shrink-0 w-14 text-gray-800 dark:text-blue-200",children:b}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("strong",{className:"text-blue-400",children:o}),e.jsx("div",{className:"flex-1 space-y-[6px]",children:m?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"w-full rounded bg-gray-800 text-gray-200 p-2 pt-0 border border-gray-600 mb-2",rows:Math.max(6,c.split(`

`).length),value:c,onChange:f=>g(f.target.value),disabled:i}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"cursor-pointer px-2 py-1 rounded bg-green-600 text-white hover:bg-green-700 text-xs",onClick:S,disabled:i,children:i?"Saving...":"Save"}),e.jsx("button",{className:"cursor-pointer px-2 py-1 rounded bg-gray-600 text-white hover:bg-gray-700 text-xs",onClick:M,disabled:i,children:"Cancel"})]})]}):a.text.map((f,j)=>e.jsx("p",{className:"text-gray-200",style:{color:u&&(r!=null&&r.characterColor)?r.characterColor:""},dangerouslySetInnerHTML:{__html:R(f,T(r))}},`message-text-${a.id}-${j}`))}),!m&&n&&l&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"cursor-pointer text-xs text-blue-400 hover:underline",onClick:k,children:"Edit"}),s&&e.jsx("button",{className:"cursor-pointer text-xs text-red-400 hover:underline",onClick:z,children:"Delete"})]}),e.jsx(I,{show:h,onClose:D,onConfirm:E,title:"Delete Message",confirmText:N?"Deleting...":"Delete",cancelText:"Cancel",confirmColor:"failure",loading:N,children:"Are you sure you want to delete this message? This action cannot be undone."})]})]},`chat-message-${a.id}`)}function $(a){return v({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"M256 256s-48-96-126-96c-54.12 0-98 43-98 96s43.88 96 98 96c37.51 0 71-22.41 94-48m32-48s48 96 126 96c54.12 0 98-43 98-96s-43.88-96-98-96c-37.51 0-71 22.41-94 48"},child:[]}]})(a)}function G(a){return v({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"m476.59 227.05-.16-.07L49.35 49.84A23.56 23.56 0 0 0 27.14 52 24.65 24.65 0 0 0 16 72.59v113.29a24 24 0 0 0 19.52 23.57l232.93 43.07a4 4 0 0 1 0 7.86L35.53 303.45A24 24 0 0 0 16 327v113.31A23.57 23.57 0 0 0 26.59 460a23.94 23.94 0 0 0 13.22 4 24.55 24.55 0 0 0 9.52-1.93L476.4 285.94l.19-.09a32 32 0 0 0 0-58.8z"},child:[]}]})(a)}const U=({selectedChat:a,onSendMessage:r,onGenerateResponse:o,isLoading:n=!1,disabled:l=!1})=>{const[s,u]=x.useState(""),m=x.useRef(null),d=()=>{const t=m.current;if(t){t.style.height="auto";const h=Math.min(t.scrollHeight,150);t.style.height=`${Math.max(h,72)}px`}};x.useEffect(()=>{d()},[s]);const c=async()=>{const t=s.trim();t&&!n&&!l&&(r(t),u(""),setTimeout(()=>{o()},100))},g=t=>{t.key==="Enter"&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),c())},i=(a==null?void 0:a.userName)??"User";return e.jsxs("div",{className:"p-2 flex gap-2 bg-black/80 rounded-md",children:[e.jsx("div",{className:"flex-shrink-0 w-14 text-gray-800 dark:text-blue-200",children:e.jsx(w,{className:"mx-auto mt-1",size:38})}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("strong",{className:"text-blue-400",children:i}),e.jsxs("div",{className:"flex-1 flex items-end gap-2",children:[e.jsx("textarea",{ref:m,id:"message-input",name:"message-input",className:"flex-1 min-h-[72px] max-h-[150px] resize-none rounded bg-gray-800/40 text-gray-200 p-2 pt-0 mt-1 border border-gray-600 focus:border-blue-500 focus:outline-none",placeholder:"Your message (Enter for new lines; Ctrl+Enter to send and generate reply)",value:s,onChange:t=>u(t.target.value),onKeyDown:g,disabled:n||l,rows:3}),e.jsx("button",{onClick:c,disabled:!s.trim()||n||l,className:"flex-shrink-0 p-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",title:"Send message and generate reply (Ctrl+Enter)",children:n?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(G,{size:20})})]})]})]})};function Z(a){return v({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16 2H8C4.691 2 2 4.691 2 8v13a1 1 0 0 0 1 1h13c3.309 0 6-2.691 6-6V8c0-3.309-2.691-6-6-6zm4 14c0 2.206-1.794 4-4 4H4V8c0-2.206 1.794-4 4-4h8c2.206 0 4 1.794 4 4v8z"},child:[]},{tag:"path",attr:{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4z"},child:[]}]})(a)}const O=({messages:a,selectedChat:r,streamingResponse:o,onSendMessage:n,onGenerateResponse:l,isLoading:s=!1})=>{var i;const{currentChatId:u,updateMessage:m,deleteMessage:d}=A(),c=()=>{s||r&&l()},g=B.useMemo(()=>{const t=(r==null?void 0:r.characterInitialMessage)||[];return!r||(t==null?void 0:t.length)===0?a:[{id:"0",sender:"character",text:(r==null?void 0:r.characterInitialMessage)||[]},...a]},[r,a]);return e.jsxs("div",{className:"w-full p-0 mb-4 h-auto overflow-y-auto",children:[g.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 italic",children:"No messages yet"}):g.map(t=>{let h;return t.sender==="user"?h=(r==null?void 0:r.userName)??"User":h=(r==null?void 0:r.characterName)??"Character",e.jsx("div",{className:"mb-3",children:e.jsx(K,{message:t,selectedChat:r,msgSender:h,chatId:u,updateMessage:m,deleteMessage:d})},t.id)}),o&&e.jsxs("div",{className:"mb-3 p-3 rounded bg-yellow-100 dark:bg-yellow-900 mr-8",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Streaming... (Character)"}),e.jsx("div",{className:"text-gray-800 dark:text-gray-200",children:o})]}),e.jsx("div",{className:"flex flex-wrap gap-3 mb-3",children:e.jsx(H,{onClick:c,className:"bg-green-500 w-42 ml-auto hover:bg-green-600 text-white",disabled:s||(((i=r==null?void 0:r.messages)==null?void 0:i.length)??0)===0,children:s?e.jsxs("span",{className:"flex items-center gap-2 mr-auto",children:[e.jsx($,{})," Generating..."]}):e.jsxs("span",{className:"flex items-center gap-2 mr-auto",children:[e.jsx(Z,{})," New Response"]})})}),e.jsx("div",{className:"mb-3",children:e.jsx(U,{selectedChat:r,onSendMessage:n,onGenerateResponse:l,isLoading:s})})]})};export{O as default};
