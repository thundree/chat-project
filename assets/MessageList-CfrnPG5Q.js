import{G as j,r as m,j as e,o as E,p as H,e as w,I as B,d as V,R,C as A,q as K}from"./index-CgdzIC31.js";function $(r){return j({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"},child:[]}]})(r)}function k(r){return j({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12.008 0A822.933 822.933 0 0 0 1.59 6.043V18c3.578 2.087 7.238 4.274 10.418 6 3.928-2.267 6.71-3.868 10.402-6v-3.043l-1.045.6v1.8l-1.545.9-1.56-.9v-1.8l1.56-.885v-.002l.268.156a8.15 8.15 0 0 0 .404-1.754v-.002a8.72 8.72 0 0 0 .072-1.072 9.885 9.885 0 0 0-.072-1.127 8.873 8.873 0 0 0-.515-1.97v-.003a8.137 8.137 0 0 0-1.301-2.242 7.113 7.113 0 0 0-.615-.699 10.271 10.271 0 0 0-.846-.728 7.91 7.91 0 0 0-1.902-1.116 4.776 4.776 0 0 0-.586-.213v-.957c.41.118.812.265 1.2.442a9.2 9.2 0 0 1 1.618.943 9.4 9.4 0 0 1 1.158.986c.273.277.53.568.774.872.532.686.97 1.44 1.302 2.244h-.002a9.45 9.45 0 0 1 .645 2.613c.04.317.06.637.056.957 0 .314-.014.614-.043.914-.082.838-.37 1.786-.542 2.373l.472.27 1.045-.602V8.986l-1.303-.742v-.002l1.303.744V6c-3.56-2.057-7.212-4.154-10.402-6Zm8.08 14.826c-.02.052.003.002.004.002zM12.035 1.213l1.56.9v1.801l-1.56.885-1.545-.885h-.002v-.328a8.458 8.458 0 0 0-1.744.516 8.178 8.178 0 0 0-1.889 1.07l-.001.002a6.77 6.77 0 0 0-.9.783 9.171 9.171 0 0 0-.616.672 8.84 8.84 0 0 0-1.3 2.228l.228.127 1.287-.742 1.203.686c1.929-1.112 3.397-1.961 5.252-3.014l.027.014c1.926 1.114 3.398 1.955 5.238 3.029.028 1.997.014 4.064.014 6.086-1.874 1.084-3.753 2.16-5.28 3.043a859.719 859.719 0 0 1-5.294-3.043V8.957l.043-.027-1.203-.688-1.287.744-.229-.129h-.002a8.376 8.376 0 0 0-.53 2.057c-.044.36-.068.723-.07 1.086.002.344.026.687.07 1.027v.002c.015.215.06.429.102.643l-.83.484a7.017 7.017 0 0 1-.2-1.199A7.065 7.065 0 0 1 2.52 12c0-.329.028-.672.056-1a9.77 9.77 0 0 1 .658-2.6 9.438 9.438 0 0 1 1.303-2.244c.243-.3.5-.57.758-.842.37-.372.773-.71 1.203-1.013-1.215-.084-1.215-.084 0-.002a9.394 9.394 0 0 1 1.645-.942 9.866 9.866 0 0 1 2.347-.7l-.002-.542-1.043-.601 1.045.6zm0 .773-.887.514v1.027l.887.516.887-.516V2.5Zm-.03 6.928c-.935.532-1.888 1.084-2.689 1.543v3.086c.933.535 1.892 1.095 2.692 1.557.926-.565 1.865-1.093 2.676-1.557v-3.086c-.945-.542-1.857-1.074-2.678-1.543Zm-7.74 5.758 1.546.885v1.8l-.329.186c.146.177.303.344.471.5.277.288.58.55.902.785a8.07 8.07 0 0 0 1.83 1.059h.002a8.14 8.14 0 0 0 2.061.57c.417.058.837.087 1.258.086a8.37 8.37 0 0 0 1.332-.1 8.64 8.64 0 0 0 2.017-.572 8.076 8.076 0 0 0 1.86-1.1c.172-.114.315-.242.472-.37l.83.47a9.79 9.79 0 0 1-.945.787l.946.541 1.302-.756-1.302.758-.946-.543c-.516.37-1.067.69-1.644.955l-.002.002a9.502 9.502 0 0 1-2.588.756c-.441.057-.885.086-1.33.086a12.048 12.048 0 0 1-1.26-.072v.002a9.38 9.38 0 0 1-2.605-.744 9.044 9.044 0 0 1-1.688-.971 9.625 9.625 0 0 1-1.775-1.658h-.002l-.412.244-1.56-.9v-1.801zm0 .756-.886.515v1.028l.887.515.886-.515v-1.028zm15.555 0-.902.515v1.028l.902.515.887-.515v-1.028z"},child:[]}]})(r)}const U=(r,a)=>a?Object.entries(a).reduce((d,[s,n])=>d.replace(new RegExp(s,"g"),n),r):r;function Z({message:r,selectedChat:a,msgSender:d,chatId:s,updateMessage:n,deleteMessage:l}){const o=r.sender!=="user",[g,u]=m.useState(!1),[i,h]=m.useState(r.text.join(`

`)),[c,f]=m.useState(!1),[t,x]=m.useState(!1),[y,N]=m.useState(!1);let p;o?p=a!=null&&a.characterImage?e.jsx("img",{src:a.characterImage,alt:a.characterName,className:"w-14 h-20 rounded-md overflow-hidden object-cover"}):e.jsx($,{className:"mx-auto",size:38}):p=e.jsx(k,{className:"mx-auto mt-1",size:38});const M=()=>u(!0),S=()=>{h(r.text.join(`

`)),u(!1)},z=async()=>{if(!s||!n)return;f(!0);const v=i.split(/\n\n+/).map(b=>b.trim()).filter(Boolean);await n(s,r.id,{text:v}),f(!1),u(!1)},I=()=>x(!0),T=()=>x(!1),D=async()=>{if(!(!s||!l)){N(!0);try{await l(s,r.id)}catch(v){console.error("Error deleting message:",v)}N(!1),x(!1)}};return e.jsxs("div",{className:"p-2 flex gap-2 bg-white/90 dark:bg-black/80 rounded-md",children:[e.jsx("div",{className:"flex-shrink-0 w-14 text-gray-800 dark:text-blue-200",children:p}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("strong",{className:"text-blue-600 dark:text-blue-400",children:d}),e.jsx("div",{className:"flex-1 space-y-[6px]",children:g?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"w-full rounded bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-200 p-2 pt-0 border border-gray-300 dark:border-gray-600 mb-2",rows:Math.max(6,i.split(`

`).length),value:i,onChange:v=>h(v.target.value),disabled:c}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{className:"cursor-pointer px-2 py-1 rounded bg-green-600 text-white hover:bg-green-700 text-xs",onClick:z,disabled:c,children:c?"Saving...":"Save"}),e.jsx("button",{className:"cursor-pointer px-2 py-1 rounded bg-gray-600 text-white hover:bg-gray-700 text-xs",onClick:S,disabled:c,children:"Cancel"})]})]}):r.text.map((v,b)=>e.jsx("p",{className:"text-gray-800 dark:text-gray-200",style:{color:o&&(a!=null&&a.characterColor)?a.characterColor:""},dangerouslySetInnerHTML:{__html:U(v,E(a))}},`message-text-${r.id}-${b}`))}),!g&&s&&n&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"cursor-pointer text-xs text-blue-600 dark:text-blue-400 hover:underline",onClick:M,children:"Edit"}),l&&e.jsx("button",{className:"cursor-pointer text-xs text-red-600 dark:text-red-400 hover:underline",onClick:I,children:"Delete"})]}),e.jsx(H,{show:t,onClose:T,onConfirm:D,title:"Delete Message",confirmText:y?"Deleting...":"Delete",cancelText:"Cancel",confirmColor:"failure",loading:y,children:"Are you sure you want to delete this message? This action cannot be undone."})]})]},`chat-message-${r.id}`)}const q=({selectedChat:r,onSendMessage:a,onGenerateResponse:d,isLoading:s=!1,disabled:n=!1})=>{const{t:l}=w(),[o,g]=m.useState(""),u=m.useRef(null),i=()=>{const t=u.current;if(t){t.style.height="auto";const x=Math.min(t.scrollHeight,150);t.style.height=`${Math.max(x,72)}px`}};m.useEffect(()=>{i()},[o]);const h=async()=>{const t=o.trim();t&&!s&&!n&&(a(t),g(""),setTimeout(()=>{d()},100))},c=t=>{t.key==="Enter"&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),h())},f=(r==null?void 0:r.userName)??l("messageInput.defaultUser");return e.jsxs("div",{className:"p-2 flex gap-2 bg-white/90 dark:bg-black/80 rounded-md",children:[e.jsx("div",{className:"flex-shrink-0 w-14 text-gray-800 dark:text-blue-200",children:e.jsx(k,{className:"mx-auto mt-1",size:38})}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("strong",{className:"text-blue-600 dark:text-blue-400",children:f}),e.jsxs("div",{className:"flex-1 flex items-end gap-2",children:[e.jsx("textarea",{ref:u,id:"message-input",name:"message-input",className:"flex-1 min-h-[72px] max-h-[150px] resize-none rounded bg-gray-100/80 dark:bg-gray-800/40 text-gray-900 dark:text-gray-200 p-2 pt-0 mt-1 border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none",placeholder:l("messageInput.placeholder"),value:o,onChange:t=>g(t.target.value),onKeyDown:c,disabled:s||n,rows:3}),e.jsx("button",{onClick:h,disabled:!o.trim()||s||n,className:"flex-shrink-0 p-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",title:l("messageInput.sendButtonTitle"),children:s?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(B,{size:20})})]})]})]})};function F(r){return j({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16 2H8C4.691 2 2 4.691 2 8v13a1 1 0 0 0 1 1h13c3.309 0 6-2.691 6-6V8c0-3.309-2.691-6-6-6zm4 14c0 2.206-1.794 4-4 4H4V8c0-2.206 1.794-4 4-4h8c2.206 0 4 1.794 4 4v8z"},child:[]},{tag:"path",attr:{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4z"},child:[]}]})(r)}const L=({messages:r,selectedChat:a,streamingResponse:d,onSendMessage:s,onGenerateResponse:n,isLoading:l=!1})=>{var f;const{currentChatId:o,updateMessage:g,deleteMessage:u}=V(),{t:i}=w(),h=()=>{l||a&&n()},c=R.useMemo(()=>{const t=(a==null?void 0:a.characterInitialMessage)||[];return!a||(t==null?void 0:t.length)===0?r:[{id:"0",sender:"character",text:(a==null?void 0:a.characterInitialMessage)||[]},...r]},[a,r]);return e.jsxs("div",{className:"w-full p-0 mb-4 h-auto overflow-y-auto",children:[c.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 italic",children:i("messageList.noMessages")}):c.map(t=>{let x;return t.sender==="user"?x=(a==null?void 0:a.userName)??i("messageList.defaultUser"):x=(a==null?void 0:a.characterName)??i("messageList.defaultCharacter"),e.jsx("div",{className:"mb-3",children:e.jsx(Z,{message:t,selectedChat:a,msgSender:x,chatId:o,updateMessage:g,deleteMessage:u})},t.id)}),d&&e.jsxs("div",{className:"mb-3 p-3 rounded bg-yellow-100 dark:bg-yellow-900 mr-8",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:i("messageList.streaming")}),e.jsx("div",{className:"text-gray-800 dark:text-gray-200",children:d})]}),e.jsx("div",{className:"flex flex-wrap gap-3 mb-3",children:e.jsx(A,{onClick:h,className:"bg-green-500 w-42 ml-auto hover:bg-green-600 text-white",disabled:l||(((f=a==null?void 0:a.messages)==null?void 0:f.length)??0)===0,children:l?e.jsxs("span",{className:"flex items-center gap-2 mr-auto",children:[e.jsx(K,{})," ",i("messageList.generating")]}):e.jsxs("span",{className:"flex items-center gap-2 mr-auto",children:[e.jsx(F,{})," ",i("messageList.newResponse")]})})}),e.jsx("div",{className:"mb-3",children:e.jsx(q,{selectedChat:a,onSendMessage:s,onGenerateResponse:n,isLoading:l})})]})};export{L as default};
