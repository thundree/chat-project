import{G as f,R as m,j as r,i as N,e as y}from"./index-Dk6qGdX0.js";function w(e){return f({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"},child:[]}]})(e)}function S(e){return f({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12.008 0A822.933 822.933 0 0 0 1.59 6.043V18c3.578 2.087 7.238 4.274 10.418 6 3.928-2.267 6.71-3.868 10.402-6v-3.043l-1.045.6v1.8l-1.545.9-1.56-.9v-1.8l1.56-.885v-.002l.268.156a8.15 8.15 0 0 0 .404-1.754v-.002a8.72 8.72 0 0 0 .072-1.072 9.885 9.885 0 0 0-.072-1.127 8.873 8.873 0 0 0-.515-1.97v-.003a8.137 8.137 0 0 0-1.301-2.242 7.113 7.113 0 0 0-.615-.699 10.271 10.271 0 0 0-.846-.728 7.91 7.91 0 0 0-1.902-1.116 4.776 4.776 0 0 0-.586-.213v-.957c.41.118.812.265 1.2.442a9.2 9.2 0 0 1 1.618.943 9.4 9.4 0 0 1 1.158.986c.273.277.53.568.774.872.532.686.97 1.44 1.302 2.244h-.002a9.45 9.45 0 0 1 .645 2.613c.04.317.06.637.056.957 0 .314-.014.614-.043.914-.082.838-.37 1.786-.542 2.373l.472.27 1.045-.602V8.986l-1.303-.742v-.002l1.303.744V6c-3.56-2.057-7.212-4.154-10.402-6Zm8.08 14.826c-.02.052.003.002.004.002zM12.035 1.213l1.56.9v1.801l-1.56.885-1.545-.885h-.002v-.328a8.458 8.458 0 0 0-1.744.516 8.178 8.178 0 0 0-1.889 1.07l-.001.002a6.77 6.77 0 0 0-.9.783 9.171 9.171 0 0 0-.616.672 8.84 8.84 0 0 0-1.3 2.228l.228.127 1.287-.742 1.203.686c1.929-1.112 3.397-1.961 5.252-3.014l.027.014c1.926 1.114 3.398 1.955 5.238 3.029.028 1.997.014 4.064.014 6.086-1.874 1.084-3.753 2.16-5.28 3.043a859.719 859.719 0 0 1-5.294-3.043V8.957l.043-.027-1.203-.688-1.287.744-.229-.129h-.002a8.376 8.376 0 0 0-.53 2.057c-.044.36-.068.723-.07 1.086.002.344.026.687.07 1.027v.002c.015.215.06.429.102.643l-.83.484a7.017 7.017 0 0 1-.2-1.199A7.065 7.065 0 0 1 2.52 12c0-.329.028-.672.056-1a9.77 9.77 0 0 1 .658-2.6 9.438 9.438 0 0 1 1.303-2.244c.243-.3.5-.57.758-.842.37-.372.773-.71 1.203-1.013-1.215-.084-1.215-.084 0-.002a9.394 9.394 0 0 1 1.645-.942 9.866 9.866 0 0 1 2.347-.7l-.002-.542-1.043-.601 1.045.6zm0 .773-.887.514v1.027l.887.516.887-.516V2.5Zm-.03 6.928c-.935.532-1.888 1.084-2.689 1.543v3.086c.933.535 1.892 1.095 2.692 1.557.926-.565 1.865-1.093 2.676-1.557v-3.086c-.945-.542-1.857-1.074-2.678-1.543Zm-7.74 5.758 1.546.885v1.8l-.329.186c.146.177.303.344.471.5.277.288.58.55.902.785a8.07 8.07 0 0 0 1.83 1.059h.002a8.14 8.14 0 0 0 2.061.57c.417.058.837.087 1.258.086a8.37 8.37 0 0 0 1.332-.1 8.64 8.64 0 0 0 2.017-.572 8.076 8.076 0 0 0 1.86-1.1c.172-.114.315-.242.472-.37l.83.47a9.79 9.79 0 0 1-.945.787l.946.541 1.302-.756-1.302.758-.946-.543c-.516.37-1.067.69-1.644.955l-.002.002a9.502 9.502 0 0 1-2.588.756c-.441.057-.885.086-1.33.086a12.048 12.048 0 0 1-1.26-.072v.002a9.38 9.38 0 0 1-2.605-.744 9.044 9.044 0 0 1-1.688-.971 9.625 9.625 0 0 1-1.775-1.658h-.002l-.412.244-1.56-.9v-1.801zm0 .756-.886.515v1.028l.887.515.886-.515v-1.028zm15.555 0-.902.515v1.028l.902.515.887-.515v-1.028z"},child:[]}]})(e)}const M=(e,a)=>a?Object.entries(a).reduce((c,[s,t])=>c.replace(new RegExp(s,"g"),t),e):e;function k({message:e,selectedChat:a,msgSender:c,chatId:s,updateMessage:t}){const i=e.sender!=="user",[n,l]=m.useState(!1),[u,v]=m.useState(e.text.join(`

`)),[x,p]=m.useState(!1);let g;i?g=a!=null&&a.characterImage?r.jsx("img",{src:a.characterImage,alt:a.characterName,className:"w-14 h-20 rounded-md overflow-hidden object-cover"}):r.jsx(w,{className:"mx-auto",size:38}):g=r.jsx(S,{className:"mx-auto mt-1",size:38});const h=()=>l(!0),j=()=>{v(e.text.join(`

`)),l(!1)},b=async()=>{if(!s||!t)return;p(!0);const o=u.split(/\n\n+/).map(d=>d.trim()).filter(Boolean);await t(s,e.id,{text:o}),p(!1),l(!1)};return r.jsxs("div",{className:"p-2 flex gap-2 bg-black/80 rounded-md",children:[r.jsx("div",{className:"flex-shrink-0 w-14 text-gray-800 dark:text-blue-200",children:g}),r.jsxs("div",{className:"flex flex-col w-full",children:[r.jsx("strong",{className:"text-blue-400",children:c}),r.jsx("div",{className:"flex-1 space-y-[6px]",children:n?r.jsxs(r.Fragment,{children:[r.jsx("textarea",{className:"w-full rounded bg-gray-800 text-gray-200 p-2 border border-gray-600 mb-2",rows:Math.max(6,u.split(`

`).length),value:u,onChange:o=>v(o.target.value),disabled:x}),r.jsxs("div",{className:"flex gap-2 mt-1",children:[r.jsx("button",{className:"px-2 py-1 rounded bg-green-600 text-white hover:bg-green-700 text-xs",onClick:b,disabled:x,children:x?"Saving...":"Save"}),r.jsx("button",{className:"px-2 py-1 rounded bg-gray-600 text-white hover:bg-gray-700 text-xs",onClick:j,disabled:x,children:"Cancel"})]})]}):e.text.map((o,d)=>r.jsx("p",{className:"text-gray-200",style:{color:i&&(a!=null&&a.characterColor)?a.characterColor:""},dangerouslySetInnerHTML:{__html:M(o,N(a))}},`message-text-${e.id}-${d}`))}),!n&&s&&t&&r.jsx("button",{className:"cursor-pointer mt-2 text-xs text-blue-400 hover:underline self-start",onClick:h,children:"Edit"})]})]},`chat-message-${e.id}`)}const I=({messages:e,selectedChat:a,streamingResponse:c})=>{const{currentChatId:s,updateMessage:t}=y(),i=m.useMemo(()=>{const n=(a==null?void 0:a.characterInitialMessage)||[];return!a||(n==null?void 0:n.length)===0?e:[{id:"0",sender:"character",text:(a==null?void 0:a.characterInitialMessage)||[]},...e]},[a,e]);return r.jsxs("div",{className:"w-full p-0 mb-4 h-auto overflow-y-auto",children:[i.length===0?r.jsx("p",{className:"text-gray-500 dark:text-gray-400 italic",children:"No messages yet"}):i.map(n=>{let l;return n.sender==="user"?l=(a==null?void 0:a.userName)??"User":l=(a==null?void 0:a.characterName)??"Character",r.jsx("div",{className:"mb-3",children:r.jsx(k,{message:n,selectedChat:a,msgSender:l,chatId:s,updateMessage:t})},n.id)}),c&&r.jsxs("div",{className:"mb-3 p-3 rounded bg-yellow-100 dark:bg-yellow-900 mr-8",children:[r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Streaming... (Character)"}),r.jsx("div",{className:"text-gray-800 dark:text-gray-200",children:c})]})]})};export{I as default};
